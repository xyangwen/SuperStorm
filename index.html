<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SuperSky Storm 3D - v7.3 Boss Fixed & Turbo</title>
    <style>
        /* --- ESTILOS GERAIS (CORE) --- */
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@300;500;700&display=swap');

        * {
            box-sizing: border-box;
            user-select: none;
            -webkit-user-select: none;
            touch-action: none;
        }

        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            background-color: #000;
            font-family: 'Orbitron', sans-serif;
            overflow: hidden;
            color: #fff;
        }

        #game-wrapper {
            position: relative;
            width: 100%;
            height: 100%;
            background: #000;
            overflow: hidden;
        }

        /* --- CAMADAS (LAYERS) --- */
        #bgCanvas {
            position: absolute;
            top: 0; left: 0;
            z-index: 1;
            width: 100%; height: 100%;
        }

        #gameCanvas {
            position: absolute;
            top: 0; left: 0;
            z-index: 5;
            width: 100%; height: 100%;
        }

        .entity-layer {
            position: absolute;
            z-index: 6;
            width: 90px;
            height: 90px;
            /* Transform is handled by JS for precise flipping and centering */
            pointer-events: none;
            transition: top 0.1s linear; 
        }
        
        #hero-layer {
            filter: drop-shadow(0 0 15px rgba(0, 234, 255, 0.6));
        }

        #boss-layer {
            z-index: 6;
            filter: drop-shadow(0 0 15px rgba(255, 0, 0, 0.6));
            display: none; /* Hidden by default */
        }
        
        .sprite-img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .scanlines {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.15) 50%);
            background-size: 100% 4px;
            pointer-events: none;
            z-index: 20;
            box-shadow: inset 0 0 80px rgba(0,0,0,0.8);
        }

        /* --- TELAS E MENUS (UI) --- */
        .screen {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: 50;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: rgba(0, 0, 0, 0.85);
            transition: opacity 0.4s ease;
            backdrop-filter: blur(8px);
        }

        .hidden {
            display: none !important;
            opacity: 0;
            pointer-events: none;
        }

        h1 {
            font-size: 3rem;
            text-transform: uppercase;
            text-align: center;
            margin: 0;
            background: linear-gradient(to bottom, #fff, #555);
            -webkit-background-clip: text;
            color: transparent;
            text-shadow: 0 0 20px rgba(0, 234, 255, 0.5);
            animation: pulseText 2s infinite;
        }

        h2 { color: #00eaff; text-shadow: 0 0 10px #00eaff; margin-bottom: 20px; text-align: center; }

        .btn {
            background: rgba(10, 20, 40, 0.9);
            border: 2px solid #00eaff;
            color: #fff;
            padding: 15px 30px;
            font-family: 'Orbitron', sans-serif;
            font-size: 1.1rem;
            margin: 10px;
            cursor: pointer;
            width: 80%;
            max-width: 300px;
            clip-path: polygon(10% 0, 100% 0, 100% 70%, 90% 100%, 0 100%, 0 30%);
            transition: all 0.2s;
            text-transform: uppercase;
            letter-spacing: 2px;
            position: relative;
            overflow: hidden;
            display: block;
            margin-left: auto;
            margin-right: auto;
        }

        .btn:active { transform: scale(0.96); background: #00eaff; color: #000; }
        
        .btn::before {
            content: '';
            position: absolute;
            top: 0; left: -100%;
            width: 100%; height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            animation: btnShine 3s infinite;
        }

        @keyframes pulseText { 0%{opacity: 0.8;} 50%{opacity: 1;} 100%{opacity: 0.8;} }
        @keyframes btnShine { 0%{left: -100%;} 20%{left: 200%;} 100%{left: 200%;} }

        /* --- HUD (Interface durante o jogo) --- */
        #hud {
            position: absolute;
            top: 15px; left: 15px; right: 15px;
            z-index: 30;
            display: flex;
            justify-content: space-between;
            font-family: 'Orbitron', sans-serif;
            pointer-events: none;
        }
        
        #hud-left-container { 
            display: flex;
            flex-direction: column;
            gap: 5px;
            pointer-events: auto; 
        }
        
        .hud-box {
            background: rgba(0, 0, 0, 0.6);
            border: 1px solid rgba(0, 234, 255, 0.3);
            padding: 8px 15px;
            border-radius: 5px;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 0 10px rgba(0, 234, 255, 0.1);
        }

        .hud-btn {
            pointer-events: auto; 
            cursor: pointer;
            transition: 0.2s;
            justify-content: center;
            width: 100%;
            padding: 5px 15px;
            font-size: 1rem;
        }
        .hud-btn:active {
            background: #00eaff;
            color: #000;
        }

        .life-bar-wrap {
            width: 120px; height: 12px;
            background: #222; border: 1px solid #555;
            transform: skewX(-20deg);
            overflow: hidden;
            position: relative;
        }
        .life-bar-fill {
            width: 100%; height: 100%;
            background: linear-gradient(90deg, #ff0000, #ff6600);
            box-shadow: 0 0 10px #ff0000;
            transition: width 0.3s;
        }

        /* --- BOSS HUD --- */
        #boss-hud {
            position: absolute;
            top: 60px;
            left: 50%;
            transform: translateX(-50%);
            width: 60%;
            z-index: 29;
            display: none;
            flex-direction: column;
            align-items: center;
        }
        #boss-name {
            color: #ff0000;
            text-shadow: 0 0 5px #000;
            font-size: 1rem;
            margin-bottom: 2px;
            text-transform: uppercase;
            font-weight: bold;
        }
        #boss-life-bar-wrap {
            width: 100%; height: 15px;
            background: #222; border: 2px solid #fff;
            box-shadow: 0 0 15px rgba(255,0,0,0.5);
        }
        #boss-life-fill {
            width: 100%; height: 100%;
            background: linear-gradient(90deg, #800080, #ff0000);
            transition: width 0.2s;
        }

        /* --- DIALOGUE UI --- */
        #dialogue-screen {
            z-index: 45; /* Below pause, above game */
            background: rgba(0,0,0,0.3);
            justify-content: flex-end;
            padding-bottom: 20px;
        }
        .dialogue-box {
            width: 95%;
            max-width: 600px;
            background: rgba(10, 15, 30, 0.95);
            border: 2px solid #00eaff;
            border-radius: 10px;
            padding: 15px;
            display: flex;
            align-items: center;
            gap: 15px;
            box-shadow: 0 0 30px rgba(0, 234, 255, 0.4);
            animation: slideUp 0.3s ease-out;
            position: relative;
            margin-bottom: 50px;
        }
        @keyframes slideUp { from{transform: translateY(100px); opacity:0;} to{transform: translateY(0); opacity:1;} }
        
        .char-portrait {
            width: 70px; height: 70px;
            border-radius: 5px;
            border: 2px solid #fff;
            object-fit: cover;
            background: #000;
        }
        .char-portrait.active { border-color: #ffd700; box-shadow: 0 0 10px #ffd700; }
        
        .dialogue-content {
            flex: 1;
            font-family: 'Rajdhani', sans-serif;
        }
        .speaker-name {
            color: #ffd700;
            font-weight: bold;
            font-size: 1.1rem;
            text-transform: uppercase;
            margin-bottom: 5px;
        }
        .dialogue-text {
            color: #fff;
            font-size: 1rem;
            line-height: 1.2;
        }
        .tap-continue {
            position: absolute;
            bottom: 5px; right: 10px;
            font-size: 0.7rem;
            color: #aaa;
            animation: blink 1s infinite;
        }
        @keyframes blink { 50% { opacity: 0.3; } }

        /* --- TELAS ESPEC√çFICAS / ROLAGEM --- */
        
        .selection-container {
            z-index: 2; 
            text-align: center; 
            width: 90%; 
            max-width: 600px;
            height: 90%; 
            display: flex;
            flex-direction: column;
            padding-top: 20px;
            padding-bottom: 20px;
        }

        .hero-grid, .story-scroll {
            touch-action: pan-y !important;
            user-select: text !important;
            -webkit-user-select: text !important;
        }

        .hero-grid {
            display: flex; gap: 15px; flex-wrap: wrap; justify-content: center;
            max-height: 55vh; 
            overflow-y: auto; 
            padding: 10px;
            margin: 10px 0;
            border: 1px solid rgba(0, 234, 255, 0.2);
            background: rgba(0, 0, 0, 0.5);
            scrollbar-color: #00eaff #333;
            scrollbar-width: thin;
        }

        .hero-card {
            width: 100px; background: rgba(0,0,0,0.8);
            border: 1px solid #444; border-radius: 8px;
            padding: 10px; text-align: center;
            cursor: pointer; position: relative;
            transition: all 0.2s;
        }
        
        .hero-card.selected { border-color: #00eaff; box-shadow: 0 0 15px rgba(0, 234, 255, 0.6); }
        .hero-card img { width: 60px; height: 60px; border-radius: 50%; object-fit: cover; border: 2px solid #fff; }
        
        #scenario-list-container .hero-card {
            width: 120px;
            height: 120px;
            padding: 5px;
        }
        #scenario-list-container .hero-card img {
            width: 100%;
            height: 70px;
            border-radius: 5px;
            object-fit: cover;
            border: 1px solid #fff;
        }
        
        .story-container {
            display: flex;
            flex-direction: column;
            height: 90%;
            width: 90%;
            max-width: 500px;
            background: rgba(10,10,20,0.95);
            border: 2px solid #00eaff;
            box-shadow: 0 0 30px rgba(0, 234, 255, 0.2);
            border-radius: 10px;
            overflow: hidden;
        }
        
        .story-scroll {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            text-align: justify;
        }

        .modal-content-buy {
            max-width: 400px; 
            height: auto; 
            background: rgba(10, 10, 30, 0.95); 
            border: 3px solid #ffd700; 
            border-radius: 10px; 
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.5); 
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 90%;
        }

        .modal-hero-card {
            width: 150px; 
            height: 150px; 
            margin-bottom: 15px; 
            border-radius: 10px; 
            overflow: hidden; 
            border: 3px solid #fff; 
            box-shadow: 0 0 20px #00eaff;
            background-color: #333;
        }

        .floating-currency {
            position: absolute;
            color: #ffd700;
            font-weight: bold;
            font-size: 1.5rem;
            animation: floatUp 1s forwards;
            pointer-events: none;
            z-index: 100;
            text-shadow: 0 0 5px #000;
        }

        @keyframes floatUp { from{transform: translateY(0); opacity:1;} to{transform: translateY(-50px); opacity:0;} }
        
        /* --- TELA DE SCORE --- */
        #score-screen {
            background-size: cover;
            background-position: center;
            z-index: 60;
            justify-content: flex-start;
            padding-top: 50px;
        }
        
        #score-screen h2 {
            font-size: 2.5rem;
            color: #ffd700;
            text-shadow: 0 0 15px #ffd700;
            margin-bottom: 30px;
        }
        
        #score-data-box {
            background: rgba(10, 20, 40, 0.9);
            border: 3px solid #00eaff;
            box-shadow: 0 0 25px rgba(0, 234, 255, 0.5);
            padding: 25px;
            border-radius: 10px;
            width: 90%;
            max-width: 450px;
            text-align: left;
            position: relative;
            overflow: hidden;
        }
        
        .data-line {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px dashed rgba(0, 234, 255, 0.3);
            font-family: 'Rajdhani', sans-serif;
            font-size: 1.2rem;
        }
        .data-line:last-child {
            border-bottom: none;
        }
        
        .data-label {
            color: #00eaff;
            font-weight: 700;
            letter-spacing: 1px;
        }
        
        .data-value {
            color: #fff;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        #record-hero-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 2px solid #ffd700;
            object-fit: cover;
        }

        /* Glitch Effects */
        .glitch-effect::before, .glitch-effect::after {
            content: attr(data-text);
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: inherit; pointer-events: none;
        }
        .glitch-effect { position: relative; animation: glitch 2s linear infinite; }
        @keyframes glitch {
            0% { transform: translate(0); }
            20% { transform: translate(-3px, 3px); }
            40% { transform: translate(-3px, -3px); }
            60% { transform: translate(3px, 3px); }
            80% { transform: translate(3px, -3px); }
            100% { transform: translate(0); }
        }
        .glitch-effect::before {
            left: 2px; text-shadow: -2px 0 #ff00c1; clip-path: inset(60% 0 0 0);
            animation: glitch-anim 5s infinite linear alternate-reverse;
        }
        .glitch-effect::after {
            left: -2px; text-shadow: -2px 0 #00eaff; clip-path: inset(0 0 60% 0);
            animation: glitch-anim-2 3s infinite linear alternate-reverse;
        }
        @keyframes glitch-anim {
            0% { clip-path: inset(20% 0 70% 0); }
            50% { clip-path: inset(50% 0 40% 0); }
            100% { clip-path: inset(10% 0 80% 0); }
        }
        @keyframes glitch-anim-2 {
            0% { clip-path: inset(30% 0 60% 0); }
            50% { clip-path: inset(60% 0 30% 0); }
            100% { clip-path: inset(0 0 90% 0); }
        }
        
        /* BATTLE VICTORY TEXT */
        .battle-victory-text {
            position: absolute;
            top: 40%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            font-size: 4rem;
            color: #ffd700;
            font-weight: 900;
            text-shadow: 0 0 20px gold;
            z-index: 40;
            animation: popIn 0.5s forwards;
            pointer-events: none;
        }
        @keyframes popIn { 0%{transform: translate(-50%,-50%) scale(0);} 80%{transform: translate(-50%,-50%) scale(1.2);} 100%{transform: translate(-50%,-50%) scale(1);} }

    </style>
</head>
<body>

<div id="game-wrapper">
    <div class="scanlines"></div>

    <canvas id="bgCanvas"></canvas>
    <canvas id="gameCanvas"></canvas>

    <div id="hero-layer" class="entity-layer hidden">
        <img id="hero-sprite" class="sprite-img" src="" alt="Hero">
    </div>

    <div id="boss-layer" class="entity-layer hidden">
        <img id="boss-sprite" class="sprite-img" src="" alt="Boss">
    </div>

    <div id="hud" class="hidden">
        <div id="hud-left-container"> 
            <div class="hud-box" style="pointer-events: none;">
                <span style="font-size: 1.2rem;">‚ù§Ô∏è</span>
                <div class="life-bar-wrap"><div id="life-fill" class="life-bar-fill"></div></div>
            </div>
            <div class="hud-box" style="color: #ffd700; pointer-events: none;">
                <span>ü™ô</span> <span id="hud-coins">0</span>
            </div>
            <div id="pause-btn-hud" class="hud-box hud-btn" style="border-color: #fff;">
                <span>‚è∏Ô∏è PAUSE</span>
            </div>
        </div>
        
        <div class="hud-box" style="color: #00eaff; pointer-events: none;">
            <span>DIST:</span> <span id="hud-score">0</span>m
        </div>
    </div>
    
    <div id="boss-hud">
        <div id="boss-name">INIMIGO</div>
        <div id="boss-life-bar-wrap">
            <div id="boss-life-fill"></div>
        </div>
    </div>

    <div id="dialogue-screen" class="screen hidden" style="background: transparent;">
        <div class="dialogue-box">
            <img id="d-left-img" class="char-portrait" src="">
            <div class="dialogue-content">
                <div id="d-speaker" class="speaker-name">Hero Name</div>
                <div id="d-text" class="dialogue-text">...</div>
                <div class="tap-continue">Toque para continuar >></div>
            </div>
            <img id="d-right-img" class="char-portrait" src="">
        </div>
    </div>

    <div id="menu-screen" class="screen" style="background-image: url('https://wallpapers.com/images/hd/dark-superman-superhero-iphone-m2jk0xvpaxiyoyua.jpg'); background-size: cover; background-position: center;">
        <div style="background: rgba(0,0,0,0.7); position:absolute; inset:0;"></div>
        <div class="selection-container" style="justify-content: center;">
            <h1 data-text="SuperSky Storm" class="glitch-effect">SuperSky<br>Storm</h1>
            <p style="color:#aaa; margin-top:-10px; letter-spacing:4px; font-size:0.8rem; margin-bottom: 30px;">MOBILE 3D BOSS EDITION v7.3</p>
            
            <button class="btn" onclick="UI.showStory()">üìñ Hist√≥ria</button>
            <button class="btn" onclick="UI.showScoreScreen()">üèÜ Score</button>
            <button class="btn" onclick="UI.showHeroSelect()">üöÄ JOGAR</button>
            
            <div style="margin-top: 30px; color: #ffd700; font-size: 1.2rem; text-shadow: 0 0 10px gold;">
                ü™ô Banco: <span id="menu-total-coins">0</span> | üíé <span id="menu-total-gems">0</span>
            </div>
        </div>
    </div>
    
    <div id="score-screen" class="screen hidden" style="background-image: url('https://media1.tenor.com/m/axi9xVrR8goAAAAd/dragon-ball-dragon-ball-z.gif');">
        <div style="background: rgba(0,0,0,0.7); position:absolute; inset:0;"></div>
        <div class="selection-container" style="justify-content: flex-start;">
            <h2 data-text="DADOS DO PILOTO" class="glitch-effect">DADOS DO PILOTO</h2>
            <div id="score-data-box">
                <div class="data-line">
                    <span class="data-label">ü™ô Moedas Acumuladas:</span>
                    <span class="data-value" id="score-total-coins">0</span>
                </div>
                <div class="data-line" style="border-bottom: 3px solid #ffd700;">
                    <span class="data-label">üèÜ RECORDE M√ÅXIMO:</span>
                    <span class="data-value" style="color: #ffd700; font-size: 1.5rem;" id="score-high-score">0m</span>
                </div>
                <div class="data-line">
                    <span class="data-label">Her√≥i do Recorde:</span>
                    <span class="data-value">
                        <img id="record-hero-icon" src="" alt="Hero Icon">
                        <span id="score-record-hero-name">N/A</span>
                    </span>
                </div>
                <div class="data-line">
                    <span class="data-label">√öltima Partida (DIST):</span>
                    <span class="data-value" id="score-last-score">0m</span>
                </div>
                <div class="data-line">
                    <span class="data-label">√öltima Partida (COINS):</span>
                    <span class="data-value" id="score-last-coins">0 ü™ô</span>
                </div>
            </div>
            <button class="btn" onclick="UI.showMenu()" style="margin-top: 30px; background:#333; border-color:#666;">VOLTAR AO MENU</button>
        </div>
    </div>
    
    <div id="story-screen" class="screen hidden">
        <div class="story-container">
            <div class="story-scroll">
                <h2>O Chamado</h2>
                <img src="https://fightersgeneration.com/characters4/superman-ending1.png" style="width:100%; border-radius:5px; border:1px solid #555; margin-bottom: 15px;">
                <p style="font-family:'Rajdhani',sans-serif; font-size:1.1rem; line-height:1.5; color:#ddd;">
                    "H√° uma amea√ßa jamais vista. A anomalia est√° nos c√©us. Somente her√≥is capazes de voar podem ultrapassar a tempestade."
                </p>
                <div style="background:#1a1a2e; padding:15px; border-left:4px solid #00eaff; margin-top:20px; border-radius: 5px;">
                    <strong style="color: #00eaff; font-size: 1.2rem;">üéÆ COMO JOGAR:</strong><br><br>
                    1. <strong>Deslize o dedo</strong> para mover para CIMA/BAIXO.<br>
                    2. Desvie dos canos e colete moedas ü™ô.<br>
                    3. <strong>A CADA 500M:</strong> Enfrente um Chefe!<br>
                    4. No modo chefe: <strong>TOQUE REPETIDAMENTE</strong> na tela para atirar poderes. Ven√ßa para restaurar a vida e ganhar 50 moedas!
                </div>
            </div>
            <div class="story-footer">
                <button class="btn" onclick="UI.showMenu()" style="width:100%; margin:0;">VOLTAR AO MENU</button>
            </div>
        </div>
    </div>

    <div id="hero-select-screen" class="screen hidden" style="background-image: url('https://w0.peakpx.com/wallpaper/593/223/HD-wallpaper-superman-vs-goku-dragoonball-goku-marvel-superman.jpg'); background-size: cover; background-position: center;">
        <div style="background: rgba(0,0,0,0.7); position:absolute; inset:0;"></div>
        <div class="selection-container">
            <h2>Escolher Her√≥i</h2>
            <div class="hero-grid" id="hero-list-container">
                </div>
            <div id="hero-details" style="height: 50px; color: #00eaff; margin: 10px 0; font-style: italic; text-align: center;"></div>
            <div style="width: 100%; text-align: center;">
                <button class="btn" onclick="UI.showSkinSelect(Game.selectedBaseId)">SELECIONAR SKINS</button>
                <button class="btn" onclick="UI.showMenu()" style="background:#333; border-color:#666;">VOLTAR</button>
            </div>
        </div>
    </div>
    
    <div id="skin-select-screen" class="screen hidden" style="background-image: url('https://w0.peakpx.com/wallpaper/593/223/HD-wallpaper-superman-vs-goku-dragoonball-goku-marvel-superman.jpg'); background-size: cover; background-position: center;">
        <div style="background: rgba(0,0,0,0.7); position:absolute; inset:0;"></div>
        <div class="selection-container">
            <h2 id="skin-select-title">Skins de Her√≥i</h2>
            <div class="hero-grid" id="skin-list-container" style="max-height: 50vh;">
                </div>
            <div id="skin-details" style="height: 50px; color: #00eaff; margin: 10px 0; font-style: italic; text-align: center;"></div>
            <div style="width: 100%; text-align: center;">
                <button class="btn" onclick="Game.preStartIntro()">INICIAR MISS√ÉO >></button>
                <button class="btn" onclick="UI.showHeroSelect()" style="background:#333; border-color:#666;">VOLTAR PARA HER√ìIS</button>
            </div>
        </div>
    </div>

    <div id="intro-screen" class="screen hidden" style="background:#000;">
        <h2 id="intro-name" style="font-size:2rem; margin-top: 0;">HER√ìI</h2>
        <img id="intro-img" src="" style="max-width:85%; max-height:40vh; border:2px solid #00eaff; box-shadow:0 0 20px #00eaff; border-radius: 10px;">
        <p id="intro-quote" style="color:#fff; font-style:italic; font-family:'Rajdhani'; font-size:1.4rem; margin:20px; text-align:center; padding: 0 20px;">"..."</p>
        <button class="btn" onclick="UI.showScenarioSelect()">INICIAR MISS√ÉO >></button>
    </div>

    <div id="scenario-select-screen" class="screen hidden" style="background-image: url('https://w0.peakpx.com/wallpaper/593/223/HD-wallpaper-superman-vs-goku-dragoonball-goku-marvel-superman.jpg'); background-size: cover; background-position: center;">
        <div style="background: rgba(0,0,0,0.7); position:absolute; inset:0;"></div>
        <div class="selection-container">
            <h2>Selecione o Cen√°rio</h2>
            <p style="color:#ddd;">Escolha o mapa onde deseja iniciar a miss√£o!</p>
            <div class="hero-grid" id="scenario-list-container" style="max-height: 50vh;"></div>
            <div style="width: 100%; text-align: center;">
                <button class="btn" onclick="Game.selectScenarioAndStart()">INICIAR PARTIDA</button>
                <button class="btn" onclick="UI.showHeroSelect()" style="background:#333; border-color:#666;">VOLTAR</button>
            </div>
        </div>
    </div>

    <div id="buy-hero-screen" class="screen hidden" style="z-index: 100;">
        <div class="modal-content-buy">
            <div id="buy-hero-card" class="modal-hero-card">
                <img id="buy-hero-img" src="" style="width: 100%; height: 100%; object-fit: cover;">
            </div>
            <h2 id="buy-hero-name" style="margin-top: 0; color: #ffd700;">Comprar Her√≥i</h2>
            <p id="buy-hero-cost" style="color:#ffd700; font-size: 1.8rem; font-weight: bold; margin-bottom: 20px;"></p>
            <p style="color:#ddd; font-family: 'Rajdhani', sans-serif;">Seu banco atual: <span id="current-player-coins" style="font-weight: bold; color: white;">0</span> ü™ô</p>
            <button class="btn" id="confirm-buy-btn" onclick="Game.buyHero(true)" style="background: #0088ff; border-color: #00eaff; max-width: 250px;">
                CONFIRMAR COMPRA
            </button>
            <button class="btn" onclick="Game.buyHero(false)" style="background: #555; border-color: #999; max-width: 250px;">
                N√ÉO COMPRAR (VOLTAR)
            </button>
        </div>
    </div>

    <div id="pause-screen" class="screen hidden">
        <h1 style="color: #fff; text-shadow: 0 0 30px white; margin-bottom: 20px;">PAUSADO</h1>
        <div style="background:rgba(0, 20, 40, 0.9); padding:30px; border-radius:15px; text-align:center; min-width:280px; border: 1px solid #00eaff; box-shadow: 0 0 20px rgba(0,234,255,0.3);">
            <p style="color: #00eaff; margin-bottom: 20px; letter-spacing: 2px;">JOGO INTERROMPIDO</p>
            <button class="btn" onclick="Game.togglePause()">‚ñ∂ Continuar</button>
            <button class="btn" onclick="Game.quitToMenu()" style="border-color:#555; background: #222;">Menu Principal</button>
        </div>
    </div>

    <div id="game-over-screen" class="screen hidden">
        <h1 style="color: #ff3333; text-shadow: 0 0 30px red; margin-bottom: 20px;">FIM DE JOGO</h1>
        <div style="background:rgba(20, 0, 0, 0.9); padding:30px; border-radius:15px; text-align:center; min-width:280px; border: 1px solid #ff3333;">
            <h3 style="font-size: 1.5rem; margin: 10px 0;">Score: <span id="go-score" style="color: #fff;">0</span>m</h3>
            <p style="font-size: 1.2rem;">Coletou: <span id="go-coins" style="color:#ffd700; font-weight: bold;">0</span> ü™ô</p>
            <hr style="border-color:#555; margin: 20px 0;">
            <button class="btn" onclick="Game.selectScenarioAndStart()">Jogar Novamente</button>
            <button class="btn" onclick="UI.showMenu()" style="border-color:#fff; background: #333;">Menu Principal</button>
        </div>
    </div>
</div>

<script>
/**
 * SUPERSKY STORM - GAME ENGINE
 * v7.3 - BOSS VISIBILITY FIXED & TURBO MODE
 * * Fix: Removed 'hidden' class from boss layer on spawn to ensure visibility.
 * * Update: Increased base game speed and acceleration multiplier.
 */

// --- 1. DADOS E ASSETS ---

const SCENARIOS = [
    { id: 'metropolis', name: 'Metr√≥polis (Cl√°ssico)', url: 'https://static.dc.com/sites/default/files/imce/2020/07-JUL/DCU_Rewards_Metropolis_mobile_5f2b1a821856b1.02231681.jpg' },
    { id: 'dark', name: 'Terra Sombria', url: 'https://i.pinimg.com/736x/6f/4d/73/6f4d73d1afc0702a6e9d31f36d1628bc.jpg' },
    { id: 'xmen', name: 'Mans√£o dos X-men', url: 'https://i.pinimg.com/736x/97/50/b2/9750b2f6780d3913b5d32e63f55f80e9.jpg' },
    { id: 'stark', name: 'Ind√∫strias Stark', url: 'https://i.pinimg.com/736x/c8/02/b5/c802b556cc109644eca6abb38ae956b7.jpg' },
    { id: 'avengers', name: 'Torre dos Vingadores', url: 'https://i.pinimg.com/736x/b8/83/79/b88379c2ae51b92ecaa14565df5ee5f8.jpg' },
    { id: 'fantastic', name: 'Quarteto Fant√°stico', url: 'https://ovicio.com.br/wp-content/uploads/2021/11/20211123-20211123_155828.jpg' },
    { id: 'gotham', name: 'Gotham City', url: 'https://wallpapers.com/images/hd/gotham-city-s-majestic-night-skyline-y6pgq0uhj8alz8ee.jpg' }, 
    { id: 'arkham', name: 'Arkham City', url: 'https://i.pinimg.com/474x/83/3f/f7/833ff7c1507e0e071cb1eba621d250b0.jpg' }, 
];

const HEROES_SKINS = [
    // --- Superman Skins ---
    { id: 'superman', baseId: 'superman', name: 'Superman', icon: 'https://i.pinimg.com/736x/74/b2/32/74b2321f802fe401f3796beb9cdbcac3.jpg', introGif: 'https://i.pinimg.com/originals/e5/69/0b/e5690bcfc9237a95809211f94ae1bae2.gif', gameGif: 'https://fightersgeneration.com/news2024/char3/superman-fly2.gif', quote: "Vou salvar esse planeta!", price: 0, color: '#0055ff', flip: false, isBase: true },
    { id: 'superman-3d', baseId: 'superman', name: 'Superman (3D)', icon: 'https://media1.giphy.com/media/v1.Y2lkPTZjMDliOTUycm51ZHY3cGbidTgydjFyZWVjaTRvZjl5Ym5uaGwyYnZzZGd0M3pnMCZlcD12MV9zdGlja2Vyc19zZWFyY2gmY3Q9cw/2eh0ovwcQQK2I/source.gif', introGif: 'https://media1.giphy.com/media/v1.Y2lkPTZjMDliOTUycm51ZHY3cGbidTgydjFyZWVjaTRvZjl5Ym5uaGwyYnZzZGd0M3pnMCZlcD12MV9zdGlja2Vyc19zZWFyY2gmY3Q9cw/2eh0ovwcQQK2I/source.gif', gameGif: 'https://media1.giphy.com/media/v1.Y2lkPTZjMDliOTUycm51ZHY3cGbidTgydjFyZWVjaTRvZjl5Ym5uaGwyYnZzZGd0M3pnMCZlcH12MV9zdGlja2Vyc19zZWFyY2gmY3Q9cw/2eh0ovwcQQK2I/source.gif', quote: "Para o alto e avante!", price: 200, color: '#ff0000', flip: false },
    { id: 'superman-aura', baseId: 'superman', name: 'Superman (God Mode)', icon: 'https://media.tenor.com/usR36FKXKpcAAAAj/superman-pose.gif', introGif: 'https://media.tenor.com/usR36FKXKpcAAAAj/superman-pose.gif', gameGif: 'https://media.tenor.com/usR36FKXKpcAAAAj/superman-pose.gif', quote: "O poder absoluto...", price: 350, color: '#00eaff', flip: false, effects: 'energy' },

    // --- Goku Skins ---
    { id: 'goku-base', baseId: 'goku', name: 'Goku (Base)', icon: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTTUmXCNutPvgP7yfhMakZ8375gOw5IVNMYrKHQZptbnJ0OV6i2Grxl2bOj&s=10', introGif: 'https://c.tenor.com/egxm_ajg8hgAAAAC/tenor.gif', gameGif: 'https://media.tenor.com/TZtbuPmwdjEAAAAj/super-saiyan-goku.gif', quote: "Oi, eu sou Goku! Vamos lutar!", price: 0, color: '#ffaa00', flip: false, isBase: true },
    { id: 'goku-ssj', baseId: 'goku', name: 'Goku (SSJ)', icon: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcT7DaK39F4n8RH-OXU5WjzN9Oyett2QwUwv6gTVzb15av_mkCuRJZpLVns&s=10', introGif: 'https://giffiles.alphacoders.com/128/12897.gif', gameGif: 'https://media0.giphy.com/media/v1.Y2lkPTZjMDliOTUybGF2dHJ6a2pyYWR4dG04ZTRyYWM5Zjg4ZXlkeWxmZm80d3NxdzRneSZlcH12MV9zdGlja2Vyc19zZWFyY2gmY3Q9cw/11pR7Vr26lokVi/200w.gif', quote: "Esse √© o Super Sayajin!", price: 0, color: '#ffaa00', flip: false },
    { id: 'goku-ssj3', baseId: 'goku', name: 'Goku (SSJ3)', icon: 'https://images2.alphacoders.com/931/thumb-1920-931698.png', introGif: 'https://media.tenor.com/JSGEAioyUDwAAAAM/super-saiyan-3-dragon-ball-daima.gif', gameGif: 'https://64.media.tumblr.com/112f45b9b18361664e5e4d9b43485d58/tumblr_mwn53e5eHn1rfjowdo1_500.gif', quote: "E este... √â O SUPER SAIYAJIN 3!", price: 0, color: '#ffd700', flip: true, effects: 'thunder' },
    { id: 'goku-ultra', baseId: 'goku', name: 'Goku (Ultra)', icon: 'https://i.pinimg.com/736x/ba/86/df/ba86df6c7759929df8351c60b6e5de23.jpg', introGif: 'https://giffiles.alphacoders.com/150/15009.gif', gameGif: 'https://static.wikia.nocookie.net/dbz-dokkanbattle/images/8/85/1487781835.737animation3.gif/revision/latest/scale-to-width-down/426?cb=20170222164551', quote: "Instinto Superior...", price: 0, color: '#c0c0c0', flip: false, effects: 'energy' },
    { id: 'goku-black', baseId: 'goku', name: 'Goku Black', icon: 'https://i.pinimg.com/736x/ba/86/df/ba86df6c7759929df8351c60b6e5de23.jpg', introGif: 'https://giffiles.alphacoders.com/150/15009.gif', gameGif: 'https://media.tenor.com/pgzBjENuoHoAAAAj/dragonball-sprite.gif', quote: "Eu sou um Deus!", price: 200, color: '#ff00ff', flip: true, effects: 'energy' },

    // --- Vegeta Skins ---
    { id: 'vegeta', baseId: 'vegeta', name: 'Vegeta (SSJ)', icon: 'https://i.pinimg.com/736x/7d/31/85/7d3185a92cca10392b5e9a2130a1736b.jpg', introGif: 'https://i.pinimg.com/originals/1a/64/b6/1a64b6478237b189d0eef10ff5f2a412.gif', gameGif: 'https://media.invisioncic.com/z328913/monthly_2023_10/578269654_VegetaSSJ2.thumb.gif.4d9d10425c0658f3ddd7f291b1b7cdbf.gif', quote: "Insetos!", price: 100, color: '#ff9900', flip: false, isBase: true },
    { id: 'vegeta-explosao', baseId: 'vegeta', name: 'Vegeta (Explos√£o)', icon: 'https://lh3.googleusercontent.com/proxy/PWPgqkLu78CMMbO6K1yRqI-TSwqVT6wgZoKKwOAvnEueJyb6Q45mxYMqkSSrK2POlVxWOlY6u38f7hW5bdq9s8BfelpM_9i_HWRf', introGif: 'https://i.pinimg.com/originals/1a/64/b6/1a64b6478237b189d0eef10ff5f2a412.gif', gameGif: 'https://lh3.googleusercontent.com/proxy/PWPgqkLu78CMMbO6K1yRqI-TSwqVT6wgZoKKwOAvnEueJyb6Q45mxYMqkSSrK2POlVxWOlY6u38f7hW5bdq9s8BfelpM_9i_HWRf', quote: "Adeus, Bulma...", price: 50, color: '#ff0000', flip: false },

    // --- Others ---
    { id: 'freeza', baseId: 'freeza', name: 'Freeza', icon: 'https://ovicio.com.br/wp-content/uploads/2020/02/20200226-v-dragon-ball-super-broly-freeza-1210x540-1-555x555.jpg', introGif: 'https://pa1.aminoapps.com/6694/59b74f10e5b72ba7ac3ffdc036ea414ef9aaa7c9_hq.gif', gameGif: 'https://img.atwiki.jp/niconicomugen/attach/276/21934/extreme butoden neutral.gif', quote: "Voc√™s s√£o t√£o pat√©ticos...", price: 200, color: '#800080', flip: false, isBase: true, effects: 'energy' },
    { id: 'doom', baseId: 'doom', name: 'Doutor Destino', icon: 'https://i.pinimg.com/736x/16/56/32/1656323ddec34a5932c199c89c46cc15.jpg', introGif: 'https://cdn.ome.lt/omelete/stories/vingadores-doomsday-todos-os-personagens/assets/1ae73ddd-ad1c-40c5-9377-7441bb628812', gameGif: 'https://www.fightersgeneration.com/characters/drdroom-nebulaswing.gif', quote: "O destino de tudo e de todos, ABSOLUTO!", price: 300, color: '#006400', flip: false, isBase: true },
    { id: 'lex', baseId: 'lex', name: 'Lex Luthor', icon: 'https://pbs.twimg.com/media/G5Z_EPVXYAAxYwi.jpg', introGif: 'https://i.makeagif.com/media/11-03-2015/J25XPg.gif', gameGif: 'https://media.invisioncic.com/z328913/monthly_2018_02/0.gif.2420de4ca5f3f5dd3ee46361b7ac5882.gif', quote: "Estou no t√©dio, acho que vou comprar a sua m√£e.", price: 100, color: '#00ff00', flip: false, isBase: true },
    { id: 'trunks', baseId: 'trunks', name: 'Trunks', icon: 'https://i.pinimg.com/736x/1f/1d/c9/1f1dc91f212d78dd7a306378a83d9246.jpg', introGif: 'https://giffiles.alphacoders.com/241/2411.gif', gameGif: 'https://images-wixmp-ed30a86b8c4ca887773594c2.wixmp.com/f/8438f7cf-b38d-43ee-9132-256eade283cf/dbqwc3h-952dbae9-1ebf-4e18-a783-b01f796e0822.gif', quote: "Vou exilar a maldade da terra!", price: 150, color: '#8a2be2', flip: false, isBase: true },
    { id: 'trunks-speed', baseId: 'trunks', name: 'Trunks (Speed)', icon: 'https://i.pinimg.com/736x/1f/1d/c9/1f1dc91f212d78dd7a306378a83d9246.jpg', introGif: 'https://giffiles.alphacoders.com/241/2411.gif', gameGif: 'https://media.tenor.com/fQVV6UEF9SIAAAAj/lsuper-superman049.gif', quote: "Velocidade m√°xima!", price: 100, color: '#ffff00', flip: false },
    { id: 'trunks-3d', baseId: 'trunks', name: 'Trunks (3D)', icon: 'https://i.pinimg.com/736x/1f/1d/c9/1f1dc91f212d78dd7a306378a83d9246.jpg', introGif: 'https://giffiles.alphacoders.com/241/2411.gif', gameGif: 'https://media.tenor.com/Sn0TKg-ZkT8AAAAj/superdbz-superdragonballz.gif', quote: "Dimens√£o Z!", price: 0, color: '#ffaa00', flip: false },
    { id: 'broly', baseId: 'broly', name: 'Broly', icon: 'https://i.pinimg.com/736x/04/ca/2b/04ca2bb399497bf0aa3e7d1b56f3d862.jpg', introGif: 'https://c.tenor.com/WuDX7u6Y_GgAAAAC/tenor.gif', gameGif: 'https://media.invisioncic.com/z328913/monthly_2020_08/BrolyStanding.gif.73cac206a2a862f78762ed5d349e3643.gif', quote: "KAKAROTOOO!!!!", price: 4000, color: '#00ff00', flip: false, isBase: true, effects: 'energy' },
    { id: 'broly-2', baseId: 'broly', name: 'Broly (Power)', icon: 'https://i.pinimg.com/736x/04/ca/2b/04ca2bb399497bf0aa3e7d1b56f3d862.jpg', introGif: 'https://c.tenor.com/WuDX7u6Y_GgAAAAC/tenor.gif', gameGif: 'https://mugen.spriteclub.tv/idles/980.gif', quote: "Poder M√°ximo!", price: 0, color: '#00ff00', flip: false, effects: 'thunder' },
    { id: 'broly-joker', baseId: 'broly', name: 'Broly (Joker)', icon: 'https://i.pinimg.com/736x/04/ca/2b/04ca2bb399497bf0aa3e7d1b56f3d862.jpg', introGif: 'https://c.tenor.com/ympLPo5BGE4AAAAC/tenor.gif', gameGif: 'https://media.invisioncic.com/z328913/monthly_2020_08/Brolywin.gif.6737ea0bc9807da0404bbd967bf31d4f.gif', quote: "Coe, tua m√£e pelada KKKKKKK", price: 100, color: '#800080', flip: false },
    { id: 'batman', baseId: 'batman', name: 'Batman (Armor)', icon: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcR_S2t_bWfT0340GfA2vJj2yF4yH6lJ6b_J_Q&s', introGif: 'https://media.tenor.com/images/4204568910839846356/tenor.gif', gameGif: 'https://media1.giphy.com/media/l0NwGZEOSgX9cW2SQ/200.gif', quote: "Prepare-se para a guerra.", price: 500, color: '#555555', flip: false, isBase: true },
    { id: 'tempestade', baseId: 'tempestade', name: 'Tempestade', icon: 'https://i.pinimg.com/736x/4c/0d/11/4c0d11af1a9389b824b46e5e5f112f00.jpg', introGif: 'https://i.pinimg.com/originals/43/38/3a/43383aef1ea78227f80125efb230a9db.gif', gameGif: 'https://fightersgeneration.com/characters3/storm-better-stance.gif', quote: "A Tempestade Chegou!", price: 50, color: '#00eaff', flip: false, isBase: true },
    { id: 'lanternaverde', baseId: 'lanternaverde', name: 'Lanterna Verde', icon: 'https://i.pinimg.com/564x/91/04/92/910492d42415b1fa36180f1441dcac7f.jpg', introGif: 'https://media.tenor.com/Mg37WCacaLAAAAAM/green-lantern-hal-jordan.gif', gameGif: 'https://i.servimg.com/u/f10/19/38/77/60/hal_jo10.gif', quote: "No dia mais claro, na noite mais densa...", price: 100, color: '#00ff00', flip: false, isBase: true },
    { id: 'homemdeferro', baseId: 'homemdeferro', name: 'Homem de Ferro', icon: 'https://i.pinimg.com/474x/0c/82/78/0c8278c0ed15c36b6271abc18b9ab0da.jpg', introGif: 'https://media.tenor.com/sXxntLyP89IAAAAM/iron-man-tony-stark.gif', gameGif: 'https://media1.giphy.com/media/v1.Y2lkPTZjMDliOTUycnppbzUwMXN1MnBnOHF2dm1vaXM3Mzh4YWxvM3dtMHN4dXZwbXl1MCZlcH12MV9zdGlja2Vyc19zZWFyY2gmY3Q9cw/nlxhDPecazKtW/200.gif', quote: "O dinheiro compra tudo?", price: 50, color: '#ff0000', flip: false, isBase: true },
    { id: 'batwing', baseId: 'batwing', name: 'Batwing', icon: 'https://64.media.tumblr.com/2917726903d4d1c02d5a355f5e3ced18/25c2d685830837a2-42/s640x960/5d4640203d21829d78bb3d6d4e74dd4aea3d77bb.jpg', introGif: 'https://i.pinimg.com/originals/18/81/e0/1881e058ebaaf8365b40955b7438a91f.gif', gameGif: 'https://static.wikia.nocookie.net/deathbattlefanon/images/f/f4/Batwing_Power_Rangers.png/revision/latest?cb=20210325180326', quote: "T√¥ na √°rea!", price: 150, color: '#4b0082', flip: false, isBase: true },
    { id: 'magneto', baseId: 'magneto', name: 'Magneto', icon: 'https://i.pinimg.com/736x/b6/06/43/b60643ff5dcc88b39393a430c2b7d408.jpg', introGif: 'https://media.tenor.com/nuPxTx96Mw0AAAAM/putting-on-my-helmet-magneto.gif', gameGif: 'https://www.fightersgeneration.com/characters2/magneto-tense.gif', quote: "Os Mutantes s√£o superiores.", price: 200, color: '#ff0000', flip: false, isBase: true },
    { id: 'akuma', baseId: 'akuma', name: 'Akuma', icon: 'https://pbs.twimg.com/media/GN-w5TRW8AEzx27.jpg', introGif: 'https://www.fightersgeneration.com/news2022/char3/akuma-tekken7-gif.gif', gameGif: 'https://www.fightersgeneration.com/characters/akuma-snkwin.gif', quote: "O Pr√≥prio Diabo...", price: 500, color: '#550000', flip: false, isBase: true },
];

const DIALOGUES = {
    start: [
        "Parece que seu v√¥o termina aqui!",
        "Saia do meu caminho ou sofra as consequ√™ncias.",
        "Finalmente, um oponente digno!",
        "Voc√™ n√£o vai passar daqui!",
        "Mostre-me do que √© capaz!",
        "Sua velocidade n√£o ser√° suficiente.",
        "Acha que pode me derrotar?",
        "Hoje √© o dia da sua queda!"
    ],
    response: [
        "Vou acabar com voc√™ num piscar de olhos!",
        "N√£o me fa√ßa rir, saia da frente!",
        "Tente me parar se puder!",
        "Isso vai ser r√°pido.",
        "Eu protejo este c√©u!",
        "Sua arrog√¢ncia ser√° sua ru√≠na.",
        "Vamos ver quem √© mais forte!",
        "Prepare-se!"
    ]
};

let PlayerData = {
    coins: 100,
    gems: 5,
    unlocked: ['superman', 'goku-base', 'goku-ssj', 'goku-ssj3', 'goku-ultra', 'trunks-3d', 'broly-2'], 
    highScore: 0,
    highScoreHeroId: 'superman',
    lastScore: 0,
    lastCoins: 0
};

// --- 2. SISTEMA DE √ÅUDIO ---
const AudioSys = {
    ctx: null,
    init: function() {
        if (!this.ctx) {
            this.ctx = new (window.AudioContext || window.webkitAudioContext)();
        }
    },
    playTone: function(freq, type, duration, vol=0.1) {
        if(!this.ctx) return;
        if(this.ctx.state === 'suspended') this.ctx.resume();
        const osc = this.ctx.createOscillator();
        const gain = this.ctx.createGain();
        osc.type = type;
        osc.frequency.setValueAtTime(freq, this.ctx.currentTime);
        gain.gain.setValueAtTime(vol, this.ctx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.01, this.ctx.currentTime + duration);
        osc.connect(gain);
        gain.connect(this.ctx.destination);
        osc.start();
        osc.stop(this.ctx.currentTime + duration);
    },
    sfxCoin: function() { 
        this.playTone(1200, 'sine', 0.1, 0.1); 
        setTimeout(()=>this.playTone(1800, 'sine', 0.2, 0.1), 50); 
    },
    sfxHit: function() { 
        this.playTone(100, 'sawtooth', 0.3, 0.2); 
    },
    sfxClick: function() { 
        this.playTone(880, 'sine', 0.05, 0.1); 
    },
    sfxShoot: function() {
        this.playTone(400, 'square', 0.1, 0.05);
        this.playTone(200, 'sawtooth', 0.1, 0.05);
    },
    sfxExplosion: function() {
        this.playTone(100, 'sawtooth', 0.5, 0.3);
    },
    sfxWin: function() {
        this.playTone(500, 'sine', 0.1, 0.2);
        setTimeout(()=>this.playTone(600, 'sine', 0.1, 0.2), 100);
        setTimeout(()=>this.playTone(800, 'sine', 0.4, 0.2), 200);
    }
};

// --- 3. GERENCIADOR DE UI ---
const UI = {
    screens: document.querySelectorAll('.screen'),
    
    hideAll: function() {
        this.screens.forEach(s => s.classList.add('hidden'));
        document.getElementById('hud').classList.add('hidden');
        document.getElementById('hero-layer').classList.add('hidden');
        document.getElementById('boss-layer').style.display = 'none';
        document.getElementById('boss-hud').style.display = 'none';
    },
    
    showMenu: function() {
        this.hideAll();
        document.getElementById('menu-screen').classList.remove('hidden');
        this.updateStats();
    },
    
    showStory: function() {
        this.hideAll();
        document.getElementById('story-screen').classList.remove('hidden');
    },
    
    showScoreScreen: function() {
        this.hideAll();
        const recordHero = Game.getHeroData(PlayerData.highScoreHeroId);
        document.getElementById('score-total-coins').innerText = PlayerData.coins;
        document.getElementById('score-high-score').innerText = PlayerData.highScore + 'm';
        document.getElementById('score-last-score').innerText = PlayerData.lastScore + 'm';
        document.getElementById('score-last-coins').innerText = PlayerData.lastCoins;
        
        if (recordHero) {
            document.getElementById('record-hero-icon').src = recordHero.icon;
            document.getElementById('score-record-hero-name').innerText = recordHero.name;
        } else {
            document.getElementById('record-hero-icon').src = '';
            document.getElementById('score-record-hero-name').innerText = 'N/A';
        }
        
        AudioSys.playTone(440, 'square', 0.1, 0.05);
        setTimeout(() => AudioSys.playTone(660, 'square', 0.1, 0.05), 100);
        document.getElementById('score-screen').classList.remove('hidden');
    },
    
    showHeroSelect: function() {
        this.hideAll();
        const container = document.getElementById('hero-list-container');
        container.innerHTML = '';
        
        const baseHeroes = [];
        const baseIds = new Set();
        HEROES_SKINS.forEach(hero => {
            if (!baseIds.has(hero.baseId)) {
                baseHeroes.push(hero);
                baseIds.add(hero.baseId);
            }
        });

        baseHeroes.forEach(hero => {
            const allSkins = HEROES_SKINS.filter(s => s.baseId === hero.baseId);
            const anySkinUnlocked = allSkins.some(s => PlayerData.unlocked.includes(s.id));
            
            const card = document.createElement('div');
            const isBaseSelected = Game.selectedBaseId === hero.baseId;
            card.className = `hero-card ${isBaseSelected ? 'selected' : ''}`;
            card.style.opacity = anySkinUnlocked ? '1' : '0.5';
            
            const firstLockedSkin = allSkins.find(s => !PlayerData.unlocked.includes(s.id) && s.price > 0);
            const priceText = firstLockedSkin ? `<div style="color:#ffd700; font-size:0.8rem;">üîí Skin Disp.</div>` : '';

            card.innerHTML = `
                <img src="${hero.icon}">
                <div style="font-size:0.8rem; margin-top:5px; color:#fff;">${hero.name.replace(/\s*\([^)]+\)/, '')}</div>
                ${priceText}
            `;
            
            card.onclick = () => { AudioSys.sfxClick(); Game.selectBaseHero(hero.baseId); };
            container.appendChild(card);
        });
        
        document.getElementById('hero-select-screen').classList.remove('hidden');
        this.updateStats();
        
        const details = document.getElementById('hero-details');
        const selectedSkin = Game.getHeroData(Game.selectedSkinId);
        details.innerHTML = `Her√≥i Atual: ${selectedSkin.name}`;
    },
    
    showSkinSelect: function(baseId) {
        this.hideAll();
        
        const skins = HEROES_SKINS.filter(s => s.baseId === baseId);
        const baseHero = skins.find(s => s.isBase) || skins[0];
        
        document.getElementById('skin-select-title').innerText = `Skins de ${baseHero.name.replace(/\s*\([^)]+\)/, '')}`;
        
        const container = document.getElementById('skin-list-container');
        container.innerHTML = '';
        
        skins.forEach(skin => {
            const isUnlocked = PlayerData.unlocked.includes(skin.id);
            const isSelected = Game.selectedSkinId === skin.id;

            const card = document.createElement('div');
            card.className = `hero-card ${isSelected ? 'selected' : ''}`;
            card.style.opacity = isUnlocked ? '1' : '0.5';
            
            card.innerHTML = `
                <img src="${skin.icon}">
                <div style="font-size:0.8rem; margin-top:5px; color:#fff;">${skin.name.split('(').pop().replace(')', '').trim()}</div>
                ${!isUnlocked && skin.price > 0 ? `<div style="color:#ffd700; font-size:0.8rem;">üîí ${skin.price}</div>` : ''}
            `;
            
            card.onclick = () => { AudioSys.sfxClick(); Game.selectSkin(skin.id); };
            container.appendChild(card);
        });

        document.getElementById('skin-select-screen').classList.remove('hidden');
        const details = document.getElementById('skin-details');
        const currentSkin = Game.getHeroData(Game.selectedSkinId);
        details.innerHTML = `Skin Selecionada: ${currentSkin.name}`;
    },

    showScenarioSelect: function() {
        this.hideAll();
        const container = document.getElementById('scenario-list-container');
        container.innerHTML = '';
        
        SCENARIOS.forEach(scenario => {
            const card = document.createElement('div');
            card.className = `hero-card ${Game.selectedScenarioId === scenario.id ? 'selected' : ''}`;
            card.style.width = '120px'; 
            card.style.height = '120px';
            
            card.innerHTML = `
                <img src="${scenario.url}" style="width: 100%; height: 70px; border-radius: 5px; object-fit: cover; border: 1px solid #fff;">
                <div style="font-size:0.8rem; margin-top:5px; color:#fff; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">${scenario.name}</div>
            `;
            
            card.onclick = () => { AudioSys.sfxClick(); Game.selectScenario(scenario.id); };
            container.appendChild(card);
        });
        
        document.getElementById('scenario-select-screen').classList.remove('hidden');
    },
    
    showBuyHeroModal: function(hero) {
        document.getElementById('buy-hero-name').innerText = `Comprar ${hero.name}?`;
        document.getElementById('buy-hero-cost').innerHTML = `Custo: <span style="font-weight: bold;">${hero.price}</span> ü™ô`;
        document.getElementById('current-player-coins').innerText = PlayerData.coins;
        document.getElementById('buy-hero-img').src = hero.icon; 

        const confirmBtn = document.getElementById('confirm-buy-btn');
        if (PlayerData.coins < hero.price) {
            confirmBtn.disabled = true;
            confirmBtn.style.opacity = 0.5;
            confirmBtn.innerText = "MOEDAS INSUFICIENTES";
        } else {
            confirmBtn.disabled = false;
            confirmBtn.style.opacity = 1;
            confirmBtn.innerText = "CONFIRMAR COMPRA";
        }

        document.getElementById('buy-hero-screen').classList.remove('hidden');
    },

    hideBuyHeroModal: function() {
        document.getElementById('buy-hero-screen').classList.add('hidden');
        if (Game.selectedBaseId) {
            this.showSkinSelect(Game.selectedBaseId);
        } else {
            this.showHeroSelect();
        }
    },
    
    showDialogue: function(pImg, pName, eImg, eName, texts, callback) {
        const dScreen = document.getElementById('dialogue-screen');
        const dLeft = document.getElementById('d-left-img');
        const dRight = document.getElementById('d-right-img');
        const dSpeaker = document.getElementById('d-speaker');
        const dText = document.getElementById('d-text');

        dLeft.src = eImg; // Enemy on Left (visual choice for arrival)
        dRight.src = pImg; // Player on Right

        dScreen.classList.remove('hidden');
        
        let msgIndex = 0;
        
        const nextMsg = () => {
            if (msgIndex >= texts.length) {
                dScreen.onclick = null;
                dScreen.classList.add('hidden');
                callback();
                return;
            }
            const t = texts[msgIndex];
            dSpeaker.innerText = t.speaker === 'enemy' ? eName : pName;
            dSpeaker.style.color = t.speaker === 'enemy' ? '#ff0000' : '#00eaff';
            dText.innerText = t.text;
            
            if(t.speaker === 'enemy') {
                dLeft.classList.add('active');
                dRight.classList.remove('active');
            } else {
                dLeft.classList.remove('active');
                dRight.classList.add('active');
            }
            msgIndex++;
        };
        
        nextMsg();
        dScreen.onclick = (e) => {
             e.stopPropagation();
             AudioSys.sfxClick();
             nextMsg();
        };
    },

    updateStats: function() {
        document.getElementById('menu-total-coins').innerText = PlayerData.coins;
        document.getElementById('menu-total-gems').innerText = PlayerData.gems;
    },

    updateHUD: function(life, coins, score) {
        document.getElementById('life-fill').style.width = life + '%';
        document.getElementById('hud-coins').innerText = coins;
        document.getElementById('hud-score').innerText = Math.floor(score);
    },
    
    updateBossHUD: function(lifePct, name) {
        document.getElementById('boss-hud').style.display = 'flex';
        document.getElementById('boss-name').innerText = name;
        document.getElementById('boss-life-fill').style.width = lifePct + '%';
    }
};

// --- 4. MOTOR DO JOGO ---
const Game = {
    canvas: document.getElementById('gameCanvas'),
    bgCanvas: document.getElementById('bgCanvas'),
    ctx: null,
    bgCtx: null,
    
    selectedSkinId: 'superman',
    selectedBaseId: 'superman',
    selectedScenarioId: SCENARIOS[0].id,
    heroData: null,
    
    state: 'MENU', // MENU, PLAYING, PAUSED, GAMEOVER, BOSS_DIALOGUE, BOSS_BATTLE, BOSS_VICTORY
    hero: { x: 0, y: 0, targetY: 0, width: 60, height: 60, life: 100 },
    obstacles: [],
    items: [],
    particles: [],
    projectiles: [],
    
    boss: { 
        active: false, 
        x: 0, y: 0, 
        targetY: 0, 
        life: 100, maxLife: 100, 
        data: null,
        shootTimer: 0 
    },
    
    gameSpeed: 8, // AUMENTADO (De 5 para 8)
    score: 0,
    nextBossScore: 500,
    coinCount: 0,
    bgOffset: 0,
    bgImage: new Image(),
    lastObstacleTime: 0,
    heroToBuy: null, 

    getHeroData: function(id) {
        return HEROES_SKINS.find(h => h.id === id);
    },

    init: function() {
        AudioSys.init(); 

        this.ctx = this.canvas.getContext('2d');
        this.bgCtx = this.bgCanvas.getContext('2d');
        this.resize();
        window.addEventListener('resize', () => this.resize());
        
        // Input Handling
        const handleMove = (y) => {
            if(this.state === 'PLAYING' || this.state === 'BOSS_BATTLE') { 
                this.hero.targetY = y;
            }
        };
        
        const handleTap = (e) => {
            if (this.state === 'PLAYING' || this.state === 'BOSS_BATTLE') { 
                e.preventDefault(); 
            }
            
            // Movement update
            if(e.touches && e.touches[0]) handleMove(e.touches[0].clientY);
            
            // Shooting Mechanic
            if (this.state === 'BOSS_BATTLE') {
                this.shootProjectile('hero');
            }
        };

        window.addEventListener('touchmove', (e) => {
            if (this.state === 'PLAYING' || this.state === 'BOSS_BATTLE') e.preventDefault();
            handleMove(e.touches[0].clientY);
        }, {passive: false});

        window.addEventListener('touchstart', handleTap, {passive: false});
        window.addEventListener('mousemove', (e) => handleMove(e.clientY));
        window.addEventListener('mousedown', () => {
             if (this.state === 'BOSS_BATTLE') this.shootProjectile('hero');
        });
        
        const pauseBtn = document.getElementById('pause-btn-hud');
        if (pauseBtn) {
            pauseBtn.addEventListener('click', () => {
                AudioSys.sfxClick();
                this.togglePause();
            });
        }
        
        const saved = localStorage.getItem('SuperSkySave');
        if(saved) PlayerData = JSON.parse(saved);
        
        this.selectedSkinId = PlayerData.unlocked.find(id => HEROES_SKINS.some(h => h.id === id)) || 'superman';
        this.selectedBaseId = this.getHeroData(this.selectedSkinId).baseId;
        
        this.bgImage.crossOrigin = "Anonymous";
        this.bgImage.src = SCENARIOS[0].url; 
        
        this.loop();
        UI.showMenu();
    },
    
    resize: function() {
        this.canvas.width = this.bgCanvas.width = window.innerWidth;
        this.canvas.height = this.bgCanvas.height = window.innerHeight;
        this.hero.x = this.canvas.width * 0.15;
    },
    
    selectBaseHero: function(baseId) {
        this.selectedBaseId = baseId;
        const skins = HEROES_SKINS.filter(s => s.baseId === baseId);
        const activeSkin = skins.find(s => s.id === this.selectedSkinId);
        if (activeSkin) {
            this.selectSkin(activeSkin.id);
        } else {
            const unlockedSkin = skins.find(s => PlayerData.unlocked.includes(s.id));
            this.selectSkin(unlockedSkin ? unlockedSkin.id : skins[0].id);
        }
        UI.showHeroSelect(); // Back to hero select, the button should now go to skin select
    },
    
    selectSkin: function(id) {
        const skin = this.getHeroData(id);
        if (!PlayerData.unlocked.includes(id)) {
            this.heroToBuy = skin;
            UI.showBuyHeroModal(skin);
            return;
        }
        this.selectedSkinId = id;
        this.selectedBaseId = skin.baseId;
        const details = document.getElementById('skin-details');
        details.innerHTML = `Skin Selecionada: ${skin.name}`;
        if (document.getElementById('skin-select-screen').classList.contains('hidden') === false) {
             UI.showSkinSelect(skin.baseId);
        }
    },

    buyHero: function(confirmPurchase) {
        if (!confirmPurchase || !this.heroToBuy) {
            this.heroToBuy = null;
            UI.hideBuyHeroModal();
            return;
        }
        const skin = this.heroToBuy;
        if (PlayerData.coins >= skin.price) {
            PlayerData.coins -= skin.price;
            PlayerData.unlocked.push(skin.id);
            localStorage.setItem('SuperSkySave', JSON.stringify(PlayerData));
            this.selectedSkinId = skin.id;
            this.selectedBaseId = skin.baseId;
            this.heroToBuy = null;
            UI.hideBuyHeroModal();
        } else {
            alert(`Moedas insuficientes! Voc√™ precisa de ${skin.price} moedas.`);
        }
    },

    selectScenario: function(id) {
        this.selectedScenarioId = id;
        const cards = document.querySelectorAll('#scenario-list-container .hero-card');
        cards.forEach(card => card.classList.remove('selected'));
        const selectedCard = Array.from(cards).find(card => card.onclick.toString().includes(`'${id}'`));
        if(selectedCard) selectedCard.classList.add('selected');
    },

    selectScenarioAndStart: function() {
        AudioSys.sfxClick();
        const scenario = SCENARIOS.find(s => s.id === this.selectedScenarioId);
        if (scenario) {
            this.startMatch(scenario.url);
        } else {
            this.startMatch(SCENARIOS[0].url);
        }
    },
    
    preStartIntro: function() {
        AudioSys.sfxClick();
        this.heroData = this.getHeroData(this.selectedSkinId);
        document.getElementById('intro-name').innerText = this.heroData.name;
        document.getElementById('intro-img').src = this.heroData.introGif;
        document.getElementById('intro-quote').innerText = this.heroData.quote;
        UI.hideAll();
        document.getElementById('intro-screen').classList.remove('hidden');
    },
    
    startMatch: function(bgUrl) {
        if(AudioSys.ctx && AudioSys.ctx.state === 'suspended') AudioSys.ctx.resume();

        this.state = 'PLAYING';
        UI.hideAll();
        
        this.score = 0;
        this.nextBossScore = 500;
        this.coinCount = 0;
        this.gameSpeed = 8; // Resetando para a nova velocidade base
        this.hero.life = 100;
        this.hero.y = this.canvas.height / 2;
        this.hero.targetY = this.canvas.height / 2;
        this.hero.x = this.canvas.width * 0.15; 
        
        this.obstacles = [];
        this.items = [];
        this.particles = [];
        this.projectiles = [];
        this.lastObstacleTime = 0;
        
        this.boss.active = false;
        
        document.getElementById('hud').classList.remove('hidden');
        const heroLayer = document.getElementById('hero-layer');
        heroLayer.classList.remove('hidden');
        document.getElementById('hero-sprite').src = this.heroData.gameGif;
        
        this.bgImage.crossOrigin = "Anonymous";
        this.bgImage.src = bgUrl;
    },

    togglePause: function() {
        if(this.state === 'PLAYING' || this.state === 'BOSS_BATTLE') {
            this.savedState = this.state;
            this.state = 'PAUSED';
            document.getElementById('pause-screen').classList.remove('hidden');
        } else if(this.state === 'PAUSED') {
            this.state = this.savedState;
            document.getElementById('pause-screen').classList.add('hidden');
        }
    },

    quitToMenu: function() {
        AudioSys.sfxClick();
        this.state = 'MENU';
        this.saveGameData(true);
        UI.showMenu();
    },
    
    saveGameData: function(updateLastScore = false) {
        PlayerData.coins += this.coinCount;
        if (updateLastScore) {
            PlayerData.lastScore = Math.floor(this.score);
            PlayerData.lastCoins = this.coinCount;
        }
        if(this.score > PlayerData.highScore) {
            PlayerData.highScore = Math.floor(this.score);
            PlayerData.highScoreHeroId = this.selectedSkinId;
        }
        localStorage.setItem('SuperSkySave', JSON.stringify(PlayerData));
    },

    // --- BOSS BATTLE SYSTEM ---
    
    initBossEvent: function() {
        if (this.nextBossScore > 10000) return; // Prevent boss spawning after limit

        this.state = 'BOSS_DIALOGUE';
        this.obstacles = []; // Clear obstacles
        this.items = [];
        
        // Pick random opponent
        const opponents = HEROES_SKINS.filter(h => h.id !== this.selectedSkinId);
        const randomOpp = opponents[Math.floor(Math.random() * opponents.length)];
        
        this.boss.data = randomOpp;
        this.boss.life = 100;
        this.boss.maxLife = 100;
        this.boss.x = this.canvas.width * 0.85; // Fixed X position for boss
        this.boss.y = this.canvas.height / 2;
        this.boss.targetY = this.canvas.height / 2;
        this.boss.active = true;
        this.boss.shootTimer = 0;

        // Setup Boss Visual
        const bossLayer = document.getElementById('boss-layer');
        // FIX: REMOVE HIDDEN CLASS EXPLICITLY TO OVERRIDE !important
        bossLayer.classList.remove('hidden'); 
        bossLayer.style.display = 'block';
        document.getElementById('boss-sprite').src = randomOpp.gameGif;
        
        // --- ORIENTATION (Will be updated in bossAI loop for consistency) ---
        const scaleDirection = randomOpp.flip ? 1 : -1; 
        bossLayer.style.transform = `translate(-50%, -50%) scaleX(${scaleDirection})`; 

        // Dialogue Logic
        const pName = this.heroData.name.split('(')[0];
        const eName = randomOpp.name.split('(')[0];
        
        const text1 = DIALOGUES.start[Math.floor(Math.random() * DIALOGUES.start.length)];
        const text2 = DIALOGUES.response[Math.floor(Math.random() * DIALOGUES.response.length)];
        
        const conversation = [
            { speaker: 'enemy', text: text1 },
            { speaker: 'hero', text: text2 }
        ];

        UI.showDialogue(this.heroData.icon, pName, randomOpp.icon, eName, conversation, () => {
             this.startBossBattle();
        });
    },
    
    startBossBattle: function() {
        this.state = 'BOSS_BATTLE';
        UI.updateBossHUD(100, this.boss.data.name);
    },
    
    shootProjectile: function(owner) {
        AudioSys.sfxShoot();
        const isHero = owner === 'hero';
        const startX = isHero ? this.hero.x + 40 : this.boss.x - 40;
        const startY = isHero ? this.hero.y : this.boss.y;
        const color = isHero ? this.heroData.color : this.boss.data.color;
        
        this.projectiles.push({
            x: startX,
            y: startY,
            vx: isHero ? 15 : -15,
            vy: 0,
            color: color,
            owner: owner
        });
    },

    bossAI: function() {
        // Simple AI: Move towards player Y, slightly delayed
        this.boss.y += (this.hero.y - this.boss.y) * 0.05;
        
        // Bounds
        if(this.boss.y < 50) this.boss.y = 50;
        if(this.boss.y > this.canvas.height - 50) this.boss.y = this.canvas.height - 50;
        
        // Render Position
        const bossLayer = document.getElementById('boss-layer');
        bossLayer.style.top = this.boss.y + 'px';
        bossLayer.style.left = this.boss.x + 'px';
        
        // --- FIX VISIBILITY/ANIMATION: Apply correct centering and scaling on every frame ---
        if (this.boss.data) {
             const scaleDirection = this.boss.data.flip ? 1 : -1; 
             // Apply centering (-50%, -50%) and orientation (scaleX)
             bossLayer.style.transform = `translate(-50%, -50%) scaleX(${scaleDirection})`;
        }
        // --- END FIX ---

        // Shoot
        this.boss.shootTimer++;
        if(this.boss.shootTimer > 40) { // Shoot interval
             this.shootProjectile('boss');
             this.boss.shootTimer = 0;
        }
    },
    
    checkProjectileCollisions: function() {
        for(let i = this.projectiles.length - 1; i >= 0; i--) {
            let p = this.projectiles[i];
            p.x += p.vx;
            
            // Remove offscreen
            if(p.x < 0 || p.x > this.canvas.width) {
                this.projectiles.splice(i,1);
                continue;
            }
            
            // Hit Hero
            if (p.owner === 'boss') {
                const dist = Math.abs(p.x - this.hero.x) + Math.abs(p.y - this.hero.y);
                if (dist < 50) {
                    this.takeDamage(10);
                    this.projectiles.splice(i,1);
                    this.createExplosion(p.x, p.y, p.color);
                    continue; 
                }
            } 
            // Hit Boss
            else if (p.owner === 'hero') {
                const dist = Math.abs(p.x - this.boss.x) + Math.abs(p.y - this.boss.y);
                if (dist < 60) {
                    this.boss.life -= 5;
                    AudioSys.sfxHit();
                    UI.updateBossHUD(this.boss.life, this.boss.data.name);
                    this.projectiles.splice(i,1);
                    this.createExplosion(p.x, p.y, p.color);
                    
                    if(this.boss.life <= 0) {
                        this.bossVictory();
                        return; // Exit loop early to prevent further processing
                    }
                    continue;
                }
            }
        }
    },
    
    bossVictory: function() {
        this.state = 'BOSS_VICTORY';
        AudioSys.sfxWin();
        document.getElementById('boss-layer').style.display = 'none';
        document.getElementById('boss-hud').style.display = 'none';
        this.projectiles = [];
        
        // Rewards
        this.coinCount += 50;
        this.hero.life = 100;
        this.createFloatingText("+50 ü™ô", this.canvas.width/2, this.canvas.height/2 - 50);
        
        // Visual
        const vicText = document.createElement('div');
        vicText.className = 'battle-victory-text';
        vicText.innerHTML = "VENCEU!";
        document.body.appendChild(vicText);
        
        setTimeout(() => {
            vicText.remove();
            this.state = 'PLAYING';
            
            // --- FIX PROGRESSION: Increment next boss score up to 10000M ---
            if (this.nextBossScore < 10000) {
                 this.nextBossScore += 500;
                 console.log(`Pr√≥ximo chefe agendado para: ${this.nextBossScore}m`);
            } else {
                 // Ap√≥s 10000m, sem mais chefes (o jogo continua)
                 this.nextBossScore = Infinity; 
                 console.log("Limite de chefes (10000m) atingido.");
            }
            // --- END FIX ---
        }, 2500);
    },

    spawnLogic: function() {
        this.lastObstacleTime++;
        if (this.lastObstacleTime > 150) {
            if (Math.random() < 0.05) { 
                const gap = 300;
                const minY = gap/2 + 50;
                const maxY = this.canvas.height - gap/2 - 50;
                const center = Math.random() * (maxY - minY) + minY;
                this.obstacles.push({
                    x: this.canvas.width,
                    y: center,
                    gap: gap,
                    w: 60,
                    passed: false
                });
                this.lastObstacleTime = 0;
            }
        }
        if (Math.random() < 0.02) {
            const type = Math.random() < 0.15 ? 'HEART' : 'COIN';
            this.items.push({
                x: this.canvas.width,
                y: Math.random() * (this.canvas.height - 100) + 50,
                type: type,
                angle: 0
            });
        }
    },
    
    update: function() {
        if (this.state !== 'PLAYING' && this.state !== 'BOSS_BATTLE') return;
        
        // --- MOVEMENT & PHYSICS ---
        this.hero.y += (this.hero.targetY - this.hero.y) * 0.1; 
        if (this.hero.y < 30) this.hero.y = 30;
        if (this.hero.y > this.canvas.height - 30) this.hero.y = this.canvas.height - 30;
        
        const heroEl = document.getElementById('hero-layer');
        heroEl.style.top = this.hero.y + 'px';
        heroEl.style.left = this.hero.x + 'px';
        
        const tilt = (this.hero.targetY - this.hero.y) * 0.05;
        let transformStyle = `translate(-50%, -50%) rotate(${Math.max(-20, Math.min(20, tilt))}deg)`;
        if (this.heroData && this.heroData.flip) transformStyle += ' scaleX(-1)';
        heroEl.style.transform = transformStyle;

        // --- PARTICLE EMITTER ---
        if (Math.random() > 0.6) {
            this.emitHeroParticles();
        }
        for (let i = this.particles.length - 1; i >= 0; i--) {
            let p = this.particles[i];
            p.x += p.vx;
            p.y += p.vy;
            p.life--;
            if (p.life <= 0) this.particles.splice(i, 1);
        }

        // --- GAME STATES LOGIC ---
        
        if (this.state === 'PLAYING') {
            this.score += 0.1;
            // AUMENTADA A ACELERA√á√ÉO
            this.gameSpeed = 8 + (this.score * 0.002);

            // CHECK BOSS TRIGGER
            if (this.score >= this.nextBossScore) {
                this.initBossEvent();
                return;
            }

            // Obstacles Logic
            for (let i = this.obstacles.length - 1; i >= 0; i--) {
                let ob = this.obstacles[i];
                ob.x -= this.gameSpeed;
                
                const hbX = this.hero.x;
                const hbY = this.hero.y;
                const hbR = 20;
                
                const inPipeH = (hbX + hbR > ob.x) && (hbX - hbR < ob.x + ob.w);
                if (inPipeH) {
                    const topPipeY = ob.y - ob.gap/2;
                    const botPipeY = ob.y + ob.gap/2;
                    if ((hbY - hbR < topPipeY) || (hbY + hbR > botPipeY)) {
                        this.takeDamage(2);
                    }
                }
                if (ob.x < -100) this.obstacles.splice(i, 1);
            }
            
            // Items Logic
            for (let i = this.items.length - 1; i >= 0; i--) {
                let it = this.items[i];
                it.x -= this.gameSpeed;
                it.angle += 0.1;
                const dx = this.hero.x - it.x;
                const dy = this.hero.y - it.y;
                if (Math.sqrt(dx*dx + dy*dy) < 45) {
                    if (it.type === 'COIN') {
                        this.coinCount++;
                        AudioSys.sfxCoin();
                        this.createFloatingText("+10", it.x, it.y);
                    } else {
                        this.hero.life = Math.min(100, this.hero.life + 20);
                        this.createFloatingText("‚ù§Ô∏è", it.x, it.y);
                    }
                    this.items.splice(i, 1);
                } else if (it.x < -50) this.items.splice(i, 1);
            }
            
            this.spawnLogic();
            
        } else if (this.state === 'BOSS_BATTLE') {
            this.bossAI();
            this.checkProjectileCollisions();
        }

        UI.updateHUD(Math.floor(this.hero.life), this.coinCount, this.score);
    },
    
    emitHeroParticles: function() {
        let particleColor = this.heroData.color;
        let particleLife = 20;
        let vx = -5 - Math.random()*5;
        let vy = (Math.random()-0.5);

        if (this.heroData.effects === 'thunder') {
            particleColor = Math.random() < 0.5 ? '#fff' : '#ffd700';
            particleLife = 10;
            vx = -8 - Math.random()*12; 
            vy = (Math.random()-0.5) * 8; 
        } else if (this.heroData.effects === 'energy') {
            particleColor = Math.random() < 0.5 ? '#00eaff' : '#fff';
            vx = -5 - Math.random()*2;
            vy = (Math.random()-0.5) * 4;
            particleLife = 25;
        }

        this.particles.push({
            x: this.hero.x - 20,
            y: this.hero.y + (Math.random()*20-10),
            vx: vx,
            vy: vy,
            life: particleLife,
            color: particleColor
        });
    },

    createExplosion: function(x, y, color) {
        for(let k=0; k<10; k++){
            this.particles.push({
                x: x, y: y,
                vx: (Math.random()-0.5)*10,
                vy: (Math.random()-0.5)*10,
                life: 30,
                color: color
            });
        }
    },
    
    draw: function() {
        const bCtx = this.bgCtx;
        const w = this.bgCanvas.width;
        const h = this.bgCanvas.height;
        
        bCtx.clearRect(0, 0, w, h);
        
        // BG Scrolling
        if(this.state === 'PLAYING') {
            this.bgOffset -= this.gameSpeed * 0.2;
        } else if (this.state === 'BOSS_BATTLE') {
            this.bgOffset -= 10; // Fast background for intense battle feel
        } else {
             this.bgOffset -= 0.5;
        }
        
        if (this.bgOffset <= -w) this.bgOffset = 0;
        
        if (this.bgImage.complete && this.bgImage.naturalWidth > 0) {
            bCtx.drawImage(this.bgImage, this.bgOffset, 0, w, h);
            bCtx.drawImage(this.bgImage, this.bgOffset + w, 0, w, h);
        } else {
            bCtx.fillStyle = '#111';
            bCtx.fillRect(0,0,w,h);
        }
        
        // Darken overlay
        bCtx.fillStyle = this.state === 'BOSS_BATTLE' ? 'rgba(50,0,0,0.3)' : 'rgba(0,0,0,0.4)';
        bCtx.fillRect(0,0,w,h);

        const ctx = this.ctx;
        ctx.clearRect(0, 0, w, h);
        
        if (this.state !== 'PLAYING' && this.state !== 'BOSS_BATTLE' && this.state !== 'PAUSED') return;
        
        // Draw Obstacles
        this.obstacles.forEach(ob => {
            const g = ctx.createLinearGradient(ob.x, 0, ob.x + ob.w, 0);
            g.addColorStop(0, '#000');
            g.addColorStop(0.3, '#444');
            g.addColorStop(0.5, '#666');
            g.addColorStop(0.8, '#333');
            g.addColorStop(1, '#000');
            ctx.fillStyle = g;
            
            const topH = ob.y - ob.gap/2;
            const botY = ob.y + ob.gap/2;
            ctx.fillRect(ob.x, 0, ob.w, topH);
            ctx.fillRect(ob.x, botY, ob.w, h - botY);
            
            ctx.fillStyle = '#00eaff';
            ctx.shadowColor = '#00eaff';
            ctx.shadowBlur = 10;
            ctx.fillRect(ob.x, topH - 8, ob.w, 8); 
            ctx.fillRect(ob.x, botY, ob.w, 8); 
            ctx.shadowBlur = 0;
        });
        
        // Draw Items
        this.items.forEach(it => {
            ctx.save();
            ctx.translate(it.x, it.y);
            ctx.rotate(it.angle);
            if (it.type === 'COIN') {
                ctx.beginPath();
                ctx.arc(0, 0, 15, 0, Math.PI*2);
                ctx.fillStyle = '#ffd700';
                ctx.fill();
                ctx.lineWidth = 2;
                ctx.strokeStyle = '#fff';
                ctx.stroke();
                ctx.fillStyle = '#000';
                ctx.font = 'bold 16px Arial';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText('$', 0, 0);
            } else {
                ctx.font = '24px Arial';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText('‚ù§Ô∏è', 0, 0);
            }
            ctx.restore();
        });
        
        // Draw Particles
        this.particles.forEach(p => {
            ctx.fillStyle = p.color;
            ctx.globalAlpha = p.life / 20;
            ctx.beginPath();
            ctx.arc(p.x, p.y, Math.random()*5, 0, Math.PI*2);
            ctx.fill();
        });
        ctx.globalAlpha = 1;

        // Draw Projectiles
        this.projectiles.forEach(p => {
            ctx.fillStyle = p.color;
            ctx.shadowBlur = 15;
            ctx.shadowColor = p.color;
            ctx.beginPath();
            ctx.arc(p.x, p.y, 8, 0, Math.PI*2);
            ctx.fill();
            
            // Trail
            ctx.strokeStyle = p.color;
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(p.x, p.y);
            ctx.lineTo(p.x - p.vx*2, p.y);
            ctx.stroke();
            ctx.shadowBlur = 0;
        });
    },
    
    takeDamage: function(amount) {
        this.hero.life -= amount;
        AudioSys.sfxHit();
        const wrapper = document.getElementById('game-wrapper');
        wrapper.style.transform = `translate(${Math.random()*10-5}px, ${Math.random()*10-5}px)`;
        setTimeout(() => wrapper.style.transform = 'none', 50);
        if (this.hero.life <= 0) this.gameOver();
    },
    
    createFloatingText: function(text, x, y) {
        const el = document.createElement('div');
        el.className = 'floating-currency';
        el.innerText = text;
        el.style.left = x + 'px';
        el.style.top = y + 'px';
        document.body.appendChild(el);
        setTimeout(() => el.remove(), 1000);
    },
    
    gameOver: function() {
        this.state = 'GAMEOVER';
        this.saveGameData(true);
        document.getElementById('go-score').innerText = Math.floor(this.score);
        document.getElementById('go-coins').innerText = this.coinCount;
        UI.hideAll();
        document.getElementById('game-over-screen').classList.remove('hidden');
    },
    
    loop: function() {
        this.update();
        this.draw();
        requestAnimationFrame(() => this.loop());
    }
};

window.onload = () => Game.init();
</script>
<style>
    /* Estilos exclusivos do Preloader */
    #preloader-overlay {
        position: fixed;
        top: 0; left: 0;
        width: 100%; height: 100%;
        z-index: 99999; /* Fica acima de tudo */
        background-color: #000;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        font-family: 'Orbitron', sans-serif;
        transition: opacity 0.5s ease-out;
    }

    .loader-title {
        color: #fff;
        font-size: 1.5rem;
        margin-bottom: 20px;
        text-transform: uppercase;
        letter-spacing: 2px;
        animation: pulseText 1.5s infinite;
        text-shadow: 0 0 10px #00eaff;
        text-align: center;
    }

    .loader-bar-container {
        width: 80%;
        max-width: 400px;
        height: 20px;
        background: #111;
        border: 2px solid #00eaff;
        border-radius: 4px;
        overflow: hidden;
        position: relative;
        box-shadow: 0 0 20px rgba(0, 234, 255, 0.3);
    }

    .loader-bar-fill {
        width: 0%;
        height: 100%;
        background: linear-gradient(90deg, #0055ff, #00eaff);
        transition: width 0.2s linear;
        box-shadow: 0 0 15px #00eaff;
    }

    .loader-text {
        color: #00eaff;
        margin-top: 10px;
        font-size: 0.9rem;
        font-family: 'Rajdhani', sans-serif;
    }

    .loader-warn {
        position: absolute;
        bottom: 20px;
        color: #555;
        font-size: 0.7rem;
        text-align: center;
        width: 100%;
    }
</style>

<div id="preloader-overlay">
    <div class="loader-title">Carregando Recursos...</div>
    <div class="loader-bar-container">
        <div id="loader-fill" class="loader-bar-fill"></div>
    </div>
    <div id="loader-status" class="loader-text">0%</div>
    <div class="loader-warn">Aguarde o carregamento dos GIFs de alta defini√ß√£o.</div>
</div>

<script>
    /**
     * PRELOADER LOGIC v1.0
     * Garante que GIFs e Imagens pesadas estejam no cache antes do jogo iniciar.
     */
    const Preloader = {
        overlay: document.getElementById('preloader-overlay'),
        bar: document.getElementById('loader-fill'),
        txt: document.getElementById('loader-status'),
        assets: [],
        total: 0,
        loaded: 0,

        // Coleta todas as URLs das configura√ß√µes do jogo
        collectAssets: function() {
            // 1. Cen√°rios
            if (typeof SCENARIOS !== 'undefined') {
                SCENARIOS.forEach(s => this.addUrl(s.url));
            }
            // 2. Skins e Her√≥is (Icons, Intros, GameGifs)
            if (typeof HEROES_SKINS !== 'undefined') {
                HEROES_SKINS.forEach(h => {
                    this.addUrl(h.icon);
                    this.addUrl(h.introGif);
                    this.addUrl(h.gameGif);
                });
            }
            // 3. Imagens de UI importantes (Hardcoded para garantir)
            this.addUrl('https://wallpapers.com/images/hd/dark-superman-superhero-iphone-m2jk0xvpaxiyoyua.jpg'); // Menu BG
            this.addUrl('https://w0.peakpx.com/wallpaper/593/223/HD-wallpaper-superman-vs-goku-dragoonball-goku-marvel-superman.jpg'); // Select BG
        },

        addUrl: function(url) {
            if (url && url.length > 5 && !this.assets.includes(url)) {
                this.assets.push(url);
            }
        },

        start: function() {
            this.collectAssets();
            this.total = this.assets.length;
            
            if (this.total === 0) {
                this.finish();
                return;
            }

            // Inicia o download paralelo de tudo
            this.assets.forEach(url => {
                const img = new Image();
                
                // Sucesso
                img.onload = () => {
                    this.progress();
                };
                
                // Erro (N√£o trava o jogo, apenas conta como carregado e segue)
                img.onerror = () => {
                    console.warn('Falha ao carregar asset:', url);
                    this.progress();
                };

                // For√ßa o browser a buscar a imagem
                img.src = url;
            });
        },

        progress: function() {
            this.loaded++;
            const pct = Math.floor((this.loaded / this.total) * 100);
            
            // Atualiza UI
            this.bar.style.width = pct + "%";
            this.txt.innerText = pct + "%";

            if (this.loaded >= this.total) {
                setTimeout(() => this.finish(), 500); // Pequeno delay visual para ver o 100%
            }
        },

        finish: function() {
            this.overlay.style.opacity = '0';
            setTimeout(() => {
                this.overlay.style.display = 'none';
                // Chama o inicializador do jogo ORIGINAL
                if (typeof Game !== 'undefined' && Game.init) {
                    Game.init();
                }
            }, 500);
        }
    };

    // SOBRESCREVE o window.onload original para rodar o Preloader primeiro
    window.onload = function() {
        console.log("Iniciando Preloader do SuperSky Storm...");
        Preloader.start();
    };
</script>
<script>
(function() {
    console.log("Iniciando patch de corre√ß√£o de imagens para GitHub...");

    // Fun√ß√£o para tratar imagens de fundo (Cen√°rios) que v√£o para o CANVAS
    // Usa o servi√ßo wsrv.nl para garantir HTTPS e cabe√ßalhos CORS corretos
    function fixCanvasUrl(url) {
        if (!url) return '';
        // Se j√° for base64 ou blob, ignora
        if (url.startsWith('data:') || url.startsWith('blob:')) return url;
        
        // Remove protocolo http/https para limpar
        let cleanUrl = url.replace(/^https?:\/\//, '');
        // Retorna a URL passando pelo proxy que permite o desenho no Canvas
        return 'https://wsrv.nl/?url=' + encodeURIComponent(cleanUrl) + '&output=jpg&q=85';
    }

    // Fun√ß√£o para tratar imagens normais (Personagens/GIFs)
    // GIFs n√£o podem passar pelo proxy wsrv.nl sen√£o viram est√°ticos, 
    // ent√£o apenas for√ßamos HTTPS para n√£o dar erro de Mixed Content.
    function fixSecureUrl(url) {
        if (!url) return '';
        if (url.startsWith('http://')) {
            return url.replace('http://', 'https://');
        }
        return url;
    }

    // 1. Aplicar corre√ß√£o nos CEN√ÅRIOS (Essencial para o fundo n√£o ficar preto)
    if (typeof SCENARIOS !== 'undefined') {
        SCENARIOS.forEach(function(scene) {
            scene.url = fixCanvasUrl(scene.url);
        });
    }

    // 2. Aplicar corre√ß√£o nos HER√ìIS (Garante HTTPS)
    if (typeof HEROES_SKINS !== 'undefined') {
        HEROES_SKINS.forEach(function(hero) {
            hero.icon = fixSecureUrl(hero.icon);
            hero.introGif = fixSecureUrl(hero.introGif);
            hero.gameGif = fixSecureUrl(hero.gameGif);
        });
    }

    // 3. Atualizar imagens da UI (Menu e Telas)
    // Corrige o fundo do menu principal
    var menuScreen = document.getElementById('menu-screen');
    if (menuScreen) {
        var menuBg = 'https://wallpapers.com/images/hd/dark-superman-superhero-iphone-m2jk0xvpaxiyoyua.jpg';
        menuScreen.style.backgroundImage = "url('" + fixCanvasUrl(menuBg) + "')";
    }

    // Corrige fundos de sele√ß√£o
    var screensWithBg = ['hero-select-screen', 'skin-select-screen', 'scenario-select-screen'];
    var commonBg = 'https://w0.peakpx.com/wallpaper/593/223/HD-wallpaper-superman-vs-goku-dragoonball-goku-marvel-superman.jpg';
    screensWithBg.forEach(function(id) {
        var el = document.getElementById(id);
        if (el) el.style.backgroundImage = "url('" + fixCanvasUrl(commonBg) + "')";
    });
    
    // Corrige fundo do Score
    var scoreScreen = document.getElementById('score-screen');
    if (scoreScreen) {
        // Tenor as vezes bloqueia hotlink, tentamos for√ßar HTTPS direto ou usar proxy se for est√°tico
        // Como √© GIF, apenas for√ßamos HTTPS
        scoreScreen.style.backgroundImage = "url('" + fixSecureUrl('https://media1.tenor.com/m/axi9xVrR8goAAAAd/dragon-ball-dragon-ball-z.gif') + "')";
    }

    // Reinicia a lista de assets do Preloader para garantir que ele carregue as novas URLs corrigidas
    if (typeof Preloader !== 'undefined') {
        Preloader.assets = [];
        Preloader.collectAssets(); // Re-coleta as URLs agora atualizadas
    }

    console.log("Corre√ß√£o de imagens aplicada com sucesso.");
})();
</script>
<script>
/**
 * PATCH: ATUALIZA√á√ÉO DE EVENTO DE CHEFE (A CADA 200 METROS)
 * Adicione este script antes de </body> para sobrescrever a l√≥gica original.
 */
(function() {
    // Aguarda o objeto Game estar dispon√≠vel para aplicar a corre√ß√£o
    var patchInterval = setInterval(function() {
        if (typeof Game !== 'undefined') {
            clearInterval(patchInterval);
            applyBossPatch();
        }
    }, 100);

    function applyBossPatch() {
        console.log("Aplicando patch de Boss a cada 200m...");

        // 1. Sobrescreve o in√≠cio da partida para definir o primeiro chefe em 200m
        var originalStartMatch = Game.startMatch;
        Game.startMatch = function(bgUrl) {
            // Executa a fun√ß√£o original para resetar tudo
            originalStartMatch.call(this, bgUrl);
            
            // FOR√áA o primeiro chefe para 200m (Original era 500)
            this.nextBossScore = 200; 
            console.log("Primeiro chefe definido para: " + this.nextBossScore + "m");
        };

        // 2. Sobrescreve a vit√≥ria para somar apenas 200m para o pr√≥ximo
        Game.bossVictory = function() {
            this.state = 'BOSS_VICTORY';
            AudioSys.sfxWin();
            
            // Esconde UI do chefe
            var bossLayer = document.getElementById('boss-layer');
            if(bossLayer) bossLayer.style.display = 'none';
            document.getElementById('boss-hud').style.display = 'none';
            
            this.projectiles = [];
            
            // Recompensas
            this.coinCount += 50;
            this.hero.life = 100;
            this.createFloatingText("+50 ü™ô", this.canvas.width/2, this.canvas.height/2 - 50);
            
            // Texto Visual de Vit√≥ria
            var vicText = document.createElement('div');
            vicText.className = 'battle-victory-text';
            vicText.innerHTML = "VENCEU!";
            document.body.appendChild(vicText);
            
            var self = this;
            setTimeout(function() {
                if(vicText) vicText.remove();
                self.state = 'PLAYING';
                
                // --- AQUI EST√Å A MUDAN√áA (500 -> 200) ---
                if (self.nextBossScore < 10000) {
                     self.nextBossScore += 200; // Mudado de 500 para 200
                     console.log("Pr√≥ximo chefe agendado para: " + self.nextBossScore + "m");
                } else {
                     self.nextBossScore = Infinity; 
                }
                // ----------------------------------------
                
            }, 2500);
        };
    }
})();
</script>
<script>
/**
 * PATCH: MODO FREN√âTICO (v1.0)
 * Adiciona bot√£o de novo modo, aumenta velocidade e frequ√™ncia de chefes.
 */
(function() {
    // Aguarda o carregamento completo para garantir que o objeto Game e o DOM existam
    var freneticInterval = setInterval(function() {
        if (typeof Game !== 'undefined' && document.getElementById('menu-screen')) {
            clearInterval(freneticInterval);
            initFreneticMode();
        }
    }, 200);

    function initFreneticMode() {
        console.log("Inicializando Patch: Modo Fren√©tico...");

        // 1. ESTADO DO MODO DE JOGO
        Game.activeMode = 'NORMAL'; // Padr√£o

        Game.setMode = function(mode) {
            this.activeMode = mode;
            console.log("Modo de jogo definido para: " + mode);
        };

        // 2. MODIFICAR A UI (MENU PRINCIPAL)
        var menuContainer = document.querySelector('#menu-screen .selection-container');
        var originalPlayBtn = document.querySelector('button[onclick="UI.showHeroSelect()"]');
        
        if (originalPlayBtn && menuContainer) {
            // Ajusta o bot√£o original para ser o modo Normal
            originalPlayBtn.setAttribute('onclick', "Game.setMode('NORMAL'); UI.showHeroSelect()");
            originalPlayBtn.innerHTML = "üöÄ MODO NORMAL";

            // Cria o bot√£o do Modo Fren√©tico
            var freneticBtn = document.createElement('button');
            freneticBtn.className = 'btn';
            freneticBtn.innerHTML = "üî• MODO FREN√âTICO";
            freneticBtn.style.borderColor = "#ff3333";
            freneticBtn.style.color = "#ffdddd";
            freneticBtn.style.boxShadow = "0 0 15px rgba(255, 0, 0, 0.4)";
            
            freneticBtn.onclick = function() {
                AudioSys.sfxClick();
                Game.setMode('FRENETIC');
                UI.showHeroSelect();
            };

            // Insere o bot√£o logo abaixo do bot√£o de jogar normal
            originalPlayBtn.parentNode.insertBefore(freneticBtn, originalPlayBtn.nextSibling);
        }

        // 3. OVERRIDE: START MATCH (Configura√ß√£o Inicial)
        var _originalStart = Game.startMatch;
        Game.startMatch = function(bgUrl) {
            _originalStart.call(this, bgUrl);

            if (this.activeMode === 'FRENETIC') {
                // Come√ßa com chefe logo aos 50m
                this.nextBossScore = 50;
                // Exibe aviso visual
                this.createFloatingText("üî• MODO FREN√âTICO! üî•", this.canvas.width/2, this.canvas.height/2);
            }
        };

        // 4. OVERRIDE: VELOCIDADE (Interceptador)
        // Usamos defineProperty para interceptar quando o jogo tenta definir a velocidade
        // e aumentamos ela se estiver no modo fren√©tico, sem precisar reescrever a fun√ß√£o update inteira.
        var _internalSpeed = 8;
        Object.defineProperty(Game, 'gameSpeed', {
            get: function() { 
                return _internalSpeed; 
            },
            set: function(value) {
                if (Game.activeMode === 'FRENETIC') {
                    // Aumenta a velocidade em 50% e adiciona um valor base maior
                    _internalSpeed = (value * 1.5) + 2; 
                } else {
                    _internalSpeed = value;
                }
            }
        });

        // 5. OVERRIDE: L√ìGICA DE VIT√ìRIA DO CHEFE (Boss Loop)
        // Precisamos reescrever esta fun√ß√£o para alterar o intervalo do pr√≥ximo chefe
        Game.bossVictory = function() {
            this.state = 'BOSS_VICTORY';
            AudioSys.sfxWin();
            
            // Esconde UI do chefe
            var bossLayer = document.getElementById('boss-layer');
            if(bossLayer) bossLayer.style.display = 'none';
            document.getElementById('boss-hud').style.display = 'none';
            
            this.projectiles = [];
            
            // Recompensas (Bonus maior no fren√©tico)
            var coinBonus = (this.activeMode === 'FRENETIC') ? 100 : 50;
            this.coinCount += coinBonus;
            this.hero.life = 100; // Restaura vida
            
            this.createFloatingText("+" + coinBonus + " ü™ô", this.canvas.width/2, this.canvas.height/2 - 50);
            
            // Texto Visual
            var vicText = document.createElement('div');
            vicText.className = 'battle-victory-text';
            vicText.innerHTML = (this.activeMode === 'FRENETIC') ? "DESTRU√çDO!" : "VENCEU!";
            if (this.activeMode === 'FRENETIC') vicText.style.color = "#ff3333";
            document.body.appendChild(vicText);
            
            var self = this;
            setTimeout(function() {
                if(vicText) vicText.remove();
                self.state = 'PLAYING';
                
                // --- L√ìGICA DE PR√ìXIMO CHEFE ---
                if (self.activeMode === 'FRENETIC') {
                    // MODO FREN√âTICO: Chefe a cada 50 metros
                    self.nextBossScore += 50;
                    console.log("[FREN√âTICO] Pr√≥ximo chefe em: " + self.nextBossScore + "m");
                } else {
                    // MODO NORMAL: Chefe a cada 200 metros (mantendo seu patch anterior)
                    if (self.nextBossScore < 10000) {
                        self.nextBossScore += 200;
                    } else {
                        self.nextBossScore = Infinity;
                    }
                }
                // -------------------------------
                
            }, 2000); // Retorno um pouco mais r√°pido ao jogo (2s)
        };
    }
})();
</script>
<script>
/**
 * PATCH: SISTEMA DE EVENTOS (v1.0)
 * Adiciona tela de eventos, bot√£o no menu e auto-exibi√ß√£o ao iniciar.
 */
(function() {
    var checkGameReady = setInterval(function() {
        if (document.getElementById('menu-screen')) {
            clearInterval(checkGameReady);
            initEventsSystem();
        }
    }, 100);

    function initEventsSystem() {
        console.log("Inicializando Patch: Sistema de Eventos...");

        // 1. INJETAR CSS DOS EVENTOS
        var style = document.createElement('style');
        style.innerHTML = `
            #events-screen {
                background: url('https://i.pinimg.com/736x/ee/34/60/ee34602523edd7e212ca1d98051295b1.jpg') no-repeat center center;
                background-size: cover;
                z-index: 200; /* Acima de tudo */
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: flex-start;
                padding-top: 20px;
            }
            .events-overlay {
                position: absolute; inset: 0; background: rgba(0,0,0,0.85); z-index: -1;
            }
            .events-header {
                font-size: 2.5rem; color: #ffd700; text-transform: uppercase;
                text-shadow: 0 0 15px #ffd700; margin-bottom: 5px;
                animation: pulseText 2s infinite;
            }
            .events-sub {
                color: #aaa; letter-spacing: 2px; font-size: 0.8rem; margin-bottom: 30px;
            }
            .events-list {
                width: 90%; max-width: 500px; max-height: 60vh;
                overflow-y: auto; padding: 10px;
                display: flex; flex-direction: column; gap: 20px;
            }
            .event-card {
                background: rgba(20, 20, 30, 0.9);
                border: 2px solid #555; border-radius: 10px;
                overflow: hidden; position: relative;
                transition: transform 0.2s;
            }
            .event-card:hover { border-color: #00eaff; transform: scale(1.02); }
            .event-img {
                width: 100%; height: 140px; object-fit: cover;
                border-bottom: 1px solid #555;
            }
            .event-info { padding: 15px; text-align: left; }
            .event-title { color: #fff; font-size: 1.2rem; font-weight: bold; margin-bottom: 5px; }
            .event-status { 
                background: #333; color: #aaa; padding: 3px 8px; 
                font-size: 0.7rem; border-radius: 4px; display: inline-block; 
            }
            .event-status.active { background: #00aa00; color: #fff; }
            .event-btn {
                margin-top: 10px; width: 100%; padding: 10px;
                background: linear-gradient(90deg, #444, #222);
                border: none; color: #777; cursor: not-allowed;
                font-family: 'Orbitron', sans-serif; text-transform: uppercase;
            }
        `;
        document.head.appendChild(style);

        // 2. CRIAR HTML DA TELA DE EVENTOS
        var eventsDiv = document.createElement('div');
        eventsDiv.id = 'events-screen';
        eventsDiv.className = 'screen hidden';
        eventsDiv.innerHTML = `
            <div class="events-overlay"></div>
            <h1 class="events-header">Eventos</h1>
            <div class="events-sub">DESAFIOS SAZONAIS & RECOMPENSAS</div>
            
            <div class="events-list">
                <div class="event-card">
                    <img class="event-img" src="https://cinepop.com.br/wp-content/uploads/2025/11/vingadoresdoomsday.webp">
                    <div class="event-info">
                        <div class="event-title">DESTINO FINAL</div>
                        <div class="event-status">üîí EM BREVE</div>
                        <p style="color:#888; font-size:0.8rem; margin:8px 0;">Enfrente a amea√ßa suprema em um mapa apocal√≠ptico.</p>
                        <button class="event-btn">Aguarde</button>
                    </div>
                </div>

                <div class="event-card">
                    <img class="event-img" src="https://shared.akamai.steamstatic.com/store_item_assets/steam/apps/2353060/61fb8243de81a1041b19e11fae599f2b22327443/capsule_616x353.jpg?t=1767817992">
                    <div class="event-info">
                        <div class="event-title">INVENC√çVEL VS.</div>
                        <div class="event-status">üîí EM BREVE</div>
                        <p style="color:#888; font-size:0.8rem; margin:8px 0;">Teste sua for√ßa contra os viltrumitas.</p>
                        <button class="event-btn">Aguarde</button>
                    </div>
                </div>
            </div>

            <button class="btn" onclick="closeEventsScreen()" style="margin-top: 20px; background:#333; border-color:#666; max-width: 200px;">FECHAR</button>
        `;
        document.getElementById('game-wrapper').appendChild(eventsDiv);

        // 3. FUN√á√ïES DE CONTROLE
        window.showEventsScreen = function() {
            UI.hideAll();
            document.getElementById('events-screen').classList.remove('hidden');
        };

        window.closeEventsScreen = function() {
            document.getElementById('events-screen').classList.add('hidden');
            UI.showMenu();
        };

        // 4. ADICIONAR BOT√ÉO NO MENU PRINCIPAL
        var menuContainer = document.querySelector('#menu-screen .selection-container');
        var historyBtn = document.querySelector('button[onclick="UI.showStory()"]');
        
        if (menuContainer && historyBtn) {
            var eventBtn = document.createElement('button');
            eventBtn.className = 'btn';
            eventBtn.innerHTML = "üìÖ EVENTOS";
            eventBtn.style.borderColor = "#ffd700";
            eventBtn.style.color = "#ffedcc";
            eventBtn.onclick = function() {
                AudioSys.sfxClick();
                showEventsScreen();
            };
            // Insere antes do bot√£o de Hist√≥ria
            historyBtn.parentNode.insertBefore(eventBtn, historyBtn);
        }

        // 5. ABRIR AUTOMATICAMENTE AO INICIAR (apenas uma vez por sess√£o)
        if (!sessionStorage.getItem('eventsSeen')) {
            setTimeout(function() {
                showEventsScreen();
                sessionStorage.setItem('eventsSeen', 'true');
            }, 1000); // Pequeno delay para garantir carregamento
        }
    }
})();
</script>
<script>
/**
 * PATCH: PACOTE VILTRUMITA & COMEMORA√á√ÉO RARA (v1.0)
 * Adiciona Omni-Man e Invenc√≠vel com l√≥gica de vit√≥ria customizada.
 */
(function() {
    // Aguarda o carregamento dos dados principais
    var charPatchInterval = setInterval(function() {
        if (typeof HEROES_SKINS !== 'undefined' && typeof Game !== 'undefined') {
            clearInterval(charPatchInterval);
            applyInvinciblePatch();
        }
    }, 200);

    function applyInvinciblePatch() {
        console.log("Aplicando Patch: Personagens Invincible...");

        // 1. ADICIONAR NOVOS HER√ìIS NA LISTA
        // Usamos price: 999999 para garantir que fiquem bloqueados (simulando "Somente Evento")
        // Adicionamos a propriedade customizada 'rareGif' para usar na l√≥gica de vit√≥ria
        
        var omniMan = { 
            id: 'omni-man', 
            baseId: 'viltrum', 
            name: 'Omni-Man', 
            icon: 'https://i.pinimg.com/736x/4f/33/78/4f3378c84943dab532945cbd95ce8157.jpg', 
            introGif: 'https://www.fightersgeneration.com/news2024/char3/omni-man-invincible-earth.gif', 
            gameGif: 'https://media.tenor.com/Yeo26asDCf8AAAAj/invincible-omni-man.gif', 
            quote: "Tenha d√≥ deles, mas n√£o os valorize mais que sua esp√©cie.", 
            price: 999999, 
            color: '#b30000', 
            flip: false, 
            isBase: true, 
            effects: 'energy',
            rareGif: 'https://media1.giphy.com/media/v1.Y2lkPTgyYTE0OTNiOW1sYWVxdHg2cjBobG9pN2s3cHdjZGIyNXB0Nm9lemU2cXdvazYzeSZlcD12MV9zdGlja2Vyc19yZWxhdGVkJmN0PXRz/uXE1EgOEUNvDtIPHFJ/100.webp'
        };

        var invincible = { 
            id: 'invencivel', 
            baseId: 'viltrum', 
            name: 'Invenc√≠vel', 
            icon: 'https://i.pinimg.com/736x/8c/7f/73/8c7f73df52ac137f1ffd4b16518902c0.jpg', 
            introGif: 'https://i.pinimg.com/originals/d6/05/db/d605dbf10862f5ccbfdc6242e8a150ca.gif', 
            gameGif: 'https://media2.giphy.com/media/v1.Y2lkPTgyYTE0OTNiemExcmpyYWgybHZsdjdqbzA3MGY4MndlbXBleW51OGh3dnF5YmFxYSZlcD12MV9zdGlja2Vyc19yZWxhdGVkJmN0PXM/5zDAXIboXHtOyrmlxC/200w.webp', 
            quote: "Eu sou... INVENC√çVEL!", 
            price: 999999, 
            color: '#ffd700', 
            flip: false, 
            rareGif: 'https://media1.giphy.com/media/v1.Y2lkPTgyYTE0OTNiOW1sYWVxdHg2cjBobG9pN2s3cHdjZGIyNXB0Nm9lemU2cXdvazYzeSZlcD12MV9zdGlja2Vyc19yZWxhdGVkJmN0PXRz/uXE1EgOEUNvDtIPHFJ/100.webp'
        };

        HEROES_SKINS.push(omniMan);
        HEROES_SKINS.push(invincible);

        // 2. ATUALIZAR UI DO MENU DE HER√ìIS (Apenas visual para mostrar "EVENTO")
        // Interceptamos a renderiza√ß√£o para trocar o pre√ßo 999999 por "EVENTO"
        var originalShowHero = UI.showHeroSelect;
        UI.showHeroSelect = function() {
            originalShowHero.apply(this);
            // Pequeno delay para manipular o DOM rec√©m-criado
            setTimeout(function() {
                var cards = document.querySelectorAll('.hero-card');
                cards.forEach(function(card) {
                    if(card.innerHTML.includes('999999')) {
                        card.innerHTML = card.innerHTML.replace('999999', 'EVENTO');
                        card.style.borderColor = "#ff3333"; // Borda vermelha para eventos
                    }
                });
            }, 50);
        };
        
        var originalShowSkin = UI.showSkinSelect;
        UI.showSkinSelect = function(baseId) {
            originalShowSkin.apply(this, [baseId]);
            setTimeout(function() {
                var cards = document.querySelectorAll('#skin-list-container .hero-card');
                cards.forEach(function(card) {
                    if(card.innerHTML.includes('999999')) {
                        card.innerHTML = card.innerHTML.replace('999999', 'EVENTO');
                        card.style.borderColor = "#ff3333";
                    }
                });
            }, 50);
        }

        // 3. L√ìGICA DE COMEMORA√á√ÉO RARA
        // Salva a fun√ß√£o de vit√≥ria atual (que pode ser a do patch Fren√©tico ou a original)
        var previousBossVictory = Game.bossVictory;

        Game.bossVictory = function() {
            // Executa a l√≥gica padr√£o primeiro (dar moedas, restaurar vida, criar texto)
            previousBossVictory.apply(this);

            // Verifica se o her√≥i atual √© Omni-Man ou Invenc√≠vel
            var currentHero = this.getHeroData(this.selectedSkinId);
            
            if (currentHero && (currentHero.id === 'omni-man' || currentHero.id === 'invencivel')) {
                // Busca o elemento de texto que acabou de ser criado
                var victoryTextEl = document.querySelector('.battle-victory-text');
                
                if (victoryTextEl && currentHero.rareGif) {
                    // Substitui o texto pelo GIF
                    victoryTextEl.innerHTML = ''; // Limpa "VENCEU" ou "DESTRU√çDO"
                    victoryTextEl.style.textShadow = 'none';
                    victoryTextEl.style.animation = 'popIn 0.5s forwards';
                    
                    var img = document.createElement('img');
                    img.src = currentHero.rareGif;
                    img.style.width = '250px';
                    img.style.height = 'auto';
                    img.style.borderRadius = '15px';
                    img.style.border = '3px solid ' + currentHero.color;
                    img.style.boxShadow = '0 0 30px ' + currentHero.color;
                    
                    victoryTextEl.appendChild(img);
                }
            }
        };
    }
})();
</script>
<script>
/**
 * PATCH: ATUALIZA√á√ÉO DE EVENTO "INVENC√çVEL GO!" (v2.0)
 * Substitui o sistema de eventos anterior, adiciona persist√™ncia de dados
 * e l√≥gica de recompensas com barra de progresso.
 */
(function() {
    // Aguarda o carregamento do patch de eventos anterior (v1.0) para sobrescrev√™-lo
    var eventPatchInterval = setInterval(function() {
        if (typeof window.showEventsScreen !== 'undefined' && document.getElementById('events-screen')) {
            clearInterval(eventPatchInterval);
            initInvincibleGoEvent();
        }
    }, 500);

    function initInvincibleGoEvent() {
        console.log("Inicializando Patch: Evento Invenc√≠vel GO!...");

        // 1. GERENCIAMENTO DE DADOS (Persist√™ncia)
        function getEventData() {
            var data = localStorage.getItem('SuperSky_Event_Invincible');
            return data ? JSON.parse(data) : { omniFrenetic: 0, omniNormal: 0, claimed: false };
        }

        function saveEventData(data) {
            localStorage.setItem('SuperSky_Event_Invincible', JSON.stringify(data));
        }

        // 2. CSS CUSTOMIZADO PARA O NOVO CARD
        var style = document.createElement('style');
        style.innerHTML = `
            .inv-card {
                background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
                border: 2px solid #ffd700;
                box-shadow: 0 0 20px rgba(255, 215, 0, 0.2);
                border-radius: 12px;
                overflow: hidden;
                font-family: 'Rajdhani', sans-serif;
                margin-bottom: 20px;
            }
            .inv-header-img {
                width: 100%;
                height: 160px;
                object-fit: cover;
                border-bottom: 3px solid #ffd700;
            }
            .inv-content { padding: 15px; }
            .inv-title {
                color: #ffd700; font-size: 1.5rem; font-weight: 900;
                text-transform: uppercase; text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
                margin-bottom: 10px; text-align: center;
            }
            .inv-objective {
                margin: 10px 0;
                background: rgba(0,0,0,0.4);
                padding: 8px;
                border-radius: 5px;
            }
            .inv-label { color: #fff; font-size: 0.9rem; display: flex; justify-content: space-between; margin-bottom: 5px; }
            .progress-bg {
                width: 100%; height: 10px; background: #333; border-radius: 5px; overflow: hidden;
                border: 1px solid #555;
            }
            .progress-fill {
                height: 100%; background: linear-gradient(90deg, #ff0000, #ff8800);
                transition: width 0.5s ease-out;
            }
            .inv-rewards {
                display: flex; justify-content: center; align-items: center; gap: 15px;
                margin: 15px 0; background: rgba(255, 215, 0, 0.1); padding: 10px; border-radius: 8px;
            }
            .reward-item { text-align: center; position: relative; }
            .reward-img { width: 50px; height: 50px; border: 2px solid #fff; border-radius: 5px; object-fit: cover; }
            .reward-lock { 
                position: absolute; top:0; left:0; width:100%; height:100%; 
                background: rgba(0,0,0,0.7); display: flex; align-items: center; justify-content: center;
                font-size: 1.2rem; color: #fff;
            }
            .inv-btn-group { display: flex; gap: 10px; margin-top: 15px; }
            .inv-btn {
                flex: 1; padding: 10px; border: none; color: #fff; font-weight: bold;
                text-transform: uppercase; cursor: pointer; border-radius: 4px;
                font-family: 'Orbitron', sans-serif; font-size: 0.8rem;
            }
            .btn-play { background: #0055ff; border: 1px solid #00eaff; }
            .btn-play-frenetic { background: #aa0000; border: 1px solid #ff3333; }
            .btn-claim { 
                width: 100%; background: linear-gradient(90deg, #ffd700, #ffaa00); 
                color: #000; font-size: 1.1rem; margin-top: 10px;
                text-shadow: none; box-shadow: 0 0 15px gold;
            }
            .btn-claim:disabled { filter: grayscale(1); cursor: default; box-shadow: none; opacity: 0.7; }
        `;
        document.head.appendChild(style);

        // 3. OVERRIDE DA TELA DE EVENTOS
        // Sobrescrevemos a fun√ß√£o window.showEventsScreen para renderizar nosso novo layout din√¢mico
        var originalShowEvents = window.showEventsScreen;
        
        window.showEventsScreen = function() {
            // Chamamos a original para garantir que a div fique vis√≠vel
            UI.hideAll();
            var screen = document.getElementById('events-screen');
            screen.classList.remove('hidden');

            var eventData = getEventData();
            
            // Metas
            var goalFrenetic = 5;
            var goalNormal = 2;
            
            // C√°lculos de Porcentagem
            var pctFrenetic = Math.min(100, (eventData.omniFrenetic / goalFrenetic) * 100);
            var pctNormal = Math.min(100, (eventData.omniNormal / goalNormal) * 100);
            var isCompleted = (eventData.omniFrenetic >= goalFrenetic) && (eventData.omniNormal >= goalNormal);
            
            // Busca imagens dos her√≥is (Omni-man e Invencivel) que foram adicionados no Patch anterior
            var omniObj = HEROES_SKINS.find(h => h.id === 'omni-man') || { icon: '' };
            var invObj = HEROES_SKINS.find(h => h.id === 'invencivel') || { icon: '' };

            var listContainer = document.querySelector('.events-list');
            
            // HTML DO CARD
            var html = `
                <div class="inv-card">
                    <img src="https://xboxwire.thesourcemediaassets.com/sites/8/2025/06/Invincible-5672cb0ed866f8bedbbe.jpg" class="inv-header-img">
                    <div class="inv-content">
                        <div class="inv-title">Evento Invenc√≠vel!</div>
                        
                        <div class="inv-objective">
                            <div class="inv-label">
                                <span>‚öîÔ∏è Derrote Omni-Man (Fren√©tico)</span>
                                <span style="color:${pctFrenetic >= 100 ? '#00ff00' : '#fff'}">${eventData.omniFrenetic}/${goalFrenetic}</span>
                            </div>
                            <div class="progress-bg">
                                <div class="progress-fill" style="width: ${pctFrenetic}%;"></div>
                            </div>
                        </div>

                        <div class="inv-objective">
                            <div class="inv-label">
                                <span>üëä Derrote Omni-Man (Normal)</span>
                                <span style="color:${pctNormal >= 100 ? '#00ff00' : '#fff'}">${eventData.omniNormal}/${goalNormal}</span>
                            </div>
                            <div class="progress-bg">
                                <div class="progress-fill" style="width: ${pctNormal}%; background: linear-gradient(90deg, #0055ff, #00eaff);"></div>
                            </div>
                        </div>

                        <div class="inv-rewards">
                            <div class="reward-item">
                                <img src="${omniObj.gameGif || omniObj.icon}" class="reward-img">
                                ${!eventData.claimed ? '<div class="reward-lock">üîí</div>' : ''}
                                <div style="font-size:0.7rem; color:#aaa;">Omni-Man</div>
                            </div>
                            <div style="font-size:1.5rem; color:#ffd700;">+</div>
                            <div class="reward-item">
                                <img src="${invObj.gameGif || invObj.icon}" class="reward-img">
                                ${!eventData.claimed ? '<div class="reward-lock">üîí</div>' : ''}
                                <div style="font-size:0.7rem; color:#aaa;">Invenc√≠vel</div>
                            </div>
                            <div style="font-size:1.5rem; color:#ffd700;">+</div>
                            <div class="reward-item">
                                <div class="reward-img" style="display:flex; align-items:center; justify-content:center; background:#222; border-color:#ffd700; color:#ffd700; font-weight:bold;">500</div>
                                ${!eventData.claimed ? '<div class="reward-lock">üîí</div>' : ''}
                                <div style="font-size:0.7rem; color:#aaa;">Moedas</div>
                            </div>
                        </div>

                        ${isCompleted && !eventData.claimed ? 
                            `<button class="inv-btn btn-claim" onclick="window.claimInvincibleReward()">üéÅ RESGATAR RECOMPENSAS</button>` : 
                            (eventData.claimed ? 
                                `<button class="inv-btn btn-claim" disabled>‚úÖ RECOMPENSA COLETADA</button>` : 
                                `<button class="inv-btn btn-claim" disabled>üîí COMPLETE PARA RESGATAR</button>`
                            )
                        }

                        <div class="inv-btn-group">
                            <button class="inv-btn btn-play" onclick="window.playEventMode('NORMAL')">Jogar Normal</button>
                            <button class="inv-btn btn-play-frenetic" onclick="window.playEventMode('FRENETIC')">Jogar Fren√©tico</button>
                        </div>
                    </div>
                </div>
            `;

            // Substitui todo o conte√∫do antigo da lista de eventos
            listContainer.innerHTML = html;
        };

        // 4. L√ìGICA DE JOGO E MONITORAMENTO DE PROGRESSO
        
        // Fun√ß√µes globais para os bot√µes do HTML injetado
        window.playEventMode = function(mode) {
            AudioSys.sfxClick();
            document.getElementById('events-screen').classList.add('hidden');
            Game.setMode(mode);
            Game.selectScenarioAndStart();
        };

        window.claimInvincibleReward = function() {
            var data = getEventData();
            if (data.claimed) return;

            AudioSys.sfxWin();
            
            // Adiciona Moedas
            PlayerData.coins += 500;
            
            // Desbloqueia Omni-Man e Invenc√≠vel
            if (!PlayerData.unlocked.includes('omni-man')) PlayerData.unlocked.push('omni-man');
            if (!PlayerData.unlocked.includes('invencivel')) PlayerData.unlocked.push('invencivel');
            
            // Salva Global
            localStorage.setItem('SuperSkySave', JSON.stringify(PlayerData));
            
            // Salva Evento
            data.claimed = true;
            saveEventData(data);
            
            // Atualiza UI
            alert("PARAB√âNS! Voc√™ desbloqueou Omni-Man, Invenc√≠vel e ganhou 500 Moedas!");
            window.showEventsScreen(); // Recarrega para mostrar status coletado
            UI.updateStats(); // Atualiza contador de moedas no topo (se vis√≠vel)
        };

        // Intercepta a vit√≥ria do Chefe para contar o progresso
        var previousVictoryLogic = Game.bossVictory;
        
        Game.bossVictory = function() {
            // Executa a l√≥gica original (vit√≥ria, moedas, texto, etc)
            previousVictoryLogic.apply(this);
            
            // L√≥gica do Evento
            if (this.boss && this.boss.data && this.boss.data.id === 'omni-man') {
                var data = getEventData();
                var mode = this.activeMode || 'NORMAL';
                
                var updated = false;
                if (mode === 'FRENETIC') {
                    if (data.omniFrenetic < 5) {
                        data.omniFrenetic++;
                        updated = true;
                        this.createFloatingText("EVENTO: 1/5 (Fren√©tico)", this.canvas.width/2, this.canvas.height/2 + 50);
                    }
                } else {
                    if (data.omniNormal < 2) {
                        data.omniNormal++;
                        updated = true;
                        this.createFloatingText("EVENTO: 1/2 (Normal)", this.canvas.width/2, this.canvas.height/2 + 50);
                    }
                }
                
                if (updated) {
                    saveEventData(data);
                    console.log("Progresso do Evento Invenc√≠vel Atualizado:", data);
                }
            }
        };

        // 5. ATUALIZAR LISTA DE CEN√ÅRIOS PARA INCLUIR IMAGEM DO EVENTO (Opcional, apenas est√©tico)
        // N√£o alteramos o SCENARIOS original para n√£o quebrar √≠ndices, mas a UI j√° usa a imagem no card.
    }
})();
</script>
<script>
/**
 * PATCH v3.0: EVENTO "INVENC√çVEL GO!" - VISUAL DELUXE
 * - Atualiza as recompensas para mostrar √çCONES em vez de Sprites.
 * - Adiciona anima√ß√µes CSS, brilhos e efeitos din√¢micos.
 */
(function() {
    // Garante que o patch rode ap√≥s o carregamento do jogo
    var patchV3Interval = setInterval(function() {
        if (typeof window.showEventsScreen !== 'undefined' && document.getElementById('events-screen')) {
            clearInterval(patchV3Interval);
            initInvincibleV3();
        }
    }, 600);

    function initInvincibleV3() {
        console.log("Aplicando Patch Visual v3.0: Invenc√≠vel GO! (√çcones + Anima√ß√µes)...");

        // 1. DADOS (Mant√©m a persist√™ncia do patch anterior)
        function getEventData() {
            var data = localStorage.getItem('SuperSky_Event_Invincible');
            return data ? JSON.parse(data) : { omniFrenetic: 0, omniNormal: 0, claimed: false };
        }

        // 2. CSS AVAN√áADO (Anima√ß√µes e Efeitos)
        var style = document.createElement('style');
        style.innerHTML = `
            /* Anima√ß√µes Keyframes */
            @keyframes borderFlow {
                0% { border-color: #ff0000; box-shadow: 0 0 10px #ff0000; }
                50% { border-color: #ffd700; box-shadow: 0 0 25px #ffd700, inset 0 0 10px #ffd700; }
                100% { border-color: #ff0000; box-shadow: 0 0 10px #ff0000; }
            }
            @keyframes bgPulse {
                0% { background-position: 0% 50%; }
                50% { background-position: 100% 50%; }
                100% { background-position: 0% 50%; }
            }
            @keyframes iconFloat {
                0% { transform: translateY(0px) scale(1); filter: brightness(1); }
                50% { transform: translateY(-8px) scale(1.05); filter: brightness(1.3); }
                100% { transform: translateY(0px) scale(1); filter: brightness(1); }
            }
            @keyframes titleShine {
                0% { background-position: -200%; }
                100% { background-position: 200%; }
            }

            /* Estilos do Card v3.0 */
            .inv-card-v3 {
                background: linear-gradient(135deg, #0d0d1a 0%, #1a0b0b 100%);
                border: 2px solid #ffd700;
                border-radius: 15px;
                overflow: hidden;
                font-family: 'Rajdhani', sans-serif;
                margin-bottom: 20px;
                position: relative;
                animation: borderFlow 3s infinite alternate;
            }
            
            .inv-header-img-v3 {
                width: 100%;
                height: 160px;
                object-fit: cover;
                border-bottom: 2px solid rgba(255, 215, 0, 0.5);
                mask-image: linear-gradient(to bottom, black 80%, transparent 100%);
            }

            .inv-content-v3 { padding: 15px; position: relative; z-index: 2; }

            .inv-title-v3 {
                font-size: 1.8rem; font-weight: 900; text-transform: uppercase;
                text-align: center; margin-bottom: 15px;
                background: linear-gradient(90deg, #ff0000, #ffff00, #ff0000);
                background-size: 200% auto;
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
                animation: titleShine 3s linear infinite;
                text-shadow: 0 0 20px rgba(255, 0, 0, 0.3);
            }

            .inv-objective-v3 {
                margin: 12px 0;
                background: rgba(255, 255, 255, 0.05);
                padding: 10px; border-radius: 8px;
                border-left: 4px solid #555;
                transition: 0.3s;
            }
            .inv-objective-v3.done { border-left-color: #00ff00; background: rgba(0, 255, 0, 0.1); }
            
            .inv-label-v3 { color: #ddd; font-size: 0.95rem; display: flex; justify-content: space-between; margin-bottom: 6px; font-weight: bold; }
            
            .progress-bg-v3 {
                width: 100%; height: 12px; background: #222; border-radius: 6px; 
                border: 1px solid #444; overflow: hidden; position: relative;
            }
            .progress-fill-v3 {
                height: 100%; background: linear-gradient(90deg, #ff3333, #ffcc00);
                box-shadow: 0 0 10px #ff3333;
                transition: width 0.5s cubic-bezier(0.4, 0.0, 0.2, 1);
            }

            /* √Årea de Recompensas */
            .inv-rewards-v3 {
                display: flex; justify-content: center; align-items: center; gap: 12px;
                margin: 20px 0; 
                background: radial-gradient(circle, rgba(255,215,0,0.15) 0%, rgba(0,0,0,0) 70%);
                padding: 15px 5px;
            }
            
            .reward-box {
                text-align: center; position: relative;
                width: 70px; display: flex; flex-direction: column; align-items: center;
                animation: iconFloat 4s ease-in-out infinite;
            }
            .reward-box:nth-child(2) { animation-delay: 0.5s; } /* Delay para Invenc√≠vel */
            .reward-box:nth-child(4) { animation-delay: 1s; } /* Delay para Moedas */

            .reward-icon-v3 {
                width: 60px; height: 60px; 
                border-radius: 10px; object-fit: cover;
                border: 2px solid #fff;
                box-shadow: 0 0 15px rgba(255,255,255,0.3);
            }
            .reward-icon-omni { border-color: #b30000; box-shadow: 0 0 15px #b30000; }
            .reward-icon-inv { border-color: #ffd700; box-shadow: 0 0 15px #ffd700; }
            .reward-icon-coin { border-color: #00eaff; background: #000; padding: 5px; }

            .reward-lock-v3 {
                position: absolute; top: 0; left: 5px; width: 60px; height: 60px;
                background: rgba(0,0,0,0.6); border-radius: 10px;
                display: flex; align-items: center; justify-content: center;
                font-size: 1.5rem; color: #fff; backdrop-filter: blur(2px);
            }
            
            .reward-name { font-size: 0.7rem; color: #aaa; margin-top: 5px; text-transform: uppercase; letter-spacing: 1px; }

            /* Bot√µes */
            .inv-btn-v3 {
                width: 100%; padding: 12px; border: none; font-weight: bold;
                text-transform: uppercase; cursor: pointer; border-radius: 6px;
                font-family: 'Orbitron', sans-serif; font-size: 0.9rem;
                margin-top: 5px; transition: transform 0.2s;
            }
            .inv-btn-v3:active { transform: scale(0.96); }
            
            .btn-normal { background: linear-gradient(to bottom, #0055ff, #003399); color: white; border: 1px solid #00eaff; }
            .btn-frenetic { background: linear-gradient(to bottom, #cc0000, #880000); color: white; border: 1px solid #ff5555; }
            
            .btn-claim-v3 { 
                background: linear-gradient(90deg, #ffd700, #ffaa00, #ffd700); 
                background-size: 200%; animation: bgPulse 2s linear infinite;
                color: #000; font-size: 1.1rem; border: 2px solid #fff;
                box-shadow: 0 0 20px rgba(255, 215, 0, 0.6);
            }
            .btn-claim-v3:disabled { 
                background: #333; color: #777; border-color: #555; animation: none; box-shadow: none; cursor: default; 
            }
        `;
        document.head.appendChild(style);

        // 3. OVERRIDE DA TELA
        window.showEventsScreen = function() {
            UI.hideAll();
            var screen = document.getElementById('events-screen');
            screen.classList.remove('hidden');

            var eventData = getEventData();
            var goalFrenetic = 5;
            var goalNormal = 2;
            
            var pctFrenetic = Math.min(100, (eventData.omniFrenetic / goalFrenetic) * 100);
            var pctNormal = Math.min(100, (eventData.omniNormal / goalNormal) * 100);
            var isCompleted = (eventData.omniFrenetic >= goalFrenetic) && (eventData.omniNormal >= goalNormal);
            
            // Busca dados dos her√≥is (garantindo que existam)
            var omniObj = HEROES_SKINS.find(h => h.id === 'omni-man') || { icon: '' };
            var invObj = HEROES_SKINS.find(h => h.id === 'invencivel') || { icon: '' };

            var listContainer = document.querySelector('.events-list');
            
            // HTML V3.0
            listContainer.innerHTML = `
                <div class="inv-card-v3">
                    <img src="https://xboxwire.thesourcemediaassets.com/sites/8/2025/06/Invincible-5672cb0ed866f8bedbbe.jpg" class="inv-header-img-v3">
                    
                    <div class="inv-content-v3">
                        <div class="inv-title-v3">Evento Invenc√≠vel!</div>
                        
                        <div class="inv-objective-v3 ${eventData.omniFrenetic >= goalFrenetic ? 'done' : ''}">
                            <div class="inv-label-v3">
                                <span>üî• Derrote Omni-Man (Fren√©tico)</span>
                                <span style="color:${pctFrenetic >= 100 ? '#00ff00' : '#ff9999'}">${eventData.omniFrenetic}/${goalFrenetic}</span>
                            </div>
                            <div class="progress-bg-v3">
                                <div class="progress-fill-v3" style="width: ${pctFrenetic}%;"></div>
                            </div>
                        </div>

                        <div class="inv-objective-v3 ${eventData.omniNormal >= goalNormal ? 'done' : ''}">
                            <div class="inv-label-v3">
                                <span>üõ°Ô∏è Derrote Omni-Man (Normal)</span>
                                <span style="color:${pctNormal >= 100 ? '#00ff00' : '#99ccff'}">${eventData.omniNormal}/${goalNormal}</span>
                            </div>
                            <div class="progress-bg-v3">
                                <div class="progress-fill-v3" style="width: ${pctNormal}%; background: linear-gradient(90deg, #0088ff, #00eaff);"></div>
                            </div>
                        </div>

                        <div class="inv-rewards-v3">
                            
                            <div class="reward-box">
                                <img src="${omniObj.icon}" class="reward-icon-v3 reward-icon-omni">
                                ${!eventData.claimed ? '<div class="reward-lock-v3">üîí</div>' : ''}
                                <div class="reward-name">Omni-Man</div>
                            </div>

                            <div style="font-size:1.5rem; color:#fff; text-shadow:0 0 10px #fff;">+</div>

                            <div class="reward-box">
                                <img src="${invObj.icon}" class="reward-icon-v3 reward-icon-inv">
                                ${!eventData.claimed ? '<div class="reward-lock-v3">üîí</div>' : ''}
                                <div class="reward-name">Invenc√≠vel</div>
                            </div>

                            <div style="font-size:1.5rem; color:#fff; text-shadow:0 0 10px #fff;">+</div>

                            <div class="reward-box">
                                <div class="reward-icon-v3 reward-icon-coin" style="display:flex; justify-content:center; align-items:center;">
                                    <span style="font-size:1.2rem;">ü™ô</span>
                                </div>
                                ${!eventData.claimed ? '<div class="reward-lock-v3">üîí</div>' : ''}
                                <div class="reward-name">500</div>
                            </div>

                        </div>

                        ${isCompleted && !eventData.claimed ? 
                            `<button class="inv-btn-v3 btn-claim-v3" onclick="window.claimInvincibleReward()">üéÅ RESGATAR TUDO</button>` : 
                            (eventData.claimed ? 
                                `<button class="inv-btn-v3 btn-claim-v3" disabled style="opacity:0.6;">‚úÖ COLETADO</button>` : 
                                `<button class="inv-btn-v3 btn-claim-v3" disabled>üîí BLOQUEADO</button>`
                            )
                        }

                        <hr style="border-color:rgba(255,255,255,0.1); margin: 15px 0;">

                        <div style="display: flex; gap: 10px;">
                            <button class="inv-btn-v3 btn-normal" onclick="window.playEventMode('NORMAL')">Modo Normal</button>
                            <button class="inv-btn-v3 btn-frenetic" onclick="window.playEventMode('FRENETIC')">Modo Fren√©tico</button>
                        </div>
                    </div>
                </div>
            `;
        };
    }
})();
</script>
<script>
/**
 * PATCH: EXPANS√ÉO UCHIHA & RAVENA (v4.0)
 * Adiciona Sasuke, Ravena e o Evento Lendas Uchiha (Itachi, Madara, Shisui).
 */
(function() {
    // Aguarda o carregamento das vari√°veis globais do jogo
    var newHeroesInterval = setInterval(function() {
        if (typeof HEROES_SKINS !== 'undefined') {
            clearInterval(newHeroesInterval);
            injectNewHeroes();
        }
    }, 200);

    function injectNewHeroes() {
        console.log("Injetando pacote de her√≥is: Uchiha & Titans...");

        var newCharacters = [
            // --- SASUKE UCHIHA ---
            { 
                id: 'sasuke-susanoo', 
                baseId: 'sasuke', 
                name: 'Sasuke (Susano\'o)', 
                icon: 'https://i.pinimg.com/736x/61/52/00/6152003d9a2e482c341912bf4aeb124a.jpg', 
                introGif: 'https://media.tenor.com/f6bP8gcyJTYAAAAM/sasuke-uchiha.gif', 
                gameGif: 'https://static.wikia.nocookie.net/animeverso/images/2/26/Def44na-a6ca3c1f-9dbf-4a8a-b435-d3705a009919.png/revision/latest?cb=20210723125742&path-prefix=pt-br', 
                quote: "Eu sou um Vingador.", 
                price: 500, 
                color: '#800080', // Roxo
                flip: false, 
                isBase: true,
                effects: 'thunder' 
            },

            // --- RAVENA ---
            { 
                id: 'ravena', 
                baseId: 'ravena', 
                name: 'Ravena', 
                icon: 'https://pbs.twimg.com/media/FrOc3BLWIAAhEqI.png', 
                introGif: 'https://i.pinimg.com/originals/b5/77/73/b577730517cb9f13ccdc1d80bc35aa05.gif', 
                gameGif: 'https://media4.giphy.com/media/v1.Y2lkPTZjMDliOTUybDBqYzUyZmJ0eGczdTBhdmVyODl1OGR3emExcGo1eWZ6Z3hiOGIyNSZlcD12MV9zdGlja2Vyc19zZWFyY2gmY3Q9cw/Hf3tglowYMdp6ikEiL/200w.webp', 
                quote: "Azarath Metrion Zinthos!", 
                price: 200, 
                color: '#4b0082', // Indigo/Roxo Escuro
                flip: false, 
                isBase: true,
                effects: 'energy' 
            },

            // --- ITACHI UCHIHA (EVENTO) ---
            { 
                id: 'itachi-susanoo', 
                baseId: 'itachi', 
                name: 'Itachi (Susano\'o)', 
                icon: 'https://i.pinimg.com/736x/90/8c/7c/908c7cba9a1f2af8b8f3a0171c33771e.jpg', 
                introGif: 'https://64.media.tumblr.com/3f871f2e1e8aa661aa070ec9efd063d8/tumblr_o5trjeMVpn1uyawcho1_1280.gif', 
                gameGif: 'https://www.pikpng.com/pngl/b/560-5607094_image-guardian-png-fairy-tail-fanon-wiki-sasuke.png', 
                quote: "H√° coisas imposs√≠veis, assim como me vencer.", 
                price: 999999, // C√≥digo para "EVENTO"
                color: '#ff4500', // Laranja avermelhado
                flip: true, 
                isBase: true,
                effects: 'energy' 
            },

            // --- MADARA UCHIHA (EVENTO) ---
            { 
                id: 'madara-susanoo', 
                baseId: 'madara', 
                name: 'Madara (Lenda)', 
                icon: 'https://i.pinimg.com/736x/3f/38/3a/3f383a1d3ac00ec284ff4bf1f9544764.jpg', 
                introGif: 'https://giffiles.alphacoders.com/125/125475.gif', 
                gameGif: 'https://i.pinimg.com/originals/8a/36/34/8a363482d0f05766301e19730645ffff.png', 
                quote: "Lenda Ninja!", 
                price: 999999, // C√≥digo para "EVENTO"
                color: '#0000ff', // Azul Susanoo
                flip: false, 
                isBase: true,
                effects: 'thunder' 
            },

            // --- SHISUI UCHIHA (EVENTO) ---
            { 
                id: 'shisui-susanoo', 
                baseId: 'shisui', 
                name: 'Shisui (Susano\'o)', 
                icon: 'https://i.pinimg.com/736x/1b/42/69/1b4269f19108673bbe6e3d849cd876a9.jpg', 
                introGif: 'https://media.tenor.com/ZVVbYJbpAwsAAAAM/hlvtwt-hlvgc.gif', 
                gameGif: 'https://www.nicepng.com/png/full/149-1495207_this-is-the-susanoo-of-itachi-shisui-uchiha.png', 
                quote: "As Vezes o Sacrif√≠cio √© preciso!", 
                price: 999999, // C√≥digo para "EVENTO"
                color: '#00ff00', // Verde Susanoo
                flip: false, 
                isBase: true,
                effects: 'energy' 
            }
        ];

        // Adiciona √† lista global
        newCharacters.forEach(function(hero) {
            // Verifica duplicidade para evitar erros se recarregar
            var exists = HEROES_SKINS.some(function(h) { return h.id === hero.id; });
            if (!exists) {
                HEROES_SKINS.push(hero);
            }
        });

        // For√ßa atualiza√ß√£o da UI se estivermos no menu de sele√ß√£o
        if (typeof UI !== 'undefined' && document.getElementById('hero-select-screen') && !document.getElementById('hero-select-screen').classList.contains('hidden')) {
             UI.showHeroSelect();
        }
    }
})();
</script>
<script>
/**
 * PATCH: PRELOADER INTERATIVO (VISUAL UPDATE)
 * Adiciona carrossel de imagens, dicas e cr√©ditos na tela de loading.
 * Criado para: SuperSky Storm 3D - Android Edition
 */
(function() {
    // Aguarda o preloader original existir no DOM
    var loaderInterval = setInterval(function() {
        var overlay = document.getElementById('preloader-overlay');
        if (overlay) {
            clearInterval(loaderInterval);
            initInteractiveLoader(overlay);
        }
    }, 50);

    function initInteractiveLoader(overlay) {
        console.log("Iniciando Preloader Interativo - Yangverse Games...");

        // 1. CONFIGURA√á√ÉO (Imagens e Dicas)
        var bgImages = [
            'https://w0.peakpx.com/wallpaper/872/1008/HD-wallpaper-e3-2021-dragon-ball-z-kakarot-dlc-3-out-june-11-lords-of-gaming-dbz-kakarot.jpg',
            'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQfM_6l7Z72MA9QRCaTa_sRHkiAF5MgOncXrGv2G_Y-8bu-p7zDI8SEDG8Z&s=10',
            'https://media.tenor.com/Yi4htKvJJ4gAAAAM/goku-superman.gif',
            'https://image.api.playstation.com/vulcan/ap/rnd/202512/0223/e7827d96c3892955c8dd7804ef3ef2e9e5df82425062aabf.jpg',
            'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTkRIifkSqrd3kNQBJTdLDRSSYLj5U0zn5oyLwIVmPxzAYqMawjFvmCan9f&s=10'
        ];

        var gameTips = [
            "üí° DICA: No Modo Fren√©tico, chefes aparecem a cada 50 metros!",
            "üåç CURIOSIDADE: Existem cen√°rios ocultos como 'Terra Sombria'.",
            "üíé ECONOMIA: Skins 3D custam moedas, mas t√™m efeitos visuais √∫nicos.",
            "‚ö° COMBATE: Toque rapidamente na tela para vencer disputas de poder.",
            "üèÜ RANKING: O recorde √© salvo localmente. Tente superar a si mesmo!",
            "ü¶∏ PERSONAGEM: Omni-Man e Invenc√≠vel aparecem apenas em eventos especiais.",
            "üõ°Ô∏è DEFESA: Colete cora√ß√µes ‚ù§Ô∏è para restaurar vida durante o voo."
        ];

        // 2. INJETAR ESTILOS CSS
        var style = document.createElement('style');
        style.innerHTML = `
            /* Ajuste do Overlay Original para permitir fundo */
            #preloader-overlay {
                background-color: transparent !important; /* Remove o fundo preto s√≥lido original */
                background: linear-gradient(to bottom, rgba(0,0,0,0.3), #000) !important;
            }
            
            /* Container das Imagens de Fundo */
            #loader-bg-container {
                position: absolute; top: 0; left: 0; width: 100%; height: 100%;
                z-index: -1; overflow: hidden;
            }
            .loader-bg-img {
                position: absolute; top: 0; left: 0; width: 100%; height: 100%;
                object-fit: cover; opacity: 0; transition: opacity 1s ease-in-out, transform 5s linear;
                transform: scale(1); filter: brightness(0.6);
            }
            .loader-bg-img.active {
                opacity: 1; transform: scale(1.1);
            }

            /* Container de Dicas */
            #loader-tip-box {
                position: absolute; bottom: 80px; width: 90%; text-align: center;
                color: #fff; font-family: 'Rajdhani', sans-serif;
                text-shadow: 0 2px 4px #000;
            }
            .loader-tip-text {
                font-size: 1.1rem; color: #ffd700; font-weight: bold;
                animation: slideUpFade 0.5s ease-out;
            }
            
            /* Cr√©ditos */
            #loader-credits {
                position: absolute; bottom: 10px; width: 100%; text-align: center;
                color: #666; font-size: 0.7rem; letter-spacing: 1px;
                text-transform: uppercase; font-family: 'Orbitron', sans-serif;
                z-index: 10;
            }
            #loader-credits span { color: #00eaff; }

            /* Ajuste dos elementos originais para ficarem vis√≠veis sobre a imagem */
            .loader-title { text-shadow: 0 0 20px #000, 0 0 10px #00eaff; margin-top: -50px; }
            .loader-bar-container { box-shadow: 0 0 30px #000; background: rgba(0,0,0,0.8); }
            .loader-text { background: rgba(0,0,0,0.5); padding: 2px 10px; border-radius: 4px; }

            @keyframes slideUpFade {
                from { opacity: 0; transform: translateY(10px); }
                to { opacity: 1; transform: translateY(0); }
            }
        `;
        document.head.appendChild(style);

        // 3. CRIAR ESTRUTURA HTML ADICIONAL
        
        // Container de Imagens
        var bgContainer = document.createElement('div');
        bgContainer.id = 'loader-bg-container';
        
        // Criar elementos de imagem
        bgImages.forEach(function(url, index) {
            var img = document.createElement('img');
            img.src = url;
            img.className = 'loader-bg-img' + (index === 0 ? ' active' : '');
            bgContainer.appendChild(img);
        });
        overlay.appendChild(bgContainer);

        // Box de Dicas
        var tipBox = document.createElement('div');
        tipBox.id = 'loader-tip-box';
        tipBox.innerHTML = `<div class="loader-tip-text">${gameTips[0]}</div>`;
        overlay.appendChild(tipBox);

        // Cr√©ditos
        var credits = document.createElement('div');
        credits.id = 'loader-credits';
        credits.innerHTML = "Jogo Criado por <span>Yangwen/Yangverse Games</span>";
        overlay.appendChild(credits);

        // Mover elementos originais (barra de progresso) para frente visualmente se necess√°rio
        // (O Z-index do container de fundo j√° √© -1, ent√£o a barra deve ficar em cima naturalmente)

        // 4. L√ìGICA DE ROTA√á√ÉO (Carrossel)
        var currentImgIdx = 0;
        var currentTipIdx = 0;
        var images = document.querySelectorAll('.loader-bg-img');
        var tipText = document.querySelector('.loader-tip-text');

        // Timer para Imagens (Troca a cada 3.5s)
        var imgTimer = setInterval(function() {
            if (overlay.style.display === 'none') { clearInterval(imgTimer); return; }
            
            images[currentImgIdx].classList.remove('active');
            currentImgIdx = (currentImgIdx + 1) % images.length;
            images[currentImgIdx].classList.add('active');
        }, 3500);

        // Timer para Dicas (Troca a cada 4s)
        var tipTimer = setInterval(function() {
            if (overlay.style.display === 'none') { clearInterval(tipTimer); return; }

            currentTipIdx = (currentTipIdx + 1) % gameTips.length;
            
            // Efeito visual simples de troca de texto
            tipBox.style.opacity = 0;
            setTimeout(function() {
                tipBox.innerHTML = `<div class="loader-tip-text">${gameTips[currentTipIdx]}</div>`;
                tipBox.style.opacity = 1;
            }, 300);
            
        }, 4000);
    }
})();
</script>
<script>
/**
 * PATCH: SISTEMA DE DIAMANTES & REVIVER (v5.0)
 * - Adiciona b√¥nus de boas-vindas (10 Diamantes).
 * - Implementa sistema de "Continue" ao morrer (Custo: 1 Diamante ou 50 Moedas).
 * - Limite de 10 revives por partida.
 */
(function() {
    // Aguarda o jogo carregar
    var revivePatchInterval = setInterval(function() {
        if (typeof Game !== 'undefined' && typeof UI !== 'undefined' && document.body) {
            clearInterval(revivePatchInterval);
            initReviveSystem();
        }
    }, 200);

    function initReviveSystem() {
        console.log("Inicializando Patch: Economia de Diamantes & Reviver...");

        // --- 1. CSS DA TELA DE REVIVER ---
        var style = document.createElement('style');
        style.innerHTML = `
            #revive-screen {
                background: rgba(10, 0, 0, 0.95);
                z-index: 150;
                display: flex; flex-direction: column;
                justify-content: center; align-items: center;
                backdrop-filter: blur(10px);
            }
            .revive-box {
                background: linear-gradient(135deg, #1a0b0b 0%, #2d1b1b 100%);
                border: 2px solid #ff3333;
                box-shadow: 0 0 30px rgba(255, 0, 0, 0.3);
                border-radius: 15px;
                padding: 25px;
                width: 90%; max-width: 400px;
                text-align: center;
                animation: pulseBorder 2s infinite;
            }
            @keyframes pulseBorder {
                0% { border-color: #ff3333; }
                50% { border-color: #ff8888; box-shadow: 0 0 50px rgba(255, 0, 0, 0.6); }
                100% { border-color: #ff3333; }
            }
            .revive-title {
                font-size: 2rem; color: #fff; margin-bottom: 10px;
                text-transform: uppercase; text-shadow: 0 0 10px #ff0000;
            }
            .revive-timer {
                font-size: 3rem; color: #ffd700; font-weight: bold; margin: 10px 0;
            }
            .revive-info { color: #aaa; margin-bottom: 20px; font-family: 'Rajdhani', sans-serif; }
            .revive-options { display: flex; flex-direction: column; gap: 15px; }
            
            .btn-revive {
                background: #333; border: 1px solid #fff; color: #fff;
                padding: 15px; border-radius: 8px; cursor: pointer;
                display: flex; justify-content: space-between; align-items: center;
                font-family: 'Orbitron', sans-serif; font-size: 1rem;
                transition: transform 0.2s, background 0.2s;
            }
            .btn-revive:active { transform: scale(0.98); }
            
            .btn-gem { border-color: #00eaff; background: linear-gradient(90deg, #004455, #002233); }
            .btn-coin { border-color: #ffd700; background: linear-gradient(90deg, #554400, #332200); }
            .btn-giveup { border-color: #555; background: transparent; color: #777; justify-content: center; margin-top: 10px; font-size: 0.8rem;}
            
            .currency-cost { font-weight: bold; font-size: 1.2rem; }
            .revive-count-badge {
                background: #ff0000; color: white; padding: 2px 8px; border-radius: 4px; font-size: 0.8rem;
                position: absolute; top: 10px; right: 10px;
            }
        `;
        document.head.appendChild(style);

        // --- 2. HTML DA TELA DE REVIVER ---
        var reviveDiv = document.createElement('div');
        reviveDiv.id = 'revive-screen';
        reviveDiv.className = 'screen hidden';
        reviveDiv.innerHTML = `
            <div class="revive-box">
                <div class="revive-count-badge">REVIVES: <span id="revive-counter">0</span>/10</div>
                <div class="revive-title">SISTEMA CR√çTICO!</div>
                <div class="revive-info">Seu her√≥i caiu. Deseja reviver e continuar a pontua√ß√£o?</div>
                
                <div class="revive-options">
                    <button class="btn-revive btn-gem" onclick="Game.tryRevive('GEMS')">
                        <span>üíé Usar Diamante</span>
                        <span class="currency-cost">1</span>
                    </button>
                    
                    <button class="btn-revive btn-coin" onclick="Game.tryRevive('COINS')">
                        <span>ü™ô Usar Moedas</span>
                        <span class="currency-cost">50</span>
                    </button>
                    
                    <button class="btn-revive btn-giveup" onclick="Game.giveUpAndEnd()">
                        ‚ùå DESISTIR E ACEITAR O FIM
                    </button>
                </div>
                
                <div style="margin-top: 15px; font-size: 0.8rem; color: #666;">
                    Saldo Atual: <span id="revive-balance-gem">0</span> üíé | <span id="revive-balance-coin">0</span> ü™ô
                </div>
            </div>
        `;
        document.getElementById('game-wrapper').appendChild(reviveDiv);

        // --- 3. L√ìGICA: B√îNUS DE BOAS-VINDAS ---
        function checkWelcomeGift() {
            var hasClaimed = localStorage.getItem('SuperSky_WelcomeGift_v1');
            
            if (!hasClaimed) {
                // Adiciona 10 Diamantes
                PlayerData.gems = (PlayerData.gems || 0) + 10;
                Game.saveGameData();
                localStorage.setItem('SuperSky_WelcomeGift_v1', 'true');
                
                // Exibe mensagem
                setTimeout(function() {
                    alert("‚ú® PRESENTE DE CONQUISTA! ‚ú®\n\nParab√©ns, piloto! Voc√™ ganhou 10 DIAMANTES gratuitos para come√ßar sua jornada.\n\nUse-os para comprar skins ou reviver durante a partida!");
                    UI.updateStats();
                }, 1000);
            }
        }
        // Executa verifica√ß√£o ao iniciar
        checkWelcomeGift();

        // --- 4. OVERRIDE: L√ìGICA DE JOGO ---
        
        // A) Inicializar contador de revives na partida
        Game.revivesUsed = 0;
        var originalStart = Game.startMatch;
        Game.startMatch = function(bgUrl) {
            this.revivesUsed = 0; // Reseta contador
            originalStart.call(this, bgUrl);
        };

        // B) Interceptar o Game Over
        var originalGameOver = Game.gameOver;
        Game.gameOver = function() {
            // Verifica se pode reviver (menos de 10 usos)
            if (this.revivesUsed < 10) {
                this.showReviveScreen();
            } else {
                // Se acabou os revives, game over normal
                originalGameOver.call(this);
            }
        };

        // C) Fun√ß√£o para exibir tela de Revive
        Game.showReviveScreen = function() {
            this.state = 'PAUSED'; // Pausa o jogo
            
            // Atualiza UI da tela de revive
            document.getElementById('revive-counter').innerText = this.revivesUsed;
            document.getElementById('revive-balance-gem').innerText = PlayerData.gems;
            // Soma as moedas coletadas na partida atual com as do banco para mostrar o total dispon√≠vel
            var totalCoinsAvailable = PlayerData.coins + this.coinCount; 
            document.getElementById('revive-balance-coin').innerText = totalCoinsAvailable;

            UI.hideAll();
            document.getElementById('revive-screen').classList.remove('hidden');
            
            // Tocar som de alerta
            AudioSys.playTone(150, 'sawtooth', 0.5, 0.2);
        };

        // D) Tentar Reviver (A√ß√£o dos Bot√µes)
        Game.tryRevive = function(method) {
            var cost = (method === 'GEMS') ? 1 : 50;
            var canPay = false;

            // L√≥gica de Pagamento
            if (method === 'GEMS') {
                if (PlayerData.gems >= cost) {
                    PlayerData.gems -= cost;
                    canPay = true;
                } else {
                    alert("Diamantes insuficientes!");
                }
            } else {
                // Para moedas, considera o que j√° pegou na fase + banco
                var totalCoins = PlayerData.coins + this.coinCount;
                if (totalCoins >= cost) {
                    // Deduz primeiro das moedas coletadas na fase
                    if (this.coinCount >= cost) {
                        this.coinCount -= cost;
                    } else {
                        // Se n√£o der, zera as da fase e tira o resto do banco
                        var remainder = cost - this.coinCount;
                        this.coinCount = 0;
                        PlayerData.coins -= remainder;
                    }
                    canPay = true;
                } else {
                    alert("Moedas insuficientes!");
                }
            }

            if (canPay) {
                this.executeRevive();
            }
        };

        // E) Executar o Revive
        Game.executeRevive = function() {
            AudioSys.sfxWin(); // Som de sucesso
            
            this.revivesUsed++;
            this.hero.life = 100; // Restaura vida
            
            // Empurra obst√°culos pr√≥ximos para evitar morrer instantaneamente
            this.obstacles.forEach(ob => ob.x += 300);
            this.projectiles = []; // Limpa tiros

            document.getElementById('revive-screen').classList.add('hidden');
            document.getElementById('hud').classList.remove('hidden');
            document.getElementById('hero-layer').classList.remove('hidden');
            
            // Se houver boss ativo, mostra o HUD dele de volta
            if (this.boss && this.boss.active) {
                document.getElementById('boss-hud').style.display = 'flex';
                document.getElementById('boss-layer').style.display = 'block';
            }

            this.state = 'PLAYING'; // Retoma o jogo
            
            // Efeito visual de invencibilidade tempor√°ria
            var heroEl = document.getElementById('hero-layer');
            heroEl.style.opacity = '0.5';
            setTimeout(() => heroEl.style.opacity = '1', 2000);
            
            this.createFloatingText("REVIVIDO!", this.canvas.width/2, this.canvas.height/2);
            Game.saveGameData(); // Salva o gasto das moedas/gemas
        };

        // F) Desistir
        Game.giveUpAndEnd = function() {
            AudioSys.sfxClick();
            document.getElementById('revive-screen').classList.add('hidden');
            originalGameOver.call(this); // Chama o Game Over real
        };
    }
})();
</script>
<script>
/**
 * PATCH v6.0: MODO BOSS ULTIMATE
 * Adiciona modo de jogo com IA Progressiva, Eventos de Terror e Spawn Diferenciado.
 */
(function() {
    // Aguarda o jogo carregar completamente
    var bossModeInterval = setInterval(function() {
        if (typeof Game !== 'undefined' && typeof UI !== 'undefined' && document.getElementById('menu-screen')) {
            clearInterval(bossModeInterval);
            initBossMode();
        }
    }, 200);

    function initBossMode() {
        console.log("Inicializando Patch: MODO BOSS (v6.0)...");

        // 1. CSS PARA EFEITOS VISUAIS (TREMOR, ESCURID√ÉO)
        var style = document.createElement('style');
        style.innerHTML = `
            /* Efeito de Tremor e Escurid√£o (800m+) */
            .nightmare-effect {
                animation: shakeScreen 0.2s infinite;
                filter: brightness(0.4) contrast(1.5) sepia(0.5) hue-rotate(-50deg) !important;
            }
            @keyframes shakeScreen {
                0% { transform: translate(0, 0) rotate(0deg); }
                25% { transform: translate(-5px, 5px) rotate(-1deg); }
                50% { transform: translate(5px, -5px) rotate(1deg); }
                75% { transform: translate(-5px, -5px) rotate(-1deg); }
                100% { transform: translate(0, 0) rotate(0deg); }
            }
            
            /* Bot√£o do Novo Modo */
            .btn-boss-mode {
                background: linear-gradient(to bottom, #4a0000, #220000);
                border: 2px solid #ff0000;
                color: #ffcccc;
                box-shadow: 0 0 15px #ff0000;
                margin-top: 10px;
                position: relative;
                overflow: hidden;
            }
            .btn-boss-mode::after {
                content: 'üíÄ';
                position: absolute; right: 10px; opacity: 0.5;
            }
            .boss-warning {
                position: absolute; top: 30%; left: 0; width: 100%;
                text-align: center; font-size: 3rem; color: red; font-weight: 900;
                text-shadow: 0 0 20px black; z-index: 999;
                pointer-events: none;
                animation: pulseText 0.5s infinite;
            }
        `;
        document.head.appendChild(style);

        // 2. ADICIONAR BOT√ÉO NO MENU
        var menuContainer = document.querySelector('#menu-screen .selection-container');
        var playBtn = document.querySelector('button[onclick*="UI.showHeroSelect()"]');
        
        if (menuContainer && playBtn) {
            var bossBtn = document.createElement('button');
            bossBtn.className = 'btn btn-boss-mode';
            bossBtn.innerHTML = "MODO BOSS RUSH";
            bossBtn.onclick = function() {
                AudioSys.sfxClick();
                Game.activeMode = 'BOSS_MODE';
                UI.showHeroSelect();
            };
            
            // Inserir imagem de background do bot√£o (via CSS inline para garantir)
            bossBtn.style.backgroundImage = "linear-gradient(rgba(0,0,0,0.7), rgba(0,0,0,0.7)), url('https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTrirLpKJcQF-dAY1LOSHdFftjwEWciBDb3aTfsEdSiwlGwPkvhDsJMcKse&s=10')";
            bossBtn.style.backgroundSize = "cover";
            bossBtn.style.backgroundPosition = "center";
            
            playBtn.parentNode.insertBefore(bossBtn, playBtn.nextSibling);
        }

        // 3. VARI√ÅVEIS DE CONTROLE DO MODO
        Game.bossModeData = {
            nextMiniBoss: 50,
            nextBigBoss: 200,
            raged: false
        };

        // 4. OVERRIDE: IN√çCIO DA PARTIDA
        var _originalStart = Game.startMatch;
        Game.startMatch = function(bgUrl) {
            _originalStart.call(this, bgUrl);
            
            // Resetar efeitos visuais
            document.body.classList.remove('nightmare-effect');
            document.getElementById('hud').style.opacity = '1';
            
            if (this.activeMode === 'BOSS_MODE') {
                this.gameSpeed = 12; // Velocidade aumentada como solicitado
                this.bossModeData.nextMiniBoss = 50;
                this.bossModeData.nextBigBoss = 200;
                this.bossModeData.raged = false;
                this.nextBossScore = 999999; // Desativa o boss do modo normal para usarmos nossa l√≥gica
                
                this.createFloatingText("üíÄ MODO BOSS ATIVADO üíÄ", this.canvas.width/2, this.canvas.height/2);
            }
        };

        // 5. OVERRIDE: UPDATE LOOP (L√≥gica de Spawn)
        var _originalUpdate = Game.update;
        Game.update = function() {
            _originalUpdate.call(this);

            if (this.state === 'PLAYING' && this.activeMode === 'BOSS_MODE') {
                // Checar Spawn de Mini Boss (50m)
                if (this.score >= this.bossModeData.nextMiniBoss && this.score < this.bossModeData.nextBigBoss) {
                    this.spawnCustomBoss(false); // False = Mini Boss (Sem di√°logo)
                    this.bossModeData.nextMiniBoss += 50;
                    // Se o pr√≥ximo mini boss cair em cima de um Big Boss, pula
                    if (this.bossModeData.nextMiniBoss % 200 === 0) this.bossModeData.nextMiniBoss += 50;
                }

                // Checar Spawn de Big Boss (200m)
                if (this.score >= this.bossModeData.nextBigBoss) {
                    this.spawnCustomBoss(true); // True = Big Boss (Com di√°logo)
                    this.bossModeData.nextBigBoss += 200;
                    this.bossModeData.nextMiniBoss = this.score + 50; // Reseta ciclo de mini bosses
                }
            }
        };

        // 6. FUN√á√ÉO DE SPAWN CUSTOMIZADO
        Game.spawnCustomBoss = function(isBigBoss) {
            // Limpa tela
            this.obstacles = [];
            this.items = [];
            
            // Escolhe inimigo
            var opponents = HEROES_SKINS.filter(h => h.id !== this.selectedSkinId);
            var randomOpp = opponents[Math.floor(Math.random() * opponents.length)];
            
            this.boss.data = randomOpp;
            this.boss.maxLife = isBigBoss ? 150 + (this.score * 0.1) : 40; // Mini boss tem pouca vida
            this.boss.life = this.boss.maxLife;
            this.boss.x = this.canvas.width * 0.85;
            this.boss.y = this.canvas.height / 2;
            this.boss.active = true;
            this.boss.shootTimer = 0;
            this.boss.isBig = isBigBoss; // Flag para IA
            
            // Setup Visual
            var bossLayer = document.getElementById('boss-layer');
            bossLayer.style.display = 'block';
            document.getElementById('boss-sprite').src = randomOpp.gameGif;
            var scaleDir = randomOpp.flip ? 1 : -1;
            bossLayer.style.transform = `translate(-50%, -50%) scaleX(${scaleDir})`;

            if (isBigBoss) {
                // MODO COM DI√ÅLOGO E CUTSCENE
                this.state = 'BOSS_DIALOGUE';
                
                // Di√°logos Novos para Modo Boss
                var bossDialogues = [
                    { speaker: 'enemy', text: "Voc√™ sobreviveu aos meus soldados... Mas eu sou o fim." },
                    { speaker: 'hero', text: "Vou derrubar voc√™ e quem mais vier!" }
                ];
                
                // Varia√ß√£o para 1000m
                if (this.score >= 1000) {
                    bossDialogues = [
                        { speaker: 'enemy', text: "EU SOU A VELOCIDADE! EU SOU A MORTE!" },
                        { speaker: 'hero', text: "Vamos acabar com isso agora!" }
                    ];
                }

                UI.showDialogue(this.heroData.icon, this.heroData.name, randomOpp.icon, randomOpp.name, bossDialogues, () => {
                     this.startBossBattle();
                     UI.updateBossHUD(100, "CHEFE: " + randomOpp.name);
                });
            } else {
                // MODO SILENCIOSO (MINI BOSS)
                this.state = 'BOSS_BATTLE';
                UI.updateBossHUD(100, "SOLDADO: " + randomOpp.name);
            }
        };

        // 7. OVERRIDE: IA DO BOSS (A parte inteligente)
        var _originalBossAI = Game.bossAI;
        Game.bossAI = function() {
            // Se n√£o for Modo Boss, usa a IA original burrinha
            if (this.activeMode !== 'BOSS_MODE') {
                _originalBossAI.call(this);
                return;
            }

            // --- L√ìGICA MODO BOSS ---
            
            var speed = 0.05; // Base
            var shootRate = 40; // Base (quanto menor, mais r√°pido)
            var moveType = 'TRACK'; // TRACK = Segue o player

            // 1. Configura√ß√£o por Dist√¢ncia (Evolu√ß√£o)
            if (this.score >= 1000) {
                // 1000M: Inteligente, R√°pido
                speed = 0.15;
                shootRate = 15; // Metralhadora
                moveType = 'PREDICT'; // Tenta adivinhar onde o player vai
            } else if (this.score >= 400) {
                // 400M: Mais dano e velocidade
                speed = 0.09;
                shootRate = 25;
            } else if (this.score >= 200) {
                // 200M: Lento mas atira mais
                speed = 0.04;
                shootRate = 30;
            }

            // 2. Comportamento de Movimento
            if (moveType === 'PREDICT') {
                // Move para onde o player EST√Å INDO, n√£o onde ele est√°
                var predictY = this.hero.targetY; 
                this.boss.y += (predictY - this.boss.y) * speed;
            } else {
                // Padr√£o
                this.boss.y += (this.hero.y - this.boss.y) * speed;
            }

            // Limites de tela
            if(this.boss.y < 50) this.boss.y = 50;
            if(this.boss.y > this.canvas.height - 50) this.boss.y = this.canvas.height - 50;

            // Atualiza Visual
            var bossLayer = document.getElementById('boss-layer');
            bossLayer.style.top = this.boss.y + 'px';
            bossLayer.style.left = this.boss.x + 'px';
            var scaleDir = this.boss.data.flip ? 1 : -1;
            bossLayer.style.transform = `translate(-50%, -50%) scaleX(${scaleDir})`;

            // 3. EVENTOS DE VIDA (RAGE)
            var hpPct = (this.boss.life / this.boss.maxLife) * 100;

            // 400M+ (50% HP): Fica vermelho e mais r√°pido
            if (this.score >= 400 && hpPct <= 50) {
                bossLayer.style.filter = "drop-shadow(0 0 20px red) sepia(1)";
                shootRate = shootRate / 1.5; // Atira muito mais r√°pido
            }

            // 800M+ (20% HP): O TERROR (Tela Escura + HUD some)
            if (this.score >= 800 && hpPct <= 20 && !this.bossModeData.raged) {
                this.bossModeData.raged = true;
                
                // Ativa efeito
                document.body.classList.add('nightmare-effect');
                
                // Esconde HUD por 2s
                var hud = document.getElementById('hud');
                hud.style.opacity = '0';
                
                // Aviso na tela
                var warn = document.createElement('div');
                warn.className = 'boss-warning';
                warn.innerText = "‚ö† SISTEMA FALHANDO ‚ö†";
                document.body.appendChild(warn);

                // Restaura ap√≥s 2s
                setTimeout(() => {
                    document.body.classList.remove('nightmare-effect');
                    hud.style.opacity = '1';
                    warn.remove();
                }, 2000);
            }

            // 4. DISPAROS
            this.boss.shootTimer++;
            if (this.boss.shootTimer > shootRate) {
                this.shootProjectile('boss');
                // Se for 1000m+, atira duplo
                if (this.score >= 1000) {
                    setTimeout(() => this.shootProjectile('boss'), 100);
                }
                this.boss.shootTimer = 0;
            }
        };
        
        // 8. CORRE√á√ÉO DE VIT√ìRIA (Resetar flags)
        var _originalVictory = Game.bossVictory;
        Game.bossVictory = function() {
            _originalVictory.call(this);
            // Garante que o efeito de pesadelo saia se matar o boss durante o efeito
            document.body.classList.remove('nightmare-effect');
            document.getElementById('hud').style.opacity = '1';
            this.bossModeData.raged = false;
        };
    }
})();
</script>
<script>
/**
 * PATCH v6.1: ATUALIZA√á√ÉO BOSS RUSH & MAPA EXCLUSIVO
 * - Novo Cen√°rio: Antimat√©ria Terra-X (Exclusivo Modo Boss)
 * - Corre√ß√£o de Loop Infinito (1000m+)
 * - Ajuste de Spawn: Soldado (50m) / Boss (200m)
 */
(function() {
    // Aguarda o sistema de jogo e o patch anterior carregarem
    var bossPatchInterval = setInterval(function() {
        if (typeof Game !== 'undefined' && typeof Game.spawnCustomBoss !== 'undefined') {
            clearInterval(bossPatchInterval);
            applyBossRushUpdate();
        }
    }, 300);

    function applyBossRushUpdate() {
        console.log("Aplicando Patch v6.1: Mapa Terra-X e L√≥gica Infinita...");

        // 1. CONFIGURA√á√ÉO DO MAPA EXCLUSIVO (Com Proxy para evitar tela preta)
        // Usamos um servi√ßo de tratamento de imagem para garantir que o Canvas aceite a URL externa
        const BOSS_MAP_URL = 'https://wsrv.nl/?url=' + encodeURIComponent('https://static.wikia.nocookie.net/arrow/images/a/ad/Antimat%C3%A9ria_destruindo_a_Terra-X.png/revision/latest?cb=20240305060558&path-prefix=pt-br') + '&output=jpg&q=85';

        // 2. OVERRIDE: IN√çCIO DA PARTIDA (Inje√ß√£o do Mapa)
        const _originalStartMatch = Game.startMatch;
        Game.startMatch = function(bgUrl) {
            // Se for Modo Boss, for√ßamos o mapa da Antimat√©ria
            let finalBg = bgUrl;
            if (this.activeMode === 'BOSS_MODE') {
                finalBg = BOSS_MAP_URL;
                // Ajuste visual para o mapa vermelho
                document.getElementById('hud').style.textShadow = "0 0 5px #000"; 
            }
            
            // Chama a fun√ß√£o original com a URL trocada
            _originalStartMatch.call(this, finalBg);
            
            // Garante reset dos contadores para a l√≥gica infinita
            if (this.activeMode === 'BOSS_MODE') {
                this.bossModeData = {
                    nextMiniBoss: 50,
                    nextBigBoss: 200,
                    raged: false
                };
            }
        };

        // 3. OVERRIDE: L√ìGICA DE UPDATE (Garantir Loop Infinito P√≥s-1000m)
        // Precisamos interceptar o update para garantir a matem√°tica exata de 50m/200m
        const _originalUpdate = Game.update;
        
        Game.update = function() {
            // Executa f√≠sica e l√≥gica padr√£o primeiro
            _originalUpdate.call(this);

            // Refor√ßo da L√≥gica de Spawn do Modo Boss
            if (this.state === 'PLAYING' && this.activeMode === 'BOSS_MODE') {
                
                // --- REGRA DE OURO: BOSS (200m) TEM PRIORIDADE ---
                
                // Checar Boss Principal (M√∫ltiplos de 200m)
                // Usamos uma margem de seguran√ßa (gap) para n√£o pular frames
                if (this.score >= this.bossModeData.nextBigBoss) {
                    this.spawnCustomBoss(true); // TRUE = Big Boss
                    
                    // Configura o pr√≥ximo Big Boss para daqui a 200m
                    this.bossModeData.nextBigBoss += 200;
                    
                    // Reseta o ciclo de mini-bosses para come√ßar 50m AP√ìS este chefe morrer
                    // Isso evita que um soldado nas√ßa junto com o chefe
                    this.bossModeData.nextMiniBoss = Math.floor(this.score) + 50;
                    return; // Sai para n√£o spawnar mini boss junto
                }

                // Checar Mini Boss / Soldado (M√∫ltiplos de 50m)
                if (this.score >= this.bossModeData.nextMiniBoss) {
                    
                    // Verifica se n√£o est√° muito perto de um Big Boss (evita sobreposi√ß√£o)
                    let distToBig = this.bossModeData.nextBigBoss - this.score;
                    
                    if (distToBig > 30) { 
                        // Se falta mais de 30m para o chef√£o, pode spawnar soldado
                        this.spawnCustomBoss(false); // FALSE = Soldado
                        this.bossModeData.nextMiniBoss += 50;
                    } else {
                        // Se est√° quase na hora do chef√£o, pula este soldado
                        this.bossModeData.nextMiniBoss += 50;
                    }
                }
            }
        };

        // 4. OVERRIDE: INTELIG√äNCIA ARTIFICIAL (Ajuste para > 1000m)
        const _originalAI = Game.bossAI;
        
        Game.bossAI = function() {
            // Se n√£o for modo boss, usa original
            if (this.activeMode !== 'BOSS_MODE') {
                _originalAI.call(this);
                return;
            }

            // --- L√ìGICA DE DIFICULDADE INFINITA ---
            var speed = 0.05;
            var shootRate = 40;
            var moveType = 'TRACK'; // Padr√£o

            // Escalonamento Infinito
            if (this.score >= 2000) {
                // N√çVEL PESADELO (2000m+)
                speed = 0.20; // Muito R√°pido
                shootRate = 10; // Metralhadora
                moveType = 'PREDICT';
            } else if (this.score >= 1000) {
                // N√çVEL EXTOMO (1000m+)
                speed = 0.15;
                shootRate = 15;
                moveType = 'PREDICT'; // Prev√™ movimento
            } else if (this.score >= 400) {
                speed = 0.09;
                shootRate = 25;
            } else if (this.score >= 200) {
                speed = 0.06;
                shootRate = 30;
            }

            // Aplica√ß√£o do Movimento
            if (moveType === 'PREDICT') {
                // Tenta interceptar o jogador
                var target = this.hero.targetY + (Math.random() * 40 - 20); // Um pouco de erro para n√£o ser imposs√≠vel
                this.boss.y += (target - this.boss.y) * speed;
            } else {
                // Segue o jogador
                this.boss.y += (this.hero.y - this.boss.y) * speed;
            }

            // Limites de tela
            if(this.boss.y < 50) this.boss.y = 50;
            if(this.boss.y > this.canvas.height - 50) this.boss.y = this.canvas.height - 50;

            // Renderiza√ß√£o
            var bossLayer = document.getElementById('boss-layer');
            bossLayer.style.top = this.boss.y + 'px';
            bossLayer.style.left = this.boss.x + 'px';
            
            // Corre√ß√£o de Flip visual
            if (this.boss.data) {
                var scaleDir = this.boss.data.flip ? 1 : -1;
                bossLayer.style.transform = `translate(-50%, -50%) scaleX(${scaleDir})`;
            }

            // Disparos
            this.boss.shootTimer++;
            if (this.boss.shootTimer > shootRate) {
                this.shootProjectile('boss');
                // Disparo Triplo ap√≥s 1000m
                if (this.score >= 1000) {
                    setTimeout(() => this.shootProjectile('boss'), 150);
                    setTimeout(() => this.shootProjectile('boss'), 300);
                }
                this.boss.shootTimer = 0;
            }
            
            // Efeitos visuais do Boss (Rage Mode)
            var hpPct = (this.boss.life / this.boss.maxLife);
            if (this.score >= 800 && hpPct < 0.3) {
                 // Mant√©m a l√≥gica de tremor do patch anterior
                 if (!document.body.classList.contains('nightmare-effect') && !this.bossModeData.raged) {
                     this.bossModeData.raged = true;
                     document.body.classList.add('nightmare-effect');
                     setTimeout(() => document.body.classList.remove('nightmare-effect'), 2000);
                 }
            }
        };
    }
})();
</script>
<script>
/**
 * PATCH v7.0: MODO SOBREVIV√äNCIA (TORNEIO DO PODER)
 * - Mapa Exclusivo: Torneio do Poder (Infinito)
 * - Inimigos a cada 50m (Sem di√°logo, direto para a luta)
 * - Velocidade Acelerada
 * - SEM RECUPERA√á√ÉO DE VIDA ao vencer
 */
(function() {
    // Aguarda o carregamento completo do jogo
    var survivalInterval = setInterval(function() {
        if (typeof Game !== 'undefined' && document.getElementById('menu-screen')) {
            clearInterval(survivalInterval);
            initSurvivalMode();
        }
    }, 300);

    function initSurvivalMode() {
        console.log("Inicializando Patch: MODO SOBREVIV√äNCIA...");

        // 1. PREPARA√á√ÉO DO MAPA (Usando Proxy para garantir funcionamento no Canvas)
        // Imagem do Torneio do Poder
        var RAW_MAP_URL = 'https://i.pinimg.com/originals/cf/3b/ab/cf3babb37024c1773be17cd23a32b701.jpg';
        var SURVIVAL_MAP_URL = 'https://wsrv.nl/?url=' + encodeURIComponent(RAW_MAP_URL) + '&output=jpg&q=85';

        // 2. CSS DO BOT√ÉO E VISUAIS
        var style = document.createElement('style');
        style.innerHTML = `
            .btn-survival {
                position: relative;
                border: 2px solid #a600ff;
                color: #fff;
                text-shadow: 0 0 5px #a600ff;
                box-shadow: 0 0 20px rgba(166, 0, 255, 0.4);
                overflow: hidden;
                margin-top: 10px;
                background-size: cover;
                background-position: center;
                transition: transform 0.2s;
            }
            .btn-survival:active { transform: scale(0.96); }
            .btn-survival::before {
                content: ''; position: absolute; inset: 0;
                background: linear-gradient(to right, rgba(0,0,0,0.8), rgba(50,0,100,0.6));
                z-index: 0;
            }
            .btn-survival span { position: relative; z-index: 1; }
            
            /* Indicador de Modo Hardcore */
            .survival-hud-warning {
                position: absolute; top: 60px; right: 15px;
                color: #ff0000; font-size: 0.8rem; font-weight: bold;
                animation: blinkRed 1s infinite;
                z-index: 35; pointer-events: none;
                text-shadow: 0 0 5px #000;
            }
            @keyframes blinkRed { 50% { opacity: 0.5; } }
        `;
        document.head.appendChild(style);

        // 3. ADICIONAR BOT√ÉO NO MENU
        var menuContainer = document.querySelector('#menu-screen .selection-container');
        // Procura o √∫ltimo bot√£o para inserir depois dele
        var buttons = menuContainer.querySelectorAll('.btn');
        var lastButton = buttons[buttons.length - 1];

        if (menuContainer) {
            var survBtn = document.createElement('button');
            survBtn.className = 'btn btn-survival';
            // Imagem do bot√£o vinda do prompt
            survBtn.style.backgroundImage = "url('https://images7.alphacoders.com/878/thumb-1920-878515.jpg')";
            survBtn.innerHTML = "<span>‚ò†Ô∏è MODO SOBREVIV√äNCIA</span>";
            
            survBtn.onclick = function() {
                if(typeof AudioSys !== 'undefined') AudioSys.sfxClick();
                Game.activeMode = 'SURVIVAL';
                UI.showHeroSelect();
            };

            // Insere ap√≥s o √∫ltimo bot√£o existente
            if(lastButton) {
                lastButton.parentNode.insertBefore(survBtn, lastButton.nextSibling);
            } else {
                menuContainer.appendChild(survBtn);
            }
        }

        // Vari√°vel para controlar o spawn
        Game.survivalNextBoss = 50;

        // 4. OVERRIDE: INICIAR PARTIDA (Configura√ß√£o do Modo)
        var _originalStart = Game.startMatch;
        Game.startMatch = function(bgUrl) {
            // Remove aviso antigo se existir
            var oldWarn = document.querySelector('.survival-hud-warning');
            if(oldWarn) oldWarn.remove();

            if (this.activeMode === 'SURVIVAL') {
                // For√ßa o mapa do Torneio do Poder
                _originalStart.call(this, SURVIVAL_MAP_URL);
                
                // Configura√ß√µes Espec√≠ficas
                this.gameSpeed = 12; // Velocidade inicial acelerada
                this.survivalNextBoss = 50; // Come√ßa cedo
                
                // Remove HUD do Boss Rush anterior se tiver sobrado
                this.nextBossScore = Infinity; 
                
                this.createFloatingText("‚ò†Ô∏è SOBREVIV√äNCIA ‚ò†Ô∏è", this.canvas.width/2, this.canvas.height/2);
                this.createFloatingText("SEM CURA!", this.canvas.width/2, this.canvas.height/2 + 40);

                // Aviso constante na tela
                var warn = document.createElement('div');
                warn.className = 'survival-hud-warning';
                warn.innerText = "‚ö† HP N√ÉO REGENERA ‚ö†";
                document.getElementById('game-wrapper').appendChild(warn);

            } else {
                // Modos normais
                _originalStart.call(this, bgUrl);
            }
        };

        // 5. OVERRIDE: UPDATE (L√≥gica de Spawn e Velocidade)
        var _originalUpdate = Game.update;
        Game.update = function() {
            // Acelera√ß√£o constante no modo sobreviv√™ncia
            if (this.activeMode === 'SURVIVAL' && this.state === 'PLAYING') {
                // Aumenta velocidade mais r√°pido que o normal
                this.gameSpeed = 12 + (this.score * 0.005); 
            }

            _originalUpdate.call(this);

            // L√≥gica de Spawn Exclusiva
            if (this.activeMode === 'SURVIVAL' && this.state === 'PLAYING') {
                if (this.score >= this.survivalNextBoss) {
                    this.spawnSurvivalBoss();
                    this.survivalNextBoss += 50; // A cada 50m fixo
                }
            }
        };

        // 6. FUN√á√ÉO DE SPAWN R√ÅPIDO (Sem Di√°logo)
        Game.spawnSurvivalBoss = function() {
            // Limpa obst√°culos para a luta
            this.obstacles = [];
            this.items = []; // Sem itens de cura durante spawn do boss
            
            // Escolhe oponente
            var opponents = HEROES_SKINS.filter(h => h.id !== this.selectedSkinId);
            var randomOpp = opponents[Math.floor(Math.random() * opponents.length)];
            
            this.boss.data = randomOpp;
            // Vida aumenta conforme a dist√¢ncia
            this.boss.maxLife = 50 + (this.score * 0.15); 
            this.boss.life = this.boss.maxLife;
            
            // Posi√ß√£o
            this.boss.x = this.canvas.width * 0.85;
            this.boss.y = this.canvas.height / 2;
            this.boss.active = true;
            this.boss.shootTimer = 0;
            
            // Setup Visual
            var bossLayer = document.getElementById('boss-layer');
            bossLayer.style.display = 'block';
            document.getElementById('boss-sprite').src = randomOpp.gameGif;
            
            var scaleDir = randomOpp.flip ? 1 : -1;
            bossLayer.style.transform = `translate(-50%, -50%) scaleX(${scaleDir})`;
            bossLayer.style.filter = "drop-shadow(0 0 10px #a600ff)"; // Aura roxa do torneio

            // PULA O DI√ÅLOGO -> VAI DIRETO PARA BATALHA
            this.state = 'BOSS_BATTLE';
            UI.updateBossHUD(100, "RIVAL: " + randomOpp.name);
            
            // Som de alerta
            if(typeof AudioSys !== 'undefined') AudioSys.playTone(100, 'sawtooth', 0.5, 0.2);
        };

        // 7. OVERRIDE: VIT√ìRIA (BLOQUEAR CURA)
        var _originalVictory = Game.bossVictory;
        Game.bossVictory = function() {
            if (this.activeMode !== 'SURVIVAL') {
                // Se n√£o for sobreviv√™ncia, usa a l√≥gica padr√£o (que cura)
                _originalVictory.call(this);
                return;
            }

            // --- L√ìGICA DE VIT√ìRIA SOBREVIV√äNCIA (SEM CURA) ---
            this.state = 'BOSS_VICTORY';
            if(typeof AudioSys !== 'undefined') AudioSys.sfxWin();
            
            // Esconde Boss
            document.getElementById('boss-layer').style.display = 'none';
            document.getElementById('boss-hud').style.display = 'none';
            this.projectiles = [];
            
            // Ganha moedas, mas N√ÉO CURA (this.hero.life = 100 removido)
            this.coinCount += 50;
            this.createFloatingText("+50 ü™ô", this.canvas.width/2, this.canvas.height/2 - 50);
            
            // Feedback Visual
            var vicText = document.createElement('div');
            vicText.className = 'battle-victory-text';
            vicText.innerHTML = "ELIMINADO";
            vicText.style.color = "#a600ff";
            vicText.style.textShadow = "0 0 20px #fff";
            document.body.appendChild(vicText);
            
            var self = this;
            setTimeout(function() {
                if(vicText) vicText.remove();
                self.state = 'PLAYING';
                // O pr√≥ximo boss j√° foi agendado no update loop
            }, 1000); // Retorno r√°pido (1s) para manter o ritmo fren√©tico
        };
        
        // 8. OVERRIDE: IA DO BOSS (Ajuste para sobreviv√™ncia)
        // Garante que a IA funcione mesmo se o patch Boss Mode n√£o estiver ativo
        var _originalAI = Game.bossAI;
        Game.bossAI = function() {
            if (this.activeMode === 'SURVIVAL') {
                // IA Agressiva do modo sobreviv√™ncia
                this.boss.y += (this.hero.y - this.boss.y) * 0.08;
                
                // Limites
                if(this.boss.y < 50) this.boss.y = 50;
                if(this.boss.y > this.canvas.height - 50) this.boss.y = this.canvas.height - 50;
                
                // Render
                var bossLayer = document.getElementById('boss-layer');
                bossLayer.style.top = this.boss.y + 'px';
                bossLayer.style.left = this.boss.x + 'px';
                
                // Tiroteio
                this.boss.shootTimer++;
                // Atira bem r√°pido
                if (this.boss.shootTimer > 25) { 
                    this.shootProjectile('boss');
                    this.boss.shootTimer = 0;
                }
            } else {
                _originalAI.call(this);
            }
        };

        console.log("Modo Sobreviv√™ncia carregado com sucesso.");
    }
})();
</script>
<script>
/**
 * PATCH v8.0: MISS√ïES DI√ÅRIAS & DESAFIOS (SYSTEM OVERRIDE)
 * - Sistema de 24h Reais
 * - 7 Miss√µes Aleat√≥rias
 * - Recompensas: Moedas, Diamantes, Personagens
 * - Persist√™ncia via LocalStorage
 */
(function() {
    // Aguarda o jogo carregar
    var missionsInterval = setInterval(function() {
        if (typeof Game !== 'undefined' && document.body) {
            clearInterval(missionsInterval);
            DailyMissions.init();
        }
    }, 500);

    var DailyMissions = {
        data: {
            lastLogin: null,
            missions: [],
            claimedCount: 0
        },
        // Configura√ß√µes Visuais
        assets: {
            icon: 'https://i.pinimg.com/originals/a5/f9/a2/a5f9a2eb5c0bfb1f66988696e1f31334.png',
            bg: 'https://wallpapers-clan.com/wp-content/uploads/2024/03/dragon-ball-goku-sparks-gif-cover-desktop-wallpaper.gif'
        },
        
        // Banco de Dados de Poss√≠veis Miss√µes
        missionPool: [
            { type: 'DISTANCE', target: 1500, title: 'Corredor Veloz', desc: 'Chegue a 1500m em uma partida', rewardType: 'COIN', rewardQty: 200 },
            { type: 'DISTANCE', target: 3000, title: 'Resist√™ncia Pura', desc: 'Chegue a 3000m em uma partida', rewardType: 'DIAMOND', rewardQty: 5 },
            { type: 'BOSS_KILL', target: 2, title: 'Matador de Chefes', desc: 'Derrote 2 Bosses no total', rewardType: 'COIN', rewardQty: 300 },
            { type: 'BOSS_KILL', target: 5, title: 'Exterm√≠nio', desc: 'Derrote 5 Bosses no total', rewardType: 'SKIN', rewardQty: 1 }, // Skin aleat√≥ria ou moedas se j√° tiver
            { type: 'COINS', target: 500, title: 'Ca√ßador de Tesouros', desc: 'Colete 500 moedas', rewardType: 'DIAMOND', rewardQty: 10 },
            { type: 'PLAY_CHAR', target: 1, title: 'Treino Variado', desc: 'Jogue com um personagem diferente', rewardType: 'COIN', rewardQty: 100 },
            { type: 'NO_DAMAGE', target: 1, title: 'Intoc√°vel', desc: 'Derrote 1 Boss sem levar dano', rewardType: 'DIAMOND', rewardQty: 15 }
        ],

        init: function() {
            console.log("Inicializando Sistema de Miss√µes Di√°rias...");
            this.loadData();
            this.createStyles();
            this.createUI();
            this.injectGameHooks();
        },

        // --- L√ìGICA DE DADOS ---
        loadData: function() {
            var saved = localStorage.getItem('SuperSky_Missions_v1');
            if (saved) {
                this.data = JSON.parse(saved);
            }
            
            // Verifica se passaram 24h ou se √© novo dia
            var today = new Date().toDateString();
            if (this.data.lastLogin !== today) {
                this.generateNewMissions(today);
            }
        },

        generateNewMissions: function(dateString) {
            this.data.lastLogin = dateString;
            this.data.missions = [];
            this.data.claimedCount = 0;
            
            // Seleciona 7 miss√µes aleat√≥rias
            var poolCopy = [...this.missionPool]; // Copia para n√£o alterar original
            for (var i = 0; i < 7; i++) {
                if (poolCopy.length === 0) poolCopy = [...this.missionPool]; // Reseta se acabar
                var rIndex = Math.floor(Math.random() * poolCopy.length);
                
                // Cria inst√¢ncia da miss√£o
                var mission = JSON.parse(JSON.stringify(poolCopy[rIndex]));
                mission.id = i;
                mission.current = 0;
                mission.completed = false;
                mission.claimed = false;
                
                // Personaliza miss√£o de personagem (Se houver lista de her√≥is)
                if (mission.type === 'PLAY_CHAR' && typeof HEROES_SKINS !== 'undefined') {
                    var randomHero = HEROES_SKINS[Math.floor(Math.random() * HEROES_SKINS.length)];
                    mission.desc = 'Jogue uma partida com: ' + randomHero.name;
                    mission.reqId = randomHero.id;
                }

                this.data.missions.push(mission);
            }
            this.saveData();
            this.showNotification(true);
        },

        saveData: function() {
            localStorage.setItem('SuperSky_Missions_v1', JSON.stringify(this.data));
            this.updateUI();
        },

        // --- SISTEMA DE PROGRESSO ---
        track: function(type, amount, extraData) {
            var updated = false;
            this.data.missions.forEach(m => {
                if (!m.completed && m.type === type) {
                    
                    // L√≥gica espec√≠fica
                    var process = true;
                    if (type === 'PLAY_CHAR' && m.reqId !== extraData) process = false;
                    if (type === 'DISTANCE') {
                        // Dist√¢ncia n√£o soma, √© "High Score" na partida atual
                        if (amount > m.current) m.current = Math.floor(amount);
                    } else if (process) {
                        // Outros tipos somam (Kills, Coins)
                        m.current += amount;
                    }

                    // Verifica conclus√£o
                    if (m.current >= m.target) {
                        m.current = m.target;
                        m.completed = true;
                        updated = true;
                        
                        // Notifica√ß√£o In-Game
                        if (typeof Game !== 'undefined') {
                            Game.createFloatingText("MISS√ÉO COMPLETA!", Game.canvas.width/2, 100, "#ffd700");
                        }
                    } else if (process) {
                         updated = true; // Atualizou progresso
                    }
                }
            });

            if (updated) {
                this.saveData();
                this.showNotification(true);
            }
        },

        // --- INTERFACE (UI) ---
        createStyles: function() {
            var css = `
                /* √çcone Flutuante */
                #mission-icon {
                    position: absolute; top: 10px; right: 80px; width: 60px; height: 60px;
                    background: url('${this.assets.icon}') no-repeat center/contain;
                    z-index: 999; cursor: pointer; filter: drop-shadow(0 0 5px #000);
                    transition: transform 0.2s;
                }
                #mission-icon:hover { transform: scale(1.1); }
                #mission-notification {
                    position: absolute; top: 0; right: 0; width: 15px; height: 15px;
                    background: red; border-radius: 50%; border: 2px solid #fff;
                    display: none; animation: blink 1s infinite;
                }
                
                /* Modal/Menu */
                #mission-modal {
                    display: none; position: fixed; inset: 0; z-index: 1000;
                    background: rgba(0,0,0,0.85); align-items: center; justify-content: center;
                    backdrop-filter: blur(5px);
                }
                .mission-content {
                    width: 90%; max-width: 500px; height: 80%;
                    background: url('${this.assets.bg}') no-repeat center/cover;
                    border: 2px solid #ffd700; border-radius: 10px;
                    box-shadow: 0 0 30px rgba(255, 215, 0, 0.3);
                    display: flex; flex-direction: column; overflow: hidden;
                    position: relative;
                }
                .mission-header {
                    background: rgba(0,0,0,0.9); padding: 15px; text-align: center;
                    border-bottom: 2px solid #ffd700;
                }
                .mission-header h2 { margin: 0; color: #ffd700; font-family: 'Orbitron', sans-serif; text-transform: uppercase; }
                .mission-timer { font-size: 0.8rem; color: #ccc; margin-top: 5px; }
                .close-mission {
                    position: absolute; top: 10px; right: 15px; font-size: 24px;
                    color: #fff; cursor: pointer; font-weight: bold;
                }
                
                /* Lista de Miss√µes */
                .mission-list {
                    flex: 1; overflow-y: auto; padding: 10px;
                    background: rgba(0,0,0,0.7);
                }
                .mission-item {
                    background: rgba(20, 20, 30, 0.9); border: 1px solid #444;
                    margin-bottom: 10px; padding: 10px; border-radius: 5px;
                    display: flex; flex-direction: column; gap: 5px;
                }
                .mission-top { display: flex; justify-content: space-between; align-items: center; }
                .m-title { font-weight: bold; color: #fff; font-size: 0.9rem; }
                .m-reward { color: #ffd700; font-size: 0.8rem; display: flex; align-items: center; gap: 5px; }
                .m-desc { font-size: 0.75rem; color: #aaa; }
                
                /* Barra de Progresso */
                .progress-container {
                    width: 100%; height: 8px; background: #333; border-radius: 4px; overflow: hidden;
                    margin: 5px 0; position: relative;
                }
                .progress-fill {
                    height: 100%; background: linear-gradient(90deg, #00ff00, #00aa00);
                    width: 0%; transition: width 0.5s;
                }
                .progress-text {
                    position: absolute; top: -14px; right: 0; font-size: 0.7rem; color: #fff;
                }
                
                /* Bot√£o Reclamar */
                .btn-claim {
                    width: 100%; padding: 8px; border: none; border-radius: 3px;
                    font-family: 'Orbitron', sans-serif; font-weight: bold; cursor: pointer;
                    text-transform: uppercase; margin-top: 5px;
                    transition: all 0.2s;
                }
                .btn-claim.locked { background: #333; color: #666; cursor: not-allowed; }
                .btn-claim.ready { 
                    background: linear-gradient(45deg, #ffd700, #ffaa00); color: #000;
                    box-shadow: 0 0 10px #ffd700; animation: pulseBtn 1s infinite;
                }
                .btn-claim.claimed { background: #1a1a1a; color: #00ff00; border: 1px solid #00ff00; }
                
                @keyframes pulseBtn { 50% { opacity: 0.8; } }
                @keyframes blink { 50% { opacity: 0; } }
            `;
            var style = document.createElement('style');
            style.innerHTML = css;
            document.head.appendChild(style);
        },

        createUI: function() {
            // √çcone
            var icon = document.createElement('div');
            icon.id = 'mission-icon';
            icon.innerHTML = '<div id="mission-notification"></div>';
            icon.onclick = () => {
                document.getElementById('mission-modal').style.display = 'flex';
                this.showNotification(false);
            };
            document.body.appendChild(icon);

            // Modal
            var modal = document.createElement('div');
            modal.id = 'mission-modal';
            modal.innerHTML = `
                <div class="mission-content">
                    <div class="mission-header">
                        <h2>Miss√µes Di√°rias</h2>
                        <div class="mission-timer">Atualiza em: <span id="reset-timer">--:--</span></div>
                        <div class="close-mission" onclick="document.getElementById('mission-modal').style.display='none'">‚úï</div>
                    </div>
                    <div class="mission-list" id="mission-list-container">
                        </div>
                </div>
            `;
            document.body.appendChild(modal);
            this.updateUI();
            this.startTimer();
        },

        updateUI: function() {
            var container = document.getElementById('mission-list-container');
            if (!container) return;
            container.innerHTML = '';

            this.data.missions.forEach(m => {
                var pct = (m.current / m.target) * 100;
                var btnClass = 'locked';
                var btnText = 'Em Progresso';
                var btnAction = '';

                if (m.claimed) {
                    btnClass = 'claimed';
                    btnText = '‚úì Recompensado';
                } else if (m.completed) {
                    btnClass = 'ready';
                    btnText = 'RECOLHER RECOMPENSA';
                    btnAction = `onclick="DailyMissions.claimReward(${m.id})"`;
                }

                var rewardIcon = m.rewardType === 'COIN' ? 'ü™ô' : (m.rewardType === 'DIAMOND' ? 'üíé' : 'ü¶∏‚Äç‚ôÇÔ∏è');
                var rewardDisplay = `${rewardIcon} ${m.rewardQty}`;
                if (m.rewardType === 'SKIN') rewardDisplay = "ü¶∏‚Äç‚ôÇÔ∏è Novo Her√≥i / 500ü™ô";

                var html = `
                    <div class="mission-item">
                        <div class="mission-top">
                            <span class="m-title">${m.title}</span>
                            <span class="m-reward">${rewardDisplay}</span>
                        </div>
                        <div class="m-desc">${m.desc}</div>
                        <div class="progress-container">
                            <div class="progress-fill" style="width: ${pct}%"></div>
                            <span class="progress-text">${m.current}/${m.target}</span>
                        </div>
                        <button class="btn-claim ${btnClass}" ${btnAction} ${m.claimed ? 'disabled' : ''}>${btnText}</button>
                    </div>
                `;
                container.innerHTML += html;
            });
        },

        showNotification: function(show) {
            var notif = document.getElementById('mission-notification');
            if (notif) notif.style.display = show ? 'block' : 'none';
        },

        startTimer: function() {
            setInterval(() => {
                var now = new Date();
                var tomorrow = new Date(now);
                tomorrow.setDate(tomorrow.getDate() + 1);
                tomorrow.setHours(0,0,0,0);
                
                var diff = tomorrow - now;
                var hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                var minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                
                var el = document.getElementById('reset-timer');
                if(el) el.innerText = `${hours}h ${minutes}m`;
            }, 60000);
        },

        claimReward: function(id) {
            var m = this.data.missions.find(x => x.id === id);
            if (m && m.completed && !m.claimed) {
                m.claimed = true;
                this.saveData();

                // Efeito sonoro
                if(typeof AudioSys !== 'undefined') AudioSys.sfxWin();

                // L√≥gica de Entrega
                if (m.rewardType === 'COIN') {
                    Game.coinCount += m.rewardQty;
                    alert(`Voc√™ recebeu ${m.rewardQty} Moedas!`);
                } else if (m.rewardType === 'DIAMOND') {
                    // Adiciona vari√°vel de diamantes se n√£o existir
                    if (typeof Game.diamondCount === 'undefined') Game.diamondCount = 0;
                    Game.diamondCount += m.rewardQty;
                    // Salva no sistema principal se existir, sen√£o fica na sess√£o
                    alert(`Voc√™ recebeu ${m.rewardQty} Diamantes!`);
                } else if (m.rewardType === 'SKIN') {
                    // L√≥gica simples de personagem: se j√° tem todos, d√° moedas
                    var locked = HEROES_SKINS.filter(h => !h.unlocked); // Supondo que exista flag unlocked
                    if (locked.length > 0) {
                        // C√≥digo para desbloquear (depende da estrutura do seu jogo)
                        // Como n√£o tenho acesso a fun√ß√£o de save do jogo original, dou moedas como fallback seguro
                        Game.coinCount += 500;
                        alert("Recompensa de Her√≥i convertida em 500 Moedas (Desbloqueio requer save do sistema principal).");
                    } else {
                        Game.coinCount += 500;
                        alert("Voc√™ j√° tem muitos her√≥is! Recebeu 500 Moedas.");
                    }
                }
                
                // Atualiza HUD do jogo se necess√°rio
                if(typeof UI !== 'undefined' && UI.updateCoins) UI.updateCoins();
            }
        },

        // --- INJE√á√ÉO NO JOGO (HOOKS) ---
        injectGameHooks: function() {
            console.log("Injetando Hooks de Miss√µes...");

            // Hook 1: Iniciar Partida (Verifica personagem escolhido)
            var _origStart = Game.startMatch;
            Game.startMatch = function(bg) {
                _origStart.call(this, bg);
                // Flag para miss√£o 'NO_DAMAGE'
                this.heroReceivedDamage = false; 
                DailyMissions.track('PLAY_CHAR', 1, this.selectedSkinId);
            };

            // Hook 2: Update Loop (Dist√¢ncia)
            var _origUpdate = Game.update;
            Game.update = function() {
                _origUpdate.call(this);
                if (this.state === 'PLAYING') {
                    // Verifica progresso a cada 100 frames para n√£o pesar
                    if (this.frameCount % 100 === 0) {
                        DailyMissions.track('DISTANCE', this.score);
                    }
                }
            };

            // Hook 3: Vit√≥ria contra Boss
            var _origVictory = Game.bossVictory;
            Game.bossVictory = function() {
                _origVictory.call(this);
                
                DailyMissions.track('BOSS_KILL', 1);
                
                if (!this.heroReceivedDamage) {
                    DailyMissions.track('NO_DAMAGE', 1);
                }
            };
            
            // Hook 4: Receber Dano (Para invalidar NO_DAMAGE)
            // Precisamos interceptar quando a vida diminui
            // Vamos observar a propriedade life do heroi via Proxy ou alterar a fun√ß√£o checkCollisions
            var _origCol = Game.checkCollisions;
            Game.checkCollisions = function() {
                var lifeBefore = this.hero ? this.hero.life : 0;
                _origCol.call(this);
                var lifeAfter = this.hero ? this.hero.life : 0;
                
                if (lifeAfter < lifeBefore) {
                    this.heroReceivedDamage = true;
                }
            };
            
            // Hook 5: Coleta de Moedas
            // Se houver uma fun√ß√£o addCoin, usamos ela, sen√£o monitoramos no update
            // Vamos assumir rastreamento passivo no loop para ser mais seguro
            setInterval(() => {
                if (typeof Game !== 'undefined' && Game.coinCount) {
                    DailyMissions.track('COINS', 0); // S√≥ chama para validar triggers, o valor real precisaria de diff
                    // Simplifica√ß√£o: Miss√£o de moedas checa o total atual na sess√£o
                    // Para ser perfeito precisaria hookar onde a moeda sobe.
                }
            }, 5000);
            
            // Hook Moeda Espec√≠fico (Melhor tentativa)
            var oldCreateFloat = Game.createFloatingText;
            Game.createFloatingText = function(text, x, y, color) {
                oldCreateFloat.call(this, text, x, y, color);
                // Se o texto contiver "+" e for amarelo (moeda), conta
                if (text && text.includes('+') && (color === '#ffd700' || text.includes('ü™ô'))) {
                    // Extrai n√∫mero
                    var num = parseInt(text.replace(/\D/g, ''));
                    if (!isNaN(num)) DailyMissions.track('COINS', num);
                }
            };
        }
    };
    
    // Torna global para acesso
    window.DailyMissions = DailyMissions;

})();
</script>
<script>
/**
 * PATCH v9.0: MENU AVAN√áADO & UI OVERHAUL
 * Organiza todos os modos e bot√µes em um Grid Futurista com Part√≠culas.
 */
(function() {
    // Aguarda que todos os patches anteriores (v1 a v8) tenham carregado seus bot√µes
    var menuInterval = setInterval(function() {
        if (typeof Game !== 'undefined' && typeof UI !== 'undefined' && document.getElementById('menu-screen')) {
            clearInterval(menuInterval);
            initAdvancedMenu();
        }
    }, 800); // Delay de 800ms para garantir que os outros scripts rodaram

    function initAdvancedMenu() {
        console.log("Inicializando Menu Avan√ßado v9.0...");

        // 1. INJE√á√ÉO DE CSS AVAN√áADO
        var style = document.createElement('style');
        style.innerHTML = `
            /* --- ESTILOS DO MENU AVAN√áADO --- */
            #advanced-menu-container {
                width: 100%; height: 100%;
                display: flex; flex-direction: column;
                align-items: center; justify-content: center;
                position: relative; z-index: 10;
            }

            /* T√≠tulo com Glitch melhorado */
            .menu-logo {
                font-size: 3.5rem; text-transform: uppercase;
                background: linear-gradient(to bottom, #fff, #888);
                -webkit-background-clip: text; color: transparent;
                text-shadow: 0 0 20px rgba(0, 234, 255, 0.8);
                margin-bottom: 5px; letter-spacing: 4px;
                animation: floatTitle 3s ease-in-out infinite;
            }
            .menu-version {
                color: #00eaff; font-size: 0.9rem; letter-spacing: 6px;
                margin-bottom: 25px; text-shadow: 0 0 5px #00eaff;
                opacity: 0.8;
            }

            /* Linha de Utilidades (Hist√≥ria, Score, Eventos) */
            .utility-row {
                display: flex; gap: 15px; margin-bottom: 20px;
                width: 90%; max-width: 500px; justify-content: center;
            }
            .util-btn {
                background: rgba(0, 20, 40, 0.8);
                border: 1px solid #00eaff; color: #fff;
                padding: 10px 15px; border-radius: 8px;
                font-family: 'Rajdhani', sans-serif; font-weight: bold;
                text-transform: uppercase; cursor: pointer;
                flex: 1; display: flex; flex-direction: column; align-items: center;
                transition: all 0.2s; position: relative; overflow: hidden;
                box-shadow: 0 0 10px rgba(0, 234, 255, 0.1);
            }
            .util-btn:hover { background: #00eaff; color: #000; box-shadow: 0 0 20px #00eaff; transform: translateY(-3px); }
            .util-btn span { font-size: 1.5rem; margin-bottom: 5px; }
            
            /* Destaque para Eventos */
            .util-btn.event-highlight {
                border-color: #ffd700; color: #ffd700;
                animation: pulseBorder 2s infinite;
            }
            .util-btn.event-highlight:hover { background: #ffd700; color: #000; }

            /* Grid de Modos de Jogo */
            .modes-grid {
                display: grid; grid-template-columns: 1fr 1fr;
                gap: 15px; width: 90%; max-width: 500px;
                margin-bottom: 20px;
            }

            .mode-card {
                position: relative; height: 100px;
                border-radius: 12px; cursor: pointer;
                overflow: hidden; display: flex; flex-direction: column;
                align-items: center; justify-content: center;
                transition: transform 0.2s, filter 0.2s;
                border: 2px solid transparent;
                background-size: cover; background-position: center;
            }
            .mode-card:hover { transform: scale(1.03); z-index: 5; }
            .mode-card::before {
                content: ''; position: absolute; inset: 0;
                background: linear-gradient(to top, rgba(0,0,0,0.9), rgba(0,0,0,0.4));
                z-index: 1; transition: opacity 0.3s;
            }
            .mode-card:hover::before { opacity: 0.7; }
            
            .mode-icon { font-size: 2rem; z-index: 2; text-shadow: 0 0 10px rgba(0,0,0,0.8); margin-bottom: 5px; }
            .mode-title { 
                font-family: 'Orbitron', sans-serif; color: #fff; z-index: 2; 
                text-transform: uppercase; font-size: 0.9rem; letter-spacing: 1px;
                text-shadow: 0 2px 4px #000; font-weight: bold;
            }

            /* Estilos Espec√≠ficos dos Modos */
            .mode-normal { 
                border-color: #00eaff; box-shadow: 0 0 15px rgba(0, 234, 255, 0.3);
                background-image: url('https://i.pinimg.com/736x/87/00/66/870066d8704207908ce901968172901a.jpg');
            }
            .mode-frenetic { 
                border-color: #ff3333; box-shadow: 0 0 15px rgba(255, 51, 51, 0.3);
                background-image: url('https://i.pinimg.com/736x/c9/79/33/c97933f88998846c483a918731737e5c.jpg');
            }
            .mode-boss { 
                border-color: #800000; box-shadow: 0 0 15px rgba(128, 0, 0, 0.5);
                background-image: url('https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTrirLpKJcQF-dAY1LOSHdFftjwEWciBDb3aTfsEdSiwlGwPkvhDsJMcKse&s=10');
            }
            .mode-survival { 
                border-color: #a600ff; box-shadow: 0 0 15px rgba(166, 0, 255, 0.4);
                background-image: url('https://images7.alphacoders.com/878/thumb-1920-878515.jpg');
            }

            /* Currency Footer */
            .menu-footer {
                display: flex; gap: 20px;
                background: rgba(0,0,0,0.8); padding: 10px 30px;
                border-radius: 50px; border: 1px solid #555;
                margin-top: 10px;
            }
            .currency-item { font-size: 1.1rem; color: #fff; font-weight: bold; display: flex; align-items: center; gap: 8px; }

            /* Particles Canvas */
            #menu-particles {
                position: absolute; top: 0; left: 0; width: 100%; height: 100%;
                z-index: 0; pointer-events: none;
            }

            @keyframes floatTitle { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-5px); } }
            @keyframes pulseBorder { 0% { border-color: #ffd700; box-shadow: 0 0 5px gold; } 50% { border-color: #ffaa00; box-shadow: 0 0 20px gold; } 100% { border-color: #ffd700; box-shadow: 0 0 5px gold; } }
        `;
        document.head.appendChild(style);

        // 2. RECONSTRU√á√ÉO DO DOM DO MENU
        var menuScreen = document.getElementById('menu-screen');
        var oldContainer = menuScreen.querySelector('.selection-container');
        
        // Criar Novo Container
        var newContainer = document.createElement('div');
        newContainer.id = 'advanced-menu-container';

        // HTML do Novo Menu
        newContainer.innerHTML = `
            <canvas id="menu-particles"></canvas>
            
            <div class="menu-logo" data-text="SuperSky">SUPERSKY</div>
            <div class="menu-version">STORM 3D - ULTIMATE</div>

            <div class="utility-row">
                <div class="util-btn" onclick="UI.showStory()">
                    <span>üìñ</span> Hist√≥ria
                </div>
                <div class="util-btn" onclick="UI.showScoreScreen()">
                    <span>üèÜ</span> Placar
                </div>
                <div class="util-btn event-highlight" onclick="window.showEventsScreen ? window.showEventsScreen() : alert('Carregando Eventos...')">
                    <span>üìÖ</span> Eventos
                </div>
            </div>

            <div class="modes-grid">
                <div class="mode-card mode-normal" onclick="setModeAndPlay('NORMAL')">
                    <div class="mode-icon">üöÄ</div>
                    <div class="mode-title">Normal</div>
                </div>

                <div class="mode-card mode-frenetic" onclick="setModeAndPlay('FRENETIC')">
                    <div class="mode-icon">üî•</div>
                    <div class="mode-title">Fren√©tico</div>
                </div>

                <div class="mode-card mode-boss" onclick="setModeAndPlay('BOSS_MODE')">
                    <div class="mode-icon">üíÄ</div>
                    <div class="mode-title">Boss Rush</div>
                </div>

                <div class="mode-card mode-survival" onclick="setModeAndPlay('SURVIVAL')">
                    <div class="mode-icon">‚ò†Ô∏è</div>
                    <div class="mode-title">Survival</div>
                </div>
            </div>

            <div class="menu-footer">
                <div class="currency-item">
                    <span style="color:#ffd700">ü™ô</span> <span id="menu-total-coins-v9">0</span>
                </div>
                <div class="currency-item">
                    <span style="color:#00eaff">üíé</span> <span id="menu-total-gems-v9">0</span>
                </div>
            </div>
        `;

        // Esconde o container antigo e adiciona o novo
        if(oldContainer) oldContainer.style.display = 'none';
        menuScreen.appendChild(newContainer);

        // 3. SINCRONIZAR MOEDAS
        // Como criamos novos elementos para moedas, precisamos garantir que o UI.updateStats atualize eles tamb√©m
        var originalUpdateStats = UI.updateStats;
        UI.updateStats = function() {
            originalUpdateStats.apply(this);
            // Atualiza os novos elementos v9
            var c = document.getElementById('menu-total-coins-v9');
            var g = document.getElementById('menu-total-gems-v9');
            if(c) c.innerText = PlayerData.coins;
            if(g) g.innerText = PlayerData.gems;
        };
        UI.updateStats(); // Chamada inicial

        // 4. FUN√á√ÉO GLOBAL DE SELE√á√ÉO DE MODO
        window.setModeAndPlay = function(mode) {
            if(typeof AudioSys !== 'undefined') AudioSys.sfxClick();
            
            if (typeof Game.setMode === 'function') {
                Game.setMode(mode);
            } else {
                Game.activeMode = mode; // Fallback direto
            }
            
            UI.showHeroSelect();
        };

        // 5. SISTEMA DE PART√çCULAS DO MENU
        initMenuParticles();
    }

    function initMenuParticles() {
        var canvas = document.getElementById('menu-particles');
        if(!canvas) return;
        var ctx = canvas.getContext('2d');
        
        var w, h;
        var particles = [];

        function resize() {
            w = canvas.width = canvas.parentElement.offsetWidth;
            h = canvas.height = canvas.parentElement.offsetHeight;
        }
        window.addEventListener('resize', resize);
        resize();

        class Particle {
            constructor() {
                this.x = Math.random() * w;
                this.y = Math.random() * h;
                this.vx = (Math.random() - 0.5) * 0.5;
                this.vy = (Math.random() - 0.5) * 0.5;
                this.size = Math.random() * 2;
                this.alpha = Math.random();
                this.color = Math.random() > 0.5 ? '0, 234, 255' : '255, 215, 0'; // Ciano ou Dourado
            }
            update() {
                this.x += this.vx;
                this.y += this.vy;
                if(this.x < 0) this.x = w;
                if(this.x > w) this.x = 0;
                if(this.y < 0) this.y = h;
                if(this.y > h) this.y = 0;
                this.alpha += (Math.random() - 0.5) * 0.05;
                if(this.alpha < 0) this.alpha = 0;
                if(this.alpha > 1) this.alpha = 1;
            }
            draw() {
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fillStyle = `rgba(${this.color}, ${this.alpha})`;
                ctx.shadowBlur = 10;
                ctx.shadowColor = `rgb(${this.color})`;
                ctx.fill();
            }
        }

        // Criar 50 part√≠culas
        for(let i=0; i<50; i++) particles.push(new Particle());

        function animate() {
            ctx.clearRect(0, 0, w, h);
            particles.forEach(p => {
                p.update();
                p.draw();
            });
            
            // Desenhar linhas de conex√£o
            particles.forEach((p1, i) => {
                particles.slice(i + 1).forEach(p2 => {
                    let dx = p1.x - p2.x;
                    let dy = p1.y - p2.y;
                    let dist = Math.sqrt(dx*dx + dy*dy);
                    if(dist < 100) {
                        ctx.beginPath();
                        ctx.strokeStyle = `rgba(255, 255, 255, ${0.1 - dist/1000})`;
                        ctx.lineWidth = 0.5;
                        ctx.moveTo(p1.x, p1.y);
                        ctx.lineTo(p2.x, p2.y);
                        ctx.stroke();
                    }
                });
            });

            requestAnimationFrame(animate);
        }
        animate();
    }
})();
</script>
<script>
/**
 * PATCH v10.0: ESCOLHAS R√ÅPIDAS & MISS√ïES DE PARTIDA
 * - Adiciona Power-ups aleat√≥rios durante a corrida (Perks).
 * - Adiciona 3 Miss√µes Din√¢micas por partida com recompensas.
 * - Integra√ß√£o visual sem quebrar a l√≥gica original.
 */
(function() {
    // Aguarda o jogo estar pronto
    var patch10Interval = setInterval(function() {
        if (typeof Game !== 'undefined' && document.body) {
            clearInterval(patch10Interval);
            initPerksAndQuests();
        }
    }, 600);

    function initPerksAndQuests() {
        console.log("Inicializando Patch v10.0: Perks & Run Quests...");

        // ==========================================
        // 1. INJE√á√ÉO DE CSS (Visual Cyberpunk)
        // ==========================================
        var style = document.createElement('style');
        style.innerHTML = `
            /* --- TELA DE PERKS (ESCOLHAS) --- */
            #perk-overlay {
                position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                background: rgba(0, 0, 0, 0.85);
                z-index: 300; /* Acima de quase tudo */
                display: flex; flex-direction: column;
                align-items: center; justify-content: center;
                backdrop-filter: blur(5px);
                animation: fadeIn 0.3s;
            }
            .perk-title {
                font-size: 2rem; color: #fff; text-transform: uppercase;
                text-shadow: 0 0 15px #00eaff; margin-bottom: 30px;
                font-family: 'Orbitron', sans-serif; letter-spacing: 2px;
            }
            .perk-container {
                display: flex; gap: 20px; flex-wrap: wrap; justify-content: center;
                width: 95%; max-width: 800px;
            }
            .perk-card {
                background: linear-gradient(145deg, #1a1a2e, #16213e);
                border: 2px solid #444; border-radius: 15px;
                width: 140px; height: 180px;
                display: flex; flex-direction: column;
                align-items: center; justify-content: center;
                cursor: pointer; position: relative; overflow: hidden;
                transition: transform 0.2s, border-color 0.2s;
                box-shadow: 0 0 20px rgba(0,0,0,0.5);
            }
            .perk-card:hover, .perk-card:active {
                transform: scale(1.05); border-color: #ffd700;
                box-shadow: 0 0 30px rgba(255, 215, 0, 0.4);
            }
            .perk-icon { font-size: 3.5rem; margin-bottom: 10px; }
            .perk-name { 
                font-family: 'Rajdhani', sans-serif; font-weight: bold; color: #fff; 
                font-size: 1.1rem; text-align: center; line-height: 1.2;
            }
            .perk-desc {
                font-size: 0.7rem; color: #aaa; text-align: center; margin-top: 5px; padding: 0 5px;
            }
            .perk-rare { border-color: #ffd700; box-shadow: 0 0 15px rgba(255, 215, 0, 0.2); }

            /* --- NOTIFICA√á√ÉO DE QUEST (TOAST) --- */
            .quest-toast {
                position: absolute; top: 80px; left: 50%; transform: translateX(-50%);
                background: rgba(0, 20, 40, 0.9); border: 1px solid #00eaff;
                padding: 10px 20px; border-radius: 30px;
                color: #fff; font-family: 'Rajdhani', sans-serif; font-weight: bold;
                display: flex; align-items: center; gap: 10px;
                box-shadow: 0 0 20px rgba(0, 234, 255, 0.4);
                z-index: 100; pointer-events: none;
                animation: slideDownToast 0.5s forwards, fadeOutToast 0.5s 3s forwards;
            }
            @keyframes slideDownToast { from { top: -50px; opacity: 0; } to { top: 80px; opacity: 1; } }
            @keyframes fadeOutToast { to { opacity: 0; transform: translateX(-50%) translateY(-20px); } }

            /* --- RESULTADO DAS QUESTS (GAME OVER) --- */
            .quest-results-box {
                margin: 15px 0; width: 90%; background: rgba(0,0,0,0.5);
                border-radius: 10px; padding: 10px; border: 1px dashed #555;
            }
            .q-res-row {
                display: flex; justify-content: space-between; align-items: center;
                margin-bottom: 5px; font-size: 0.9rem; color: #ddd;
                font-family: 'Rajdhani', sans-serif;
            }
            .q-check { color: #555; font-weight: bold; }
            .q-check.done { color: #00ff00; text-shadow: 0 0 5px #00ff00; }
            
            /* --- DOUBLE COIN FX --- */
            .coin-fx {
                position: absolute; color: #ffd700; font-weight: bold;
                animation: floatUpCoin 0.8s forwards; pointer-events: none; z-index: 50;
            }
            @keyframes floatUpCoin { to { transform: translateY(-50px); opacity: 0; } }
        `;
        document.head.appendChild(style);

        // ==========================================
        // 2. INJE√á√ÉO DE HTML (Overlay de Perks)
        // ==========================================
        var perkOverlay = document.createElement('div');
        perkOverlay.id = 'perk-overlay';
        perkOverlay.className = 'hidden';
        perkOverlay.innerHTML = `
            <div class="perk-title">ESCOLHA SEU PODER</div>
            <div class="perk-container" id="perk-cards-area"></div>
        `;
        document.body.appendChild(perkOverlay);

        // ==========================================
        // 3. L√ìGICA: SISTEMA DE QUESTS (MISS√ïES)
        // ==========================================
        var QuestSystem = {
            active: [],
            pool: [
                { id: 'coin20', text: "Colete 20 Moedas", type: 'COIN', target: 20, reward: 30 },
                { id: 'coin50', text: "Colete 50 Moedas", type: 'COIN', target: 50, reward: 80 },
                { id: 'dist300', text: "Chegue a 300m", type: 'DIST', target: 300, reward: 40 },
                { id: 'dist800', text: "Chegue a 800m", type: 'DIST', target: 800, reward: 100 },
                { id: 'boss1', text: "Derrote 1 Chefe", type: 'BOSS', target: 1, reward: 150 },
                { id: 'nodmg200', text: "Sem dano at√© 200m", type: 'NODMG', target: 200, reward: 100 }
            ],
            
            startRun: function() {
                this.active = [];
                // Sorteia 3 miss√µes √∫nicas
                var poolCopy = [...this.pool];
                for(var i=0; i<3; i++) {
                    if(poolCopy.length === 0) break;
                    var idx = Math.floor(Math.random() * poolCopy.length);
                    var q = JSON.parse(JSON.stringify(poolCopy[idx])); // Clone
                    q.current = 0;
                    q.completed = false;
                    q.failed = false; // Para miss√µes de "Sem Dano"
                    this.active.push(q);
                    poolCopy.splice(idx, 1);
                }
                this.showStartToast();
            },

            update: function(type, val) {
                var updated = false;
                this.active.forEach(q => {
                    if(q.completed || q.failed) return;

                    if(q.type === type) {
                        if (type === 'DIST') q.current = Math.floor(val);
                        else q.current += val;
                        
                        if(q.current >= q.target) {
                            q.completed = true;
                            this.showCompleteToast(q);
                        }
                    }
                    // L√≥gica especial: Sem Dano
                    if(q.type === 'NODMG') {
                        // Se o tipo do update for 'DAMAGE', falha a miss√£o
                        if(type === 'DAMAGE') {
                            q.failed = true; 
                        } else if (type === 'DIST' && val >= q.target) {
                            q.completed = true; // Passou da dist√¢ncia sem falhar
                            this.showCompleteToast(q);
                        }
                    }
                });
            },

            showStartToast: function() {
                var div = document.createElement('div');
                div.className = 'quest-toast';
                div.innerHTML = `üìú Novas Miss√µes da Partida Recebidas!`;
                document.body.appendChild(div);
                setTimeout(() => div.remove(), 3500);
            },

            showCompleteToast: function(q) {
                var div = document.createElement('div');
                div.className = 'quest-toast';
                div.style.borderColor = '#00ff00';
                div.innerHTML = `‚úÖ Miss√£o Cumprida: ${q.text}`;
                document.body.appendChild(div);
                if(typeof AudioSys !== 'undefined') AudioSys.playTone(600, 'sine', 0.1, 0.1);
                setTimeout(() => div.remove(), 3500);
            }
        };

        // ==========================================
        // 4. L√ìGICA: SISTEMA DE PERKS (ESCOLHAS)
        // ==========================================
        var PerkSystem = {
            nextTrigger: 0,
            doubleCoinTimer: 0,
            
            reset: function() {
                // Primeira escolha entre 150m e 250m
                this.nextTrigger = 150 + Math.random() * 100;
                this.doubleCoinTimer = 0;
            },

            check: function(score) {
                if(score > this.nextTrigger) {
                    this.trigger();
                    // Pr√≥xima escolha entre +300m e +500m
                    this.nextTrigger = score + 300 + Math.random() * 200;
                }
                
                // Timer de Moedas
                if(this.doubleCoinTimer > 0) {
                    this.doubleCoinTimer--;
                }
            },

            trigger: function() {
                Game.togglePause(); // Usa o pause do jogo para parar tudo
                // Mas precisamos esconder a tela de pause padr√£o se ela aparecer
                var pauseScreen = document.getElementById('pause-screen');
                if(pauseScreen) pauseScreen.classList.add('hidden');

                // Renderiza op√ß√µes
                var container = document.getElementById('perk-cards-area');
                container.innerHTML = '';
                
                var options = [
                    { icon: '‚ö°', name: 'TURBO', desc: '+Velocidade +Acelera√ß√£o', action: () => { Game.gameSpeed += 2; } },
                    { icon: '‚ù§Ô∏è', name: 'CURA', desc: '+30% de Vida', action: () => { Game.hero.life = Math.min(100, Game.hero.life + 30); UI.updateHUD(Game.hero.life, Game.coinCount, Game.score); } },
                    { icon: 'ü™ô', name: 'RIQUEZA', desc: 'Moedas x2 (15s)', action: () => { PerkSystem.doubleCoinTimer = 60 * 15; /* 60fps * 15s */ } },
                    { icon: 'üõ°Ô∏è', name: 'ESCUDO', desc: 'Invenc√≠vel (5s)', action: () => { 
                        var heroEl = document.getElementById('hero-layer');
                        heroEl.style.opacity = 0.5; 
                        var originalHit = Game.takeDamage;
                        Game.takeDamage = function(){}; // Anula dano
                        setTimeout(() => { 
                            Game.takeDamage = originalHit; 
                            heroEl.style.opacity = 1; 
                        }, 5000);
                    }}
                ];

                // Sorteia 3
                options.sort(() => Math.random() - 0.5);
                options.slice(0, 3).forEach(opt => {
                    var card = document.createElement('div');
                    card.className = 'perk-card';
                    if(opt.name === 'RIQUEZA') card.classList.add('perk-rare');
                    
                    card.innerHTML = `
                        <div class="perk-icon">${opt.icon}</div>
                        <div class="perk-name">${opt.name}</div>
                        <div class="perk-desc">${opt.desc}</div>
                    `;
                    card.onclick = () => {
                        if(typeof AudioSys !== 'undefined') AudioSys.sfxClick();
                        opt.action();
                        this.close();
                    };
                    container.appendChild(card);
                });

                document.getElementById('perk-overlay').classList.remove('hidden');
            },

            close: function() {
                document.getElementById('perk-overlay').classList.add('hidden');
                Game.togglePause(); // Despausa
            }
        };

        // ==========================================
        // 5. HOOKS / OVERRIDES NO JOGO ORIGINAL
        // ==========================================

        // --- HOOK: START MATCH ---
        var _origStart = Game.startMatch;
        Game.startMatch = function(bg) {
            _origStart.call(this, bg);
            QuestSystem.startRun();
            PerkSystem.reset();
            this.lastCoinCount = 0; // Para detectar coleta de moedas
        };

        // --- HOOK: UPDATE LOOP ---
        var _origUpdate = Game.update;
        Game.update = function() {
            var lifeBefore = this.hero ? this.hero.life : 0;
            
            _origUpdate.call(this);

            if (this.state === 'PLAYING') {
                // 1. Checa Perks
                PerkSystem.check(this.score);

                // 2. Atualiza Quests de Dist√¢ncia
                QuestSystem.update('DIST', this.score);

                // 3. Detecta Dano (Para Quest No-Damage)
                if (this.hero && this.hero.life < lifeBefore) {
                    QuestSystem.update('DAMAGE', 1);
                }

                // 4. Detecta Coleta de Moedas (L√≥gica de Double Coin)
                if (this.coinCount > this.lastCoinCount) {
                    var collected = this.coinCount - this.lastCoinCount;
                    
                    // Se Perk Ativo, adiciona extra
                    if (PerkSystem.doubleCoinTimer > 0) {
                        this.coinCount += collected; // Dobra (j√° ganhou 1, ganha +1)
                        // Efeito visual
                        var txt = document.createElement('div');
                        txt.className = 'coin-fx';
                        txt.innerText = "x2";
                        txt.style.left = (this.hero.x + 20) + 'px';
                        txt.style.top = (this.hero.y - 40) + 'px';
                        document.body.appendChild(txt);
                        setTimeout(() => txt.remove(), 800);
                    }
                    
                    QuestSystem.update('COIN', collected * (PerkSystem.doubleCoinTimer > 0 ? 2 : 1));
                    this.lastCoinCount = this.coinCount;
                } else {
                    // Sincroniza caso o jogo tenha resetado ou algo assim
                    this.lastCoinCount = this.coinCount;
                }
            }
        };

        // --- HOOK: BOSS VICTORY ---
        var _origVic = Game.bossVictory;
        Game.bossVictory = function() {
            _origVic.call(this);
            QuestSystem.update('BOSS', 1);
        };

        // --- HOOK: GAME OVER ---
        var _origGameOver = Game.gameOver;
        Game.gameOver = function() {
            // Antes de mostrar a tela, injetamos os resultados das quests
            // Calculamos recompensas
            var questBonus = 0;
            var htmlResults = `<div class="quest-results-box"><div style="color:#ffd700; margin-bottom:5px; text-align:center;">MISS√ïES DA PARTIDA</div>`;
            
            QuestSystem.active.forEach(q => {
                var icon = q.completed ? '‚úÖ' : '‚ùå';
                var cls = q.completed ? 'done' : '';
                
                if (q.completed) questBonus += q.reward;
                
                htmlResults += `
                    <div class="q-res-row">
                        <span>${q.text}</span>
                        <span class="q-check ${cls}">${icon} ${q.completed ? '+' + q.reward + 'ü™ô' : ''}</span>
                    </div>
                `;
            });
            htmlResults += `</div>`;

            // Aplica B√¥nus
            if (questBonus > 0) {
                this.coinCount += questBonus;
                // Efeito sonoro extra
                setTimeout(() => { if(typeof AudioSys !== 'undefined') AudioSys.playTone(800, 'square', 0.2, 0.2); }, 500);
            }

            // Chama o Game Over original (que preenche a tela)
            _origGameOver.call(this);

            // Injeta o HTML na tela de Game Over j√° aberta
            var goScreen = document.getElementById('game-over-screen');
            var contentBox = goScreen.querySelector('div[style*="background"]'); // A caixa preta central
            
            // Insere antes do bot√£o "Jogar Novamente"
            var btn = contentBox.querySelector('button');
            var div = document.createElement('div');
            div.innerHTML = htmlResults;
            contentBox.insertBefore(div, btn);
            
            // Atualiza texto de moedas total com o b√¥nus
            document.getElementById('go-coins').innerText = this.coinCount;
        };
    }
})();
</script>
<script>
/**
 * PATCH v11.0: OTIMIZADOR DE PERFORMANCE (ANDROID FIX)
 * Corrige travamentos, vazamento de mem√≥ria e conflito de loops de anima√ß√£o.
 */
(function() {
    // Aguarda todos os outros scripts carregarem (2 segundos)
    setTimeout(function() {
        if (typeof Game === 'undefined') return;
        
        console.log("üõ†Ô∏è Aplicando Corre√ß√µes de Performance v11.0...");

        // 1. FOR√áAR ACELERA√á√ÉO DE HARDWARE (CSS)
        // Isso obriga o navegador do Android a usar a GPU para desenhar o jogo
        var style = document.createElement('style');
        style.innerHTML = `
            canvas {
                will-change: transform; /* Dica para o navegador otimizar */
                transform: translateZ(0); /* For√ßa GPU */
                image-rendering: -webkit-optimize-contrast; /* Melhora nitidez */
            }
            /* Otimiza o fundo do menu para n√£o consumir recurso quando oculto */
            #advanced-menu-container.hidden { display: none !important; }
        `;
        document.head.appendChild(style);

        // 2. CORRE√á√ÉO CR√çTICA: DESLIGAR ANIMA√á√ÉO DO MENU AO JOGAR
        // O patch v9 cria um loop infinito de part√≠culas no menu que continuava rodando
        // durante o jogo, consumindo 50% da bateria/processamento.
        var menuCanvas = document.getElementById('menu-particles');
        
        // Intercepta a fun√ß√£o de esconder telas para "Pausar" visualmente o menu
        var _originalHideAll = UI.hideAll;
        UI.hideAll = function() {
            _originalHideAll.apply(this);
            // Se o canvas do menu existir, esconda-o totalmente (para o navegador parar de desenhar)
            if (menuCanvas) menuCanvas.style.display = 'none';
        };

        // Intercepta a fun√ß√£o de mostrar o menu para "Reativar"
        var _originalShowMenu = UI.showMenu;
        UI.showMenu = function() {
            _originalShowMenu.apply(this);
            if (menuCanvas) menuCanvas.style.display = 'block';
            
            // For√ßa limpeza de arrays do jogo para liberar RAM
            Game.particles = [];
            Game.obstacles = [];
            Game.projectiles = [];
        };

        // 3. LIMITADOR DE PART√çCULAS (ANTI-LAG)
        // Explos√µes e efeitos (v1 a v10) criam muitas part√≠culas. Vamos limitar.
        var MAX_PARTICLES = 40; // M√°ximo seguro para Android
        
        var _origEmit = Game.emitHeroParticles;
        Game.emitHeroParticles = function() {
            // Em dispositivos m√≥veis, reduz a frequ√™ncia de emiss√£o pela metade
            if (Math.random() > 0.5) return;
            
            // Se j√° tem muitas part√≠culas, remove as antigas antes de criar novas
            if (this.particles.length > MAX_PARTICLES) {
                this.particles.splice(0, Math.floor(this.particles.length / 2));
            }
            _origEmit.call(this);
        };

        // Sobrescreve a explos√£o para ser mais leve
        Game.createExplosion = function(x, y, color) {
            // Reduz de 10 para 5 part√≠culas por explos√£o
            for(let k=0; k<5; k++){
                this.particles.push({
                    x: x, y: y,
                    vx: (Math.random()-0.5)*10,
                    vy: (Math.random()-0.5)*10,
                    life: 20, // Vida menor (era 30)
                    color: color
                });
            }
        };

        // 4. GARBAGE COLLECTION (LIMPEZA DE MEM√ìRIA)
        // Garante que o jogo comece "limpo" toda vez
        var _origStartMatch = Game.startMatch;
        Game.startMatch = function(bgUrl) {
            this.obstacles = [];
            this.items = [];
            this.particles = [];
            this.projectiles = [];
            
            // Executa o in√≠cio normal
            _origStartMatch.call(this, bgUrl);
            
            // Garante que o canvas do menu sumiu
            if (menuCanvas) menuCanvas.style.display = 'none';
        };

        console.log("‚úÖ Otimiza√ß√£o Conclu√≠da: Modo Android Ativado.");

    }, 2500); // Executa por √∫ltimo para garantir prioridade sobre os patches v1-v10
})();
</script>
<script>
/**
 * PATCH v12.0: ARSENAL DE POWER-UPS (LOJA & COMBATE)
 * Adiciona sistema de compra pr√©-jogo e ativa√ß√£o de habilidades.
 */
(function() {
    // Aguarda o carregamento do jogo
    var powerUpInterval = setInterval(function() {
        if (typeof Game !== 'undefined' && document.body) {
            clearInterval(powerUpInterval);
            initPowerUpSystem();
        }
    }, 800);

    function initPowerUpSystem() {
        console.log("Inicializando Patch v12.0: Power-ups...");

        // 1. CONFIGURA√á√ÉO DOS PODERES
        var POWER_UPS = [
            { id: 'shield', name: 'Escudo de Energia', desc: 'Invenc√≠vel por 5s', cost: 100, icon: 'üõ°Ô∏è', duration: 5000 },
            { id: 'slow', name: 'Matrix Time', desc: 'C√¢mera Lenta (10s)', cost: 75, icon: '‚è±Ô∏è', duration: 10000 },
            { id: 'magnet', name: '√çm√£ Magn√©tico', desc: 'Atrai moedas (15s)', cost: 50, icon: 'üß≤', duration: 15000 },
            { id: 'speed1', name: 'Turbo', desc: 'Acelera + Velocidade', cost: 50, icon: '‚è©', boost: 5 },
            { id: 'speed2', name: 'Super Turbo', desc: 'Velocidade Alta', cost: 75, icon: 'üöÄ', boost: 10 },
            { id: 'speed3', name: 'Hyper Drive', desc: 'Velocidade M√°xima', cost: 100, icon: 'üî•', boost: 15 },
            { id: 'teleport', name: 'Salto Qu√¢ntico', desc: 'Avan√ßa dist√¢ncia aleat√≥ria', cost: 100, icon: 'üåÄ' }
        ];

        // Estado local dos Power-ups
        var Inventory = []; // Itens comprados para a partida atual
        var ActiveEffects = {
            shield: false,
            magnet: false,
            slow: false
        };

        // 2. CSS DA LOJA E HUD
        var style = document.createElement('style');
        style.innerHTML = `
            /* --- LOJA PR√â-JOGO --- */
            #powerup-shop-overlay {
                position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                background: rgba(10, 10, 20, 0.95); z-index: 500;
                display: flex; flex-direction: column; align-items: center; justify-content: center;
                backdrop-filter: blur(5px); transition: opacity 0.3s;
            }
            .shop-title {
                font-size: 1.8rem; color: #ffd700; text-transform: uppercase;
                margin-bottom: 20px; font-family: 'Orbitron', sans-serif;
                text-shadow: 0 0 10px #ffd700;
            }
            .shop-grid {
                display: flex; flex-wrap: wrap; gap: 15px; justify-content: center;
                max-width: 600px; padding: 10px; overflow-y: auto; max-height: 60vh;
            }
            .shop-item {
                background: linear-gradient(145deg, #222, #111);
                border: 1px solid #444; border-radius: 8px;
                width: 100px; padding: 10px; text-align: center;
                cursor: pointer; position: relative;
                transition: transform 0.2s, border-color 0.2s;
            }
            .shop-item:active { transform: scale(0.95); }
            .shop-item.selected { border-color: #00ff00; background: #002200; box-shadow: 0 0 15px #00ff00; }
            .shop-icon { font-size: 2rem; margin-bottom: 5px; }
            .shop-name { font-size: 0.7rem; color: #fff; font-weight: bold; height: 25px; overflow:hidden;}
            .shop-cost { color: #ffd700; font-size: 0.9rem; font-weight: bold; margin-top: 5px; }
            
            .shop-actions {
                margin-top: 20px; display: flex; gap: 20px; width: 90%; max-width: 400px;
            }
            .btn-shop-play {
                flex: 1; padding: 15px; background: #00eaff; color: #000;
                border: none; font-weight: bold; font-family: 'Orbitron', sans-serif;
                text-transform: uppercase; border-radius: 5px; cursor: pointer;
            }

            /* --- HUD IN-GAME --- */
            #powerup-hud {
                position: absolute; right: 15px; top: 150px;
                display: flex; flex-direction: column; gap: 10px; z-index: 90;
            }
            .hud-power-btn {
                width: 50px; height: 50px; border-radius: 50%;
                background: rgba(0,0,0,0.6); border: 2px solid #fff;
                color: #fff; font-size: 1.5rem; cursor: pointer;
                display: flex; align-items: center; justify-content: center;
                transition: transform 0.2s; position: relative;
            }
            .hud-power-btn:active { transform: scale(0.9); background: #fff; color: #000; }
            .hud-power-btn::after {
                content: attr(data-name);
                position: absolute; right: 60px; background: rgba(0,0,0,0.7);
                padding: 2px 5px; border-radius: 3px; font-size: 0.7rem;
                display: none; white-space: nowrap;
            }
            .hud-power-btn:active::after { display: block; }

            /* Efeitos Visuais */
            .shield-effect { border: 4px solid #00eaff !important; box-shadow: 0 0 20px #00eaff, inset 0 0 20px #00eaff; }
        `;
        document.head.appendChild(style);

        // 3. HTML DA LOJA
        var shopOverlay = document.createElement('div');
        shopOverlay.id = 'powerup-shop-overlay';
        shopOverlay.className = 'hidden';
        shopOverlay.innerHTML = `
            <div class="shop-title">Arsenal de Combate</div>
            <div style="color: #fff; margin-bottom: 10px;">Seu Saldo: <span id="shop-user-coins" style="color: #ffd700; font-weight: bold;">0</span> ü™ô</div>
            <div class="shop-grid" id="shop-items-container"></div>
            <div class="shop-actions">
                <button class="btn-shop-play" onclick="PowerUpSystem.confirmAndPlay()">INICIAR MISS√ÉO >></button>
            </div>
        `;
        document.body.appendChild(shopOverlay);

        // 4. HTML DO HUD (Bot√µes durante o jogo)
        var hudContainer = document.createElement('div');
        hudContainer.id = 'powerup-hud';
        document.getElementById('game-wrapper').appendChild(hudContainer);

        // 5. SISTEMA L√ìGICO
        window.PowerUpSystem = {
            
            // Abre a loja
            openShop: function() {
                Inventory = []; // Reseta invent√°rio
                document.getElementById('shop-user-coins').innerText = PlayerData.coins;
                
                var container = document.getElementById('shop-items-container');
                container.innerHTML = '';

                POWER_UPS.forEach(p => {
                    var div = document.createElement('div');
                    div.className = 'shop-item';
                    div.innerHTML = `
                        <div class="shop-icon">${p.icon}</div>
                        <div class="shop-name">${p.name}</div>
                        <div class="shop-cost">${p.cost}</div>
                    `;
                    div.onclick = function() {
                        PowerUpSystem.toggleBuy(p, div);
                    };
                    container.appendChild(div);
                });

                document.getElementById('powerup-shop-overlay').classList.remove('hidden');
            },

            // L√≥gica de Compra (Toggle)
            toggleBuy: function(item, element) {
                // Se j√° tem, remove (reembolsa)
                var index = Inventory.findIndex(i => i.id === item.id);
                if (index > -1) {
                    Inventory.splice(index, 1);
                    PlayerData.coins += item.cost;
                    element.classList.remove('selected');
                    if(typeof AudioSys !== 'undefined') AudioSys.sfxClick();
                } else {
                    // Tenta comprar
                    if (PlayerData.coins >= item.cost) {
                        PlayerData.coins -= item.cost;
                        Inventory.push(item);
                        element.classList.add('selected');
                        if(typeof AudioSys !== 'undefined') AudioSys.sfxCoin();
                    } else {
                        alert("Moedas insuficientes!");
                    }
                }
                document.getElementById('shop-user-coins').innerText = PlayerData.coins;
                // Salva o saldo atualizado (opcional, para persistir gasto)
                Game.saveGameData(); 
            },

            // Inicia o jogo
            confirmAndPlay: function() {
                document.getElementById('powerup-shop-overlay').classList.add('hidden');
                // Chama a fun√ß√£o real de start do jogo
                Game.realStartMatch();
            },

            // Renderiza bot√µes no jogo
            renderInGameButtons: function() {
                var container = document.getElementById('powerup-hud');
                container.innerHTML = '';
                
                Inventory.forEach((item, idx) => {
                    var btn = document.createElement('div');
                    btn.className = 'hud-power-btn';
                    btn.innerHTML = item.icon;
                    btn.setAttribute('data-name', item.name);
                    
                    btn.onclick = function(e) {
                        e.stopPropagation(); // N√£o pular o personagem
                        PowerUpSystem.activate(item);
                        btn.remove(); // Remove bot√£o ap√≥s uso
                    };

                    // Touch event para mobile (garantir que n√£o pule)
                    btn.ontouchstart = function(e) {
                        e.stopPropagation();
                        PowerUpSystem.activate(item);
                        btn.remove();
                    };

                    container.appendChild(btn);
                });
            },

            // Ativa o poder
            activate: function(item) {
                if(typeof AudioSys !== 'undefined') AudioSys.playTone(400, 'square', 0.1, 0.1);
                Game.createFloatingText(item.name + "!", Game.hero.x, Game.hero.y - 50);

                if (item.id === 'shield') {
                    ActiveEffects.shield = true;
                    document.getElementById('hero-layer').classList.add('shield-effect');
                    setTimeout(() => {
                        ActiveEffects.shield = false;
                        document.getElementById('hero-layer').classList.remove('shield-effect');
                    }, item.duration);
                }
                
                if (item.id === 'magnet') {
                    ActiveEffects.magnet = true;
                    setTimeout(() => ActiveEffects.magnet = false, item.duration);
                }

                if (item.id === 'slow') {
                    ActiveEffects.slow = true;
                    // Reduz velocidade drasticamente
                    var originalSpeed = Game.gameSpeed;
                    // For√ßa update no loop para considerar o slow
                    setTimeout(() => ActiveEffects.slow = false, item.duration);
                }

                if (item.id.startsWith('speed')) {
                    // Boost instant√¢neo de velocidade (permanente para a run ou dash?)
                    // Vamos fazer um dash que percorre dist√¢ncia r√°pido sem risco
                    Game.score += (item.boost * 50); // Ganha metros
                    Game.gameSpeed += (item.boost / 2); // Aumenta um pouco a velocidade base
                }

                if (item.id === 'teleport') {
                    var dist = Math.floor(Math.random() * 500) + 200; // 200 a 700m
                    Game.score += dist;
                    Game.createFloatingText("+" + dist + "m", Game.hero.x, Game.hero.y);
                    
                    // Efeito visual de blink
                    var hero = document.getElementById('hero-layer');
                    hero.style.opacity = 0;
                    setTimeout(() => hero.style.opacity = 1, 300);
                }
            }
        };

        // 6. OVERRIDES (GANCHOS NO JOGO ORIGINAL)

        // A) Intercepta o Bot√£o de Iniciar (Select Scenario)
        // Originalmente chama Game.startMatch. Vamos desviar para a Loja.
        var _origSelectScenario = Game.selectScenarioAndStart;
        Game.selectScenarioAndStart = function() {
            // Em vez de iniciar, abre a loja
            // O usu√°rio escolheu o cen√°rio, agora compra os itens
            if(typeof AudioSys !== 'undefined') AudioSys.sfxClick();
            
            // Guarda a URL do cen√°rio selecionado (l√≥gica original)
            var scenario = SCENARIOS.find(s => s.id === this.selectedScenarioId) || SCENARIOS[0];
            this.pendingBgUrl = scenario.url;
            
            PowerUpSystem.openShop();
        };

        // B) Fun√ß√£o Real de Start (Chamada pela loja)
        Game.realStartMatch = function() {
            // Chama o startMatch original (que pode ter sido patcheado por v11, v10, etc)
            // Precisamos acessar o prototype ou a fun√ß√£o salva se houver, 
            // mas como sobrescrevemos startMatch em patches anteriores, precisamos chamar a fun√ß√£o correta.
            
            // Truque: StartMatch espera a URL.
            // Vamos chamar a fun√ß√£o original de start.
            // Como StartMatch reseta tudo, chamamos ela e DEPOIS injetamos os itens.
            
            this.startMatch(this.pendingBgUrl);
            
            // Injeta bot√µes no HUD
            PowerUpSystem.renderInGameButtons();
            
            // Reseta efeitos
            ActiveEffects = { shield: false, magnet: false, slow: false };
        };

        // C) Override: Take Damage (Escudo)
        var _origTakeDamage = Game.takeDamage;
        Game.takeDamage = function(amount) {
            if (ActiveEffects.shield) {
                Game.createFloatingText("BLOQUEADO!", this.hero.x, this.hero.y);
                return; // N√£o toma dano
            }
            _origTakeDamage.call(this, amount);
        };

        // D) Override: Update (√çm√£ e Slow Motion)
        var _origUpdate = Game.update;
        Game.update = function() {
            // L√≥gica de Slow Motion (Manipula gameSpeed antes do update)
            var realSpeed = this.gameSpeed;
            if (ActiveEffects.slow && this.state === 'PLAYING') {
                this.gameSpeed = 4; // Velocidade fixa lenta
            }

            _origUpdate.call(this);
            
            // Restaura velocidade visual (para score n√£o quebrar)
            if (ActiveEffects.slow && this.state === 'PLAYING') {
                // Mant√©m lento
            } else {
                // Se n√£o estiver slow, garante que speed volte ao normal no pr√≥ximo frame
                // A l√≥gica original calcula speed baseada no score, ent√£o ela se auto-corrige
            }

            // L√≥gica do √çm√£
            if (ActiveEffects.magnet && this.state === 'PLAYING') {
                this.items.forEach(it => {
                    if (it.type === 'COIN') {
                        // Puxa a moeda para o her√≥i
                        it.x += (this.hero.x - it.x) * 0.1;
                        it.y += (this.hero.y - it.y) * 0.1;
                    }
                });
            }
        };

    }
})();
</script>
<script>
/**
 * PATCH FINAL: OTIMIZA√á√ÉO SUPREMA PARA ANDROID (ANTI-LAG)
 * Instala√ß√£o: Coloque este script logo antes de </body>
 * Fun√ß√£o: Remove sombras pesadas, otimiza HUD e for√ßa GPU.
 */
(function() {
    // Aguarda o carregamento total do jogo e dos patches anteriores
    var performanceInterval = setInterval(function() {
        if (typeof Game !== 'undefined' && typeof Game.draw === 'function') {
            clearInterval(performanceInterval);
            applyAndroidFixes();
        }
    }, 1000);

    function applyAndroidFixes() {
        console.log("üöÄ ATIVANDO MODO TURBO ANDROID (ANTI-LAG)...");

        // 1. CSS PARA FOR√áAR GPU E REMOVER EFEITOS PESADOS DO DOM
        var style = document.createElement('style');
        style.innerHTML = `
            * { text-shadow: none !important; box-shadow: none !important; }
            canvas { transform: translate3d(0,0,0); backface-visibility: hidden; }
            .floating-currency { text-shadow: 1px 1px 0 #000 !important; }
            .hud-box, .btn { box-shadow: none !important; border: 1px solid #00eaff !important; }
            /* Mant√©m brilho apenas em textos essenciais est√°ticos */
            h1, h2 { text-shadow: 2px 2px 0px rgba(0,0,0,0.8) !important; }
        `;
        document.head.appendChild(style);

        // 2. OTIMIZA√á√ÉO DO HUD (S√≥ atualiza se mudar valores)
        var _originalUpdateHUD = UI.updateHUD;
        var _lastHUDState = { life: -1, coins: -1, score: -1 };
        
        UI.updateHUD = function(life, coins, score) {
            // Arredonda score para evitar update a cada milissegundo
            var intScore = Math.floor(score);
            var intLife = Math.floor(life);
            
            if (intLife === _lastHUDState.life && 
                coins === _lastHUDState.coins && 
                intScore === _lastHUDState.score) {
                return; // N√£o faz nada se n√£o mudou
            }
            
            _lastHUDState = { life: intLife, coins: coins, score: intScore };
            // Chama o original mas sem sobrecarga
            document.getElementById('life-fill').style.width = life + '%';
            document.getElementById('hud-coins').innerText = coins;
            document.getElementById('hud-score').innerText = intScore;
        };

        // 3. OVERRIDE DO DRAW (Redesenho sem Sombras/Blur)
        // O Canvas ShadowBlur √© o maior causador de lag em mobile.
        // Reescrevemos a fun√ß√£o draw para remover SOMENTE o blur, mantendo a cor.
        Game.draw = function() {
            const bCtx = this.bgCtx;
            const w = this.bgCanvas.width;
            const h = this.bgCanvas.height;
            
            // Limpeza otimizada
            bCtx.clearRect(0, 0, w, h);
            
            // BG Scrolling (Mantido)
            if(this.state === 'PLAYING') {
                this.bgOffset -= this.gameSpeed * 0.2;
            } else if (this.state === 'BOSS_BATTLE') {
                this.bgOffset -= 10; 
            } else {
                 this.bgOffset -= 0.5;
            }
            
            if (this.bgOffset <= -w) this.bgOffset = 0;
            
            if (this.bgImage.complete && this.bgImage.naturalWidth > 0) {
                bCtx.drawImage(this.bgImage, this.bgOffset, 0, w, h);
                bCtx.drawImage(this.bgImage, this.bgOffset + w, 0, w, h);
            } else {
                bCtx.fillStyle = '#111';
                bCtx.fillRect(0,0,w,h);
            }
            
            // Darken overlay
            bCtx.fillStyle = this.state === 'BOSS_BATTLE' ? 'rgba(50,0,0,0.3)' : 'rgba(0,0,0,0.4)';
            bCtx.fillRect(0,0,w,h);
    
            const ctx = this.ctx;
            ctx.clearRect(0, 0, w, h);
            
            if (this.state !== 'PLAYING' && this.state !== 'BOSS_BATTLE' && this.state !== 'PAUSED') return;
            
            // REMOVIDO TODO O SHADOWBLUR DAQUI PARA BAIXO
            ctx.shadowBlur = 0; 
            ctx.shadowColor = 'transparent';

            // Draw Obstacles
            this.obstacles.forEach(ob => {
                // Gradiente simples (mais leve que complexo)
                ctx.fillStyle = '#333';
                const topH = ob.y - ob.gap/2;
                const botY = ob.y + ob.gap/2;
                
                ctx.fillRect(ob.x, 0, ob.w, topH);
                ctx.fillRect(ob.x, botY, ob.w, h - botY);
                
                // Faixa neon simplificada (sem glow)
                ctx.fillStyle = '#00eaff';
                ctx.fillRect(ob.x, topH - 5, ob.w, 5); 
                ctx.fillRect(ob.x, botY, ob.w, 5); 
            });
            
            // Draw Items
            this.items.forEach(it => {
                ctx.save();
                ctx.translate(it.x, it.y);
                ctx.rotate(it.angle); // Rota√ß√£o √© barata, pode manter
                if (it.type === 'COIN') {
                    ctx.beginPath();
                    ctx.arc(0, 0, 15, 0, Math.PI*2);
                    ctx.fillStyle = '#ffd700';
                    ctx.fill();
                    ctx.fillStyle = '#000';
                    ctx.fillText('$', -3, 4); // Texto simples centralizado
                } else {
                    ctx.fillText('‚ù§Ô∏è', -8, 8);
                }
                ctx.restore();
            });
            
            // Draw Particles (Reduzido alpha para performance)
            this.particles.forEach(p => {
                ctx.fillStyle = p.color;
                ctx.globalAlpha = 0.6; // Menos transpar√™ncia complexa
                ctx.beginPath();
                ctx.arc(p.x, p.y, Math.random()*4, 0, Math.PI*2);
                ctx.fill();
            });
            ctx.globalAlpha = 1;
    
            // Draw Projectiles (Sem Glow)
            this.projectiles.forEach(p => {
                ctx.fillStyle = p.color;
                ctx.beginPath();
                ctx.arc(p.x, p.y, 8, 0, Math.PI*2);
                ctx.fill();
                
                // Rastro simples (Linha s√≥lida √© mais leve que sombra)
                ctx.strokeStyle = p.color;
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.moveTo(p.x, p.y);
                ctx.lineTo(p.x - p.vx*2, p.y);
                ctx.stroke();
            });
        };

        // 4. PARAR LOOP DO MENU AO JOGAR
        // Isso mata o processamento das part√≠culas do fundo quando o jogo inicia
        var _origHideAll = UI.hideAll;
        UI.hideAll = function() {
            _origHideAll.apply(this);
            var menuC = document.getElementById('menu-particles');
            if(menuC) menuC.style.display = 'none'; // Desliga Canvas do Menu
        };

        var _origShowMenu = UI.showMenu;
        UI.showMenu = function() {
            _origShowMenu.apply(this);
            var menuC = document.getElementById('menu-particles');
            if(menuC) menuC.style.display = 'block'; // Liga Canvas do Menu
            
            // Limpa arrays para liberar RAM
            Game.particles = []; 
            Game.projectiles = [];
        };
    }
})();
</script>

</body>
</html>
